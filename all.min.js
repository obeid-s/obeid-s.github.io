class t{constructor(t,e){this.smallCanvas=new a(t,e);var i=document.getElementById(t),s=i.clientWidth,r=i.clientHeight,n=i.parentElement;i.remove(),this.canvas=document.createElement("canvas"),this.canvas.id=t,this.canvas.className="main-canvas",this.canvas.width=s,this.canvas.height=r,n.appendChild(this.canvas),this.offsetX=25,this.offsetY=25,this.xPosAt=0,this.stepsX=0,this.isTranslateCenter=!1,this.ctx=this.canvas.getContext("2d"),this.titleText=e,this.data=new Array(2),this.currentIndexAt=new Array(2),this.startMetersIndex=0,this.endMetersIndex=0,this.lineColorMainData="rgb(31, 7, 102)",this.lineColorComparedData="rgb(102, 2, 2)",this.lineWidth=1,this.boxWidth=38,"Speed"==this.titleText&&(this.boxWidth=54),"Gear"==this.titleText&&(this.boxWidth=22),this.dataMinMax={oldMin:99999,oldMax:-99999,newMin:99999,newMax:-99999}}clear(){this.data=new Array(2),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.closePath(),this.startMetersIndex=0,this.endMetersIndex=0}setLap(t,e){t>=2?console.log("Error: You Cannot Set More Than 2 data Laps!"):(this.data[t]=e,this.startMetersIndex=0,this.endMetersIndex=null!=this.data[0]?this.data[0].length:this.data[1].length)}setMinMaxData(t,e,a,i){this.dataMinMax.oldMin>t&&(this.dataMinMax.oldMin=t),this.dataMinMax.oldMax<e&&(this.dataMinMax.oldMax=e),this.dataMinMax.newMin>a&&(this.dataMinMax.newMin=a),this.dataMinMax.newMax<i&&(this.dataMinMax.newMax=i)}setStartEndIndex(t,e){this.startMetersIndex=t,this.endMetersIndex=e,this.draw()}setIsTranslateCenter(t){this.isTranslateCenter=t}getCanvas(){return this.canvas}getCurrentIndexAt(t){return this.currentIndexAt[t]}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}drawTextTitle(){this.ctx.font="bold 26px Arial",this.ctx.fillStyle="rgba(130, 17, 49, 0.5)",this.ctx.fillText(this.titleText,25,25)}drawBaseLines(){this.ctx.strokeStyle="rgba(0, 0, 0, 0.2)";var t=(this.canvas.height-this.offsetY)/5;this.ctx.beginPath();for(var e=t;e<this.canvas.height;e+=t)this.ctx.moveTo(this.offsetX,e),this.ctx.lineTo(this.canvas.width,e);this.ctx.stroke(),this.ctx.strokeStyle="rgba(0, 0, 0, 0.8)",this.ctx.beginPath(),this.ctx.moveTo(this.offsetX,5),this.ctx.lineTo(this.offsetX,this.canvas.height-this.offsetY),this.ctx.stroke()}drawCircleOnHoveredPoint(t){this.ctx.beginPath(),this.ctx.fillStyle=0==t?this.lineColorMainData:this.lineColorComparedData;var e=this.currentIndexAt[t],a=-(this.canvas.height-(this.offsetY+5));this.isTranslateCenter&&(a/=2);var i=0;i="CFSRideHeight"==this.titleText||"Left front"==this.titleText||"Right front"==this.titleText||"Left rear"==this.titleText||"Right rear"==this.titleText?a*((this.dataMinMax.newMax-this.dataMinMax.newMin)*(this.data[t][e]-this.dataMinMax.oldMin)/(this.dataMinMax.oldMax-this.dataMinMax.oldMin)+this.dataMinMax.newMin):this.data[t][e]*a,this.ctx.arc(this.xPosAt+this.offsetX,i,4,0,2*Math.PI),this.ctx.fill()}drawBoxData(t){var e=this.currentIndexAt[t];this.ctx.beginPath(),this.ctx.fillStyle=0==t?this.lineColorMainData:this.lineColorComparedData;var a=this.xPosAt+this.offsetX;a>this.canvas.width/2&&(a-=this.boxWidth);var i=-this.canvas.height/2;this.isTranslateCenter&&(i=0),1==t&&(i+=16),this.ctx.fillRect(a,i,this.boxWidth,14),this.ctx.beginPath(),this.ctx.font="bold 12px Arial",this.ctx.fillStyle="rgba(255, 255, 255, 1.0)";var s=this.extractOriginData(t,e);this.ctx.fillText(s,a+2,i+12)}extractOriginData(t,e){switch(this.titleText){case"Delta":return null!=this.data[t][e]?this.data[t][e].toFixed(2)+"s":"0.00s";case"Throttle":case"Brake":return(100*this.data[t][e]).toFixed(0)+"%";case"Gear":return Math.round(8*this.data[t][e]);case"Speed":return Math.round(320*this.data[t][e])+"km/h";case"CFSRideHeight":case"Left front":case"Right front":case"Left rear":case"Right rear":return this.data[t][e].toFixed(4)+"m";default:return this.data[t][e].toFixed(3)}}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBaseLines(),this.drawTextTitle(),this.ctx.save(),this.isTranslateCenter?(this.ctx.translate(0,(this.canvas.height-this.offsetY)/2),this.ctx.strokeStyle="rgba(0, 0, 0, 0.8)",this.ctx.moveTo(this.offsetX,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.stroke()):this.ctx.translate(0,this.canvas.height-this.offsetY),this.ctx.lineWidth=this.lineWidth;for(var t=0,e=0;e<this.data.length;e++)if(null!=this.data[e]&&null!=this.data[e]){this.ctx.strokeStyle=0==e?this.lineColorMainData:this.lineColorComparedData,this.ctx.beginPath(),t=Math.abs(this.startMetersIndex-this.endMetersIndex),this.stepsX=(this.canvas.width-this.offsetX)/t;var a=this.stepsX,i=0;if("CFSRideHeight"==this.titleText||"Left front"==this.titleText||"Right front"==this.titleText||"Left rear"==this.titleText||"Right rear"==this.titleText)var s=((this.dataMinMax.newMax-this.dataMinMax.newMin)*(this.data[e][h]-this.dataMinMax.oldMin)/(this.dataMinMax.oldMax-this.dataMinMax.oldMin)+this.dataMinMax.newMin)*-(this.canvas.height-(this.offsetY+5));else s=this.data[e][this.startMetersIndex]*-(this.canvas.height-(this.offsetY+5));var r=0;r=this.isTranslateCenter?-(this.canvas.height-(this.offsetY+5))/2:-(this.canvas.height-(this.offsetY+5)),this.ctx.moveTo(this.offsetX+i,s);for(var n=0,h=this.startMetersIndex+1;h<this.endMetersIndex;h++)n="CFSRideHeight"==this.titleText||"Left front"==this.titleText||"Right front"==this.titleText||"Left rear"==this.titleText||"Right rear"==this.titleText?r*((this.dataMinMax.newMax-this.dataMinMax.newMin)*(this.data[e][h]-this.dataMinMax.oldMin)/(this.dataMinMax.oldMax-this.dataMinMax.oldMin)+this.dataMinMax.newMin):this.data[e][h]*r,this.ctx.lineTo(this.offsetX+a,n),i=a,s=n,a+=this.stepsX;this.ctx.stroke()}for(e=0;e<this.data.length;e++)null!=this.data[e]&&null!=this.data[e]&&(this.currentIndexAt[e]=Math.round(this.xPosAt/(this.canvas.width-this.offsetX)*t)+this.startMetersIndex,this.drawCircleOnHoveredPoint(e),this.drawBoxData(e),this.smallCanvas.isCanvasValid&&this.smallCanvas.putCurrentData(e,this.data[e][this.currentIndexAt[e]]));this.smallCanvas.isCanvasValid&&this.smallCanvas.draw(),this.ctx.restore()}}class e{constructor(t){this.lapNumber=t,this.airTemp=0,this.trackTemp=0;var e=2e4;this.LapDistPct=new Float32Array(e),this.lapDistMeters=new Float32Array(e),this.lapDistMetersInt=new Uint32Array(e),this.lapCurrentTimeSeconds=new Float32Array(e),this.throttle=new Float32Array(e),this.brake=new Float32Array(e),this.speedKmh=new Float32Array(e),this.gear=new Float32Array(e),this.steer=new Float32Array(e),this.cFSRrideHeight=new Float32Array(e),this.minCFSRideHeight=9999,this.maxCFSRideHeight=-9999,this.lFRideHeight=new Float32Array(e),this.minLFRideHeight=9999,this.maxLFRideHeight=-9999,this.rFRideHeight=new Float32Array(e),this.minRFRideHeight=9999,this.maxRFRideHeight=-9999,this.lRRideHeight=new Float32Array(e),this.minLRRideHeight=9999,this.maxLRRideHeight=-9999,this.rRRideHeight=new Float32Array(e),this.minRRRideHeight=9999,this.maxRRRideHeight=-9999,this.trackCoordinate=new r(t,e),this.lapTimeStr="",this.index=0,this.size=0,this.dataLapToCompare=null}setDataLapToCompare(t){this.dataLapToCompare=t}runSyncLaps(){if(null==this.dataLapToCompare)return console.log("No data lap to compare!"),this;var t=new Array(2);t[0]=new e(1),t[1]=new e(2);for(var a=0;a<this.size;a++)for(var i=1;i<this.dataLapToCompare.size;){if(this.lapDistMetersInt[a]==this.dataLapToCompare.lapDistMetersInt[i]){var s=this.dataLapToCompare,r=Math.abs(this.lapDistMeters[a]-s.lapDistMeters[i]),n=Math.abs(this.lapDistMeters[a]-s.lapDistMeters[i+1]),h=Math.abs(this.lapDistMeters[a]-s.lapDistMeters[i-1]);n<=r&&n<=h&&(i+=1),h<=r&&h<=n&&(i-=1);var d=this.lapCurrentTimeSeconds[a]-s.lapCurrentTimeSeconds[i];t[0].addLapCurrentTimeSeconds(d),t[1].addLapCurrentTimeSeconds(0),t[0].addLapDistPct(this.LapDistPct[a]),t[0].addLapDistMeters(this.lapDistMeters[a]),t[0].addLapDistMetersInt(this.lapDistMetersInt[a]),t[0].addThrottle(this.throttle[a]),t[0].addBrake(this.brake[a]),t[0].addSpeedKmh(this.speedKmh[a]),t[0].addGear(this.gear[a]),t[0].addSteer(this.steer[a]),t[0].addcFSRrideHeight(this.cFSRrideHeight[a]),t[0].addFrontRideHeight(this.lFRideHeight[a],this.rFRideHeight[a]),t[0].addRearRideHeight(this.lRRideHeight[a],this.rRRideHeight[a]),t[0].trackCoordinate.addLat(this.trackCoordinate.lat[a]),t[0].trackCoordinate.addLon(this.trackCoordinate.lon[a]),t[1].addLapDistPct(s.LapDistPct[i]),t[1].addLapDistMeters(s.lapDistMeters[i]),t[1].addLapDistMetersInt(s.lapDistMetersInt[i]),t[1].addThrottle(s.throttle[i]),t[1].addBrake(s.brake[i]),t[1].addSpeedKmh(s.speedKmh[i]),t[1].addGear(s.gear[i]),t[1].addSteer(s.steer[i]),t[1].addcFSRrideHeight(s.cFSRrideHeight[i]),t[1].addFrontRideHeight(s.lFRideHeight[i],s.rFRideHeight[i]),t[1].addRearRideHeight(s.lRRideHeight[i],s.rRRideHeight[i]),t[1].trackCoordinate.addLat(s.trackCoordinate.lat[i]),t[1].trackCoordinate.addLon(s.trackCoordinate.lon[i]),t[0].updateIndex(),t[0].updateSize(),t[0].trackCoordinate.updateIndex(),t[0].trackCoordinate.updateSize(),t[1].updateIndex(),t[1].updateSize(),t[1].trackCoordinate.updateIndex(),t[1].trackCoordinate.updateSize();break}i++}for(a=0;a<t.length;a++)t[a].optimizeArraySize();return t}getDataLapToCompare(){return this.dataLapToCompare}getLapTimeStr(){return this.lapTimeStr}getAirTemp(){return this.airTemp}getTrackTemp(){return this.trackTemp}getLapDistPctArray(){return this.LapDistPct}getLapCurrentTimeSecondsArray(){return this.lapCurrentTimeSeconds}getLapCurrentTimeSeconds(t){return this.lapCurrentTimeSeconds[t]}getThrottleArray(){return this.throttle}getBrakeArray(){return this.brake}getSpeedKmhArray(){return this.speedKmh}getGearArray(){return this.gear}getSteerArray(){return this.steer}getCFSRrideHeightArray(){return this.cFSRrideHeight}getLFRideHeightArray(){return this.lFRideHeight}getRFRideHeightArray(){return this.rFRideHeight}getLRRideHeightArray(){return this.lRRideHeight}getRRRideHeightArray(){return this.rRRideHeight}getLapDistMetersArray(){return this.lapDistMeters}getLapDistMetersIntArray(){return this.lapDistMetersInt}getThrottle(t){return this.throttle[t]}getLapDistMeters(t){return this.lapDistMeters[t]}getLapDistMetersInt(t){return this.lapDistMetersInt[t]}updateIndex(){this.index+=1}updateSize(){this.size+=1}optimizeArraySize(){this.LapDistPct=this.LapDistPct.slice(0,this.size),this.lapDistMeters=this.lapDistMeters.slice(0,this.size),this.lapDistMetersInt=this.lapDistMetersInt.slice(0,this.size),this.lapCurrentTimeSeconds=this.lapCurrentTimeSeconds.slice(0,this.size),this.throttle=this.throttle.slice(0,this.size),this.brake=this.brake.slice(0,this.size),this.speedKmh=this.speedKmh.slice(0,this.size),this.gear=this.gear.slice(0,this.size),this.steer=this.steer.slice(0,this.size),this.cFSRrideHeight=this.cFSRrideHeight.slice(0,this.size),this.lFRideHeight=this.lFRideHeight.slice(0,this.size),this.rFRideHeight=this.rFRideHeight.slice(0,this.size),this.lRRideHeight=this.lRRideHeight.slice(0,this.size),this.rRRideHeight=this.rRRideHeight.slice(0,this.size),this.trackCoordinate.lat=this.trackCoordinate.lat.slice(0,this.size),this.trackCoordinate.lon=this.trackCoordinate.lon.slice(0,this.size)}setAirTemp(t){this.airTemp=t}setTrackTemp(t){this.trackTemp=t}addLapCurrentTimeSeconds(t){this.lapCurrentTimeSeconds[this.index]=t}addLapDistPct(t){this.LapDistPct[this.index]=t}addLapDistMeters(t){this.lapDistMeters[this.index]=t}addLapDistMetersInt(t){this.lapDistMetersInt[this.index]=t}addThrottle(t){this.throttle[this.index]=t}addBrake(t){this.brake[this.index]=t}addSpeedKmh(t){this.speedKmh[this.index]=t}addGear(t){this.gear[this.index]=t}addSteer(t){this.steer[this.index]=t}addcFSRrideHeight(t){this.cFSRrideHeight[this.index]=t,this.minCFSRideHeight>t&&(this.minCFSRideHeight=t),this.maxCFSRideHeight<t&&(this.maxCFSRideHeight=t)}addFrontRideHeight(t,e){this.lFRideHeight[this.index]=t,this.rFRideHeight[this.index]=e,this.minLFRideHeight>t&&(this.minLFRideHeight=t),this.maxLFRideHeight<t&&(this.maxLFRideHeight=t),this.minRFRideHeight>e&&(this.minRFRideHeight=e),this.maxRFRideHeight<e&&(this.maxRFRideHeight=e)}addRearRideHeight(t,e){this.lRRideHeight[this.index]=t,this.rRRideHeight[this.index]=e,this.minLRRideHeight>t&&(this.minLRRideHeight=t),this.maxLRRideHeight<t&&(this.maxLRRideHeight=t),this.minRRRideHeight>e&&(this.minRRRideHeight=e),this.maxRRRideHeight<e&&(this.maxRRRideHeight=e)}setLapTimeSeconds(t){var e=this.lapCurrentTimeSeconds[this.size-1],a=Math.floor(e/60),i=e%60;this.lapTimeStr=a+":"+i.toFixed(4)}}class a{constructor(t,e){var a="small-"+t;if(this.isCanvasValid=!0,null!=document.getElementById(a)){this.titleText=e;var i=document.getElementById(a),s=i.clientWidth,r=i.clientHeight,n=i.parentElement;i.remove(),this.canvas=document.createElement("canvas"),this.canvas.id=a,this.canvas.className="small-canvas",this.canvas.width=s,this.canvas.height=r,n.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.currentData=new Array(2),this.lineColorMainData="rgb(31, 7, 102)",this.lineColorComparedData="rgb(102, 2, 2)"}else this.isCanvasValid=!1}putCurrentData(t,e){t>=2?console.log("Error: Could not add more than 2 data in small canvas!"):this.currentData[t]=e}drawThrottleBrake(t){var e=0==t?38:62,a=this.canvas.height-40;this.ctx.beginPath(),this.ctx.lineWidth=2,this.ctx.strokeStyle=0==t?this.lineColorMainData:this.lineColorComparedData,this.ctx.strokeRect(e,20,20,a),this.ctx.beginPath(),this.ctx.fillStyle="Throttle"==this.titleText?"rgba(0, 165, 0, 1.0)":"rgba(165, 0, 0, 1.0)",this.ctx.fillRect(e,20+a,20,-a*this.currentData[t]),this.ctx.beginPath(),this.ctx.fillStyle=0==t?this.lineColorMainData:this.lineColorComparedData,this.ctx.arc(e+10,this.canvas.height-10,8,0,2*Math.PI),this.ctx.fill()}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var t=0;t<this.currentData.length;t++)if(null!=this.currentData[t])switch(this.titleText){case"Throttle":case"Brake":this.drawThrottleBrake(t)}}}class i{constructor(t){this.file=t,this.header={},this.diskHeader={},this.varsHeader=[],this.dataLaps=null,this.data=null,this.sessionInfo=null}getHeader(){return this.header}getDiskHeader(){return this.diskHeader}getVarsHeader(){return this.varsHeader}getData(){return this.data}getDataLaps(){return this.dataLaps}getOneDataLap(t){return this.dataLaps[t]}isValid(){return null!=this.file}read(){if(this.isValid()){var t=this;return new Promise((function(e,a){var i=new FileReader;i.onloadend=function(a){t.extractData(a.target.result),e(a.target.result)},i.onerror=function(t){a(t.target.error.message)},i.readAsArrayBuffer(t.file)}))}}extractData(t){var e=new DataView(t,0,112);this.header.version=e.getUint32(0,!0),this.header.status=e.getUint32(4,!0),this.header.tick_rate=e.getUint32(8,!0),this.header.session_info_update=e.getUint32(12,!0),this.header.session_info_length=e.getUint32(16,!0),this.header.session_info_offset=e.getUint32(20,!0),this.header.num_vars=e.getUint32(24,!0),this.header.var_header_offset=e.getUint32(28,!0),this.header.num_buf=e.getUint32(32,!0),this.header.buf_len=e.getUint32(36,!0),this.header.buf_offset=e.getUint32(52,!0);var a=new DataView(t,112,32);this.diskHeader.start_date=a.getFloat64(0,!0),this.diskHeader.start_time=a.getFloat64(8,!0),this.diskHeader.end_time=a.getFloat64(16,!0),this.diskHeader.lap_count=a.getUint32(24,!0),this.diskHeader.record_count=a.getUint32(28,!0);for(var i=new DataView(t,this.header.var_header_offset,144*this.header.num_vars),s=0,r=0;r<this.header.num_vars;r++)this.varsHeader.push({type:i.getUint32(s+0,!0),offset:i.getUint32(s+4,!0),count:i.getUint32(s+8,!0),count_as_time:i.getUint8(s+12,!0),name:this.convertToString(i,s+16,s+16+32),desc:this.convertToString(i,s+48,s+48+64),unit:this.convertToString(i,s+112,s+112+32)}),s+=144;this.sessionInfo=new Uint8Array(t.slice(this.header.session_info_offset,this.header.session_info_offset+this.header.session_info_length)),this.data=new Uint8Array(t.slice(this.header.buf_offset)),this.loadDataLaps()}print(){console.log(this.header),console.log(this.diskHeader),console.log(this.varsHeader),console.log("Data Length:",this.data.length)}convertToString(t,e,a){for(var i="",s=a-e,r=0;r<s;r++){i+=0==t.getUint8(r+e)?"":String.fromCharCode(t.getUint8(r+e))}return i}loadDataLaps(){for(var t=new Array(this.diskHeader.lap_count),a=1;a<=this.diskHeader.lap_count;a++)t[a-1]=new e(a);for(var i=this.data.length/this.header.buf_len,s=0,r=this.getHeaderData("Lap",0).content,n=0,h=0,d=0,o=0;o<i;o++){if((s=this.getHeaderData("Lap",o).content)!=r){if(t[d].setLapTimeSeconds(0),t[d].optimizeArraySize(),h+1>=this.diskHeader.lap_count)break;h++}var l=this.getHeaderData("LapDistPct",o).content,c=parseFloat(this.getHeaderData("LapDist",o).content),g=parseInt(c),x=this.getHeaderData("AirTemp",o).content.toFixed(1),p=this.getHeaderData("TrackTemp",o).content.toFixed(1),u=0;g>160&&(u=parseFloat(this.getHeaderData("LapCurrentLapTime",o).content));var m=this.getHeaderData("Throttle",o).content,R=this.getHeaderData("Brake",o).content,f=(3600*this.getHeaderData("Speed",o).content/1e3/320).toFixed(3),v=(this.getHeaderData("Gear",o).content/8).toFixed(1),M=this.getHeaderData("SteeringWheelAngle",o).content,L=this.getHeaderData("CFSRrideHeight",o).content,C=this.getHeaderData("LFrideHeight",o).content,H=this.getHeaderData("RFrideHeight",o).content,T=this.getHeaderData("LRrideHeight",o).content,w=this.getHeaderData("RRrideHeight",o).content,y=this.getHeaderData("Lat",o).content,D=this.getHeaderData("Lon",o).content;t[h].setAirTemp(x),t[h].setTrackTemp(p),t[h].addLapCurrentTimeSeconds(u),t[h].addLapDistPct(l),t[h].addLapDistMeters(c),t[h].addLapDistMetersInt(g),t[h].addThrottle(m),t[h].addBrake(R),t[h].addSpeedKmh(f),0==v&&(v=n),t[h].addGear(v),t[h].addSteer(M),t[h].addcFSRrideHeight(L),t[h].addFrontRideHeight(C,H),t[h].addRearRideHeight(T,w),t[h].trackCoordinate.addLat(y),t[h].trackCoordinate.addLon(D),t[h].updateSize(),t[h].updateIndex(),t[h].trackCoordinate.updateSize(),t[h].trackCoordinate.updateIndex(),r=s,d=h,n=v}t[h].setLapTimeSeconds(0),t[h].optimizeArraySize(),this.dataLaps=t}getHeaderData(t,e){for(var a=null,i=0;i<this.varsHeader.length;i++)if(this.varsHeader[i].name==t){a=this.varsHeader[i];break}if(null==a)return a={content:0};var s=e*this.header.buf_len+a.offset;switch(a.type){case 0:a.content_type="string";var r=this.data.slice(s,s+8),n="";for(i=0;i<8;i++){n+=0==r[i]?"":String.fromCharCode(r[i])}a.content=n,8;break;case 1:a.content_type="boolean";r=this.data.slice(s,s+1);a.content=255&r,1;break;case 2:a.content_type="int32";var h=4294967295&((r=this.data.slice(s,s+4))[0]|r[1]<<8|r[2]<<16|r[3]<<24);a.content=h,4;break;case 3:h=4294967295&((r=this.data.slice(s,s+4))[0]|r[1]<<8|r[2]<<16|r[3]<<24);a.content_type="uint32",a.content=h,4;break;case 4:a.content_type="float32";r=this.data.slice(s,s+4);var d=new ArrayBuffer(4);(o=new DataView(d)).setUint8(0,r[0]),o.setUint8(1,r[1]),o.setUint8(2,r[2]),o.setUint8(3,r[3]),a.content=o.getFloat32(0,!0),4;break;case 5:a.content_type="float64";var o;r=this.data.slice(s,s+8),d=new ArrayBuffer(8);(o=new DataView(d)).setInt8(0,r[0]),o.setInt8(1,r[1]),o.setInt8(2,r[2]),o.setInt8(3,r[3]),o.setInt8(4,r[4]),o.setInt8(5,r[5]),o.setInt8(6,r[6]),o.setInt8(7,r[7]),a.content=o.getFloat64(0,!0),8;break;default:console.log("default")}return a}printSessionInfo(){for(var t=0,e="";t<this.sessionInfo.length;)e+=String.fromCharCode(this.sessionInfo[t]),t++;console.log(e)}}class s{constructor(){var t="track-canvas",e=document.getElementById(t),a=e.clientWidth,i=e.clientHeight,s=e.parentElement;e.remove(),this.canvas=document.createElement("canvas"),this.canvas.id=t,this.canvas.width=a,this.canvas.height=i,s.appendChild(this.canvas),this.widthForTrack=this.canvas.width-100,this.heightForTrack=this.canvas.height-80,this.ctx=this.canvas.getContext("2d"),this.currentIndexAt=0,this.trackCoordinates=new Array(2),this.steerAngles=new Array(2),this.steerImgs=new Array(2),this.steerImgs[0]=document.getElementById("steeringWheel1"),this.steerImgs[1]=document.getElementById("steeringWheel2"),this.xTranslate=0,this.yTranslate=0,this.zoom=1,this.trackLineColorMain="rgb(31, 7, 252, 1.0)",this.trackLineColorCompared="rgba(252, 31, 7, 1.0)",this.drawTestLines(),this.activeMoveTrack()}setZoom(t){this.zoom=t}setTranslate(t,e){this.xTranslate=t,this.yTranslate=e}setTrackCoordinates(t,e){t>=2?console.log("Error: You Cannot Set More Than 2 data Laps!"):this.trackCoordinates[t]=e}setSteerAngles(t,e){t>=2?console.log("Error: You Cannot Set More Than 2 data Laps!"):this.steerAngles[t]=e}updateCurrentIndexAt(t){this.currentIndexAt=t,this.draw()}activeMoveTrack(){var t=this,e=!1,a=0,i=0;this.canvas.addEventListener("mousedown",(function(s){null==t.trackCoordinates[0]&&null==t.trackCoordinates[1]||(a=s.pageX-t.xTranslate,i=s.pageY-t.yTranslate,e=!0)})),this.canvas.addEventListener("mousemove",(function(s){e&&(t.xTranslate=s.pageX-a,t.yTranslate=s.pageY-i,t.draw())})),this.canvas.addEventListener("mouseup",(function(){e&&(e=!1)})),this.canvas.addEventListener("mouseout",(function(){e&&(e=!1)}));this.canvas.addEventListener("wheel",(function(e){if(null!=t.trackCoordinates[0]||null!=t.trackCoordinates[1]){e.preventDefault();var a=1;a="Up"==(e.deltaY>0?"Down":"Up")?t.zoom+.1:t.zoom-.1,t.zoom=a,t.draw()}}))}convertLatLonToCanvas(t,e){var a=this.trackCoordinates[t];return{x:(a.lon[e]-a.minLon)*(this.widthForTrack/(a.maxLon-a.minLon)),y:this.heightForTrack-(a.lat[e]-a.minLat)*(this.heightForTrack/(a.maxLat-a.minLat))}}drawTestLines(){this.ctx.strokeStyle="rgba(255, 255, 255, 1.0)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.stroke()}drawCircleOnTrack(){this.ctx.beginPath(),this.ctx.fillStyle="rgb(255, 255, 255)";var t=this.convertLatLonToCanvas(0,this.currentIndexAt);this.ctx.arc(t.x,t.y,4,0,2*Math.PI),this.ctx.fill()}drawSteerAngles(){if(null!=this.steerAngles[0]||null!=this.steerAngles[1])for(var t=10,e=this.canvas.width-90,a=0;a<this.steerAngles.length;a++)null!=this.steerAngles[a]&&(t=t+80*a+5,this.ctx.beginPath(),this.ctx.save(),this.ctx.translate(e+40,t+40),this.ctx.rotate(-this.steerAngles[a][this.currentIndexAt]),this.ctx.drawImage(this.steerImgs[a],-40,-40,80,80),this.ctx.restore(),this.ctx.fillStyle=0==a?this.trackLineColorMain:this.trackLineColorCompared,this.ctx.arc(e+40,t+40,8,0,2*Math.PI),this.ctx.fill())}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.translate(this.xTranslate,this.yTranslate),this.ctx.scale(this.zoom,this.zoom),this.ctx.lineWidth=1;for(let r=0;r<this.trackCoordinates.length;r++)if(null!=this.trackCoordinates[r]&&null!=this.trackCoordinates[r]){var t=this.trackCoordinates[r],e=this.convertLatLonToCanvas(r,0);this.ctx.strokeStyle=0==r?this.trackLineColorMain:this.trackLineColorCompared;var a=e.x,i=e.y;this.ctx.beginPath();for(var s=1;s<t.size;s++)e=this.convertLatLonToCanvas(r,s),this.ctx.moveTo(a,i),a=e.x,i=e.y,e.x*this.zoom-5+this.xTranslate>this.canvas.width||e.x*this.zoom+this.xTranslate<-5||e.y*this.zoom-5+this.yTranslate>this.canvas.height||e.y*this.zoom+this.yTranslate<-5||this.ctx.lineTo(e.x,e.y);this.ctx.stroke()}this.drawCircleOnTrack(),this.ctx.restore(),this.drawSteerAngles()}}class r{constructor(t,e){this.lapNum=t,this.lat=new Float32Array(e),this.lon=new Float32Array(e),this.minLat=9999,this.maxLat=-9999,this.minLon=9999,this.maxLon=-9999,this.size=0,this.index=0}updateSize(){this.size+=1}updateIndex(){this.index+=1}addLat(t){this.lat[this.index]=t,this.minLat>t&&(this.minLat=t),this.maxLat<t&&(this.maxLat=t)}addLon(t){this.lon[this.index]=t,this.minLon>t&&(this.minLon=t),this.maxLon<t&&(this.maxLon=t)}getLatArray(){return this.lat}getLonArray(){return this.lon}}var n=document.getElementById("form_data");null==n&&console.log("Error: Could not find the form to upload");var h=document.querySelector(".loading_div");function d(){h.style.display="none"}var o=new Array(2),l=new Array(10),c=new class{constructor(){this.allCanvases=[],this.TrackCanvas=new s,this.isMouseDown=!1,this.xData=new Array(2),this.MAX_SELECTION=400}addCanvas(t){this.allCanvases.push(t)}clearAllCanvas(){this.allCanvases=[],this.TrackCanvas=new s}getTrackCanvas(){return this.TrackCanvas}setXData(t,e){this.xData[t]=e}activeOnMouseMove(){var t=this;for(let e=0;e<this.allCanvases.length;e++)this.allCanvases[e].getCanvas().onmousemove=function(e){for(let a=0;a<t.allCanvases.length;a++)t.canvasOnMouseMove(e,t.allCanvases[a],t)},this.allCanvases[e].getCanvas().onmousedown=function(a){for(let i=0;i<t.allCanvases.length;i++)t.canvasOnMouseDown(a,t.allCanvases[e])}}canvasOnMouseMove(t,e,a){if(e.xPosAt=t.offsetX-e.getOffsetX(),!(e.xPosAt<0)){e.draw(),e.ctx.strokeStyle="rgba(130, 17, 49, 0.5)",e.ctx.lineWidth=1,e.ctx.beginPath(),e.ctx.moveTo(t.offsetX,0),e.ctx.lineTo(t.offsetX,e.getCanvas().height-e.getOffsetY()),e.ctx.stroke(),e.ctx.fillStyle="rgba(255, 255, 255, 1.0)";var i=0;null!=e.getCurrentIndexAt(0)&&(i=a.xData[0][e.getCurrentIndexAt(0)]),e.ctx.font="bold 12px Arial",e.ctx.fillStyle="rgba(130, 17, 49, 0.8)",e.ctx.fillText(i+"m",t.offsetX-10,e.getCanvas().height-10),a.TrackCanvas.updateCurrentIndexAt(e.getCurrentIndexAt(0))}}canvasOnMouseDown(t,e){var a=t.offsetX,i=e.getCurrentIndexAt(0),s=0;a-e.getOffsetX()<0&&(a=0),this.isMouseDown=!0;var r=this;window.onmousemove=function(t){if(r.isMouseDown&&!(t.offsetX-e.getOffsetX()<0)){var i=t.offsetX-a;s=e.getCurrentIndexAt(0),r.highlightsSelectedPart(a,i)}},window.onmouseup=function(){if(r.isMouseDown){if(i+s!=i&&Math.abs(i-s)>r.MAX_SELECTION){if(i>s){var t=i;i=s,s=t}for(var e=0;e<r.allCanvases.length;e++)r.allCanvases[e].setStartEndIndex(i,s)}r.isMouseDown=!1}}}highlightsSelectedPart(t,e){for(var a=0;a<this.allCanvases.length;a++){var i=this.allCanvases[a].ctx;i.beginPath(),i.fillStyle="rgba(26, 55, 84, 0.2)",i.fillRect(t,0,e,this.allCanvases[a].getCanvas().height)}}},g={lap1:-1,lap2:-1};function x(){l[0]=new t("delta","Delta"),l[0].setIsTranslateCenter(!0),l[1]=new t("throttle","Throttle"),l[2]=new t("brake","Brake"),l[3]=new t("speed","Speed"),l[4]=new t("gear","Gear"),l[5]=new t("CFSRideHeight","CFSRideHeight"),l[6]=new t("LFRideHeight","Left front"),l[7]=new t("RFRideHeight","Right front"),l[8]=new t("LRRideHeight","Left rear"),l[9]=new t("RRRideHeight","Right rear"),c.clearAllCanvas();for(var e=0;e<l.length;e++)l[e].clear(),c.addCanvas(l[e])}function p(t){for(var e=document.querySelectorAll(t),a=0;a<e.length;a++)e[a].className=""}function u(t){x();var e=parseInt(t.parentElement.getAttribute("data-file-index")),a=parseInt(t.getAttribute("data-lap"));0==e?(p(".ul-laps1 li"),g.lap1=a,t.className="selectedFile1"):(p(".ul-laps2 li"),g.lap2=a,t.className="selectedFile2"),function(){if(o[0].isValid()&&-1!=g.lap1&&-1==g.lap2){var t=o[0].getOneDataLap(g.lap1);l[0].draw(),l[1].setLap(0,t.getThrottleArray()),l[1].draw(),l[2].setLap(0,t.getBrakeArray()),l[2].draw(),l[3].setLap(0,t.getSpeedKmhArray()),l[3].draw(),l[4].setLap(0,t.getGearArray()),l[4].draw(),l[5].boxWidth=54,l[5].setLap(0,t.getCFSRrideHeightArray()),l[5].setMinMaxData(t.minCFSRideHeight,t.maxCFSRideHeight,0,1),l[5].draw(),l[6].boxWidth=54,l[6].setLap(0,t.getLFRideHeightArray()),l[6].setMinMaxData(t.minLFRideHeight,t.maxLFRideHeight,0,1),l[6].draw(),l[7].boxWidth=54,l[7].setLap(0,t.getRFRideHeightArray()),l[7].setMinMaxData(t.minRFRideHeight,t.maxRFRideHeight,0,1),l[7].draw(),l[8].boxWidth=54,l[8].setLap(0,t.getLRRideHeightArray()),l[8].setMinMaxData(t.minLRRideHeight,t.maxLRRideHeight,0,1),l[8].draw(),l[9].boxWidth=54,l[9].setLap(0,t.getRRRideHeightArray()),l[9].setMinMaxData(t.minRRRideHeight,t.maxRRRideHeight,0,1),l[9].draw(),c.setXData(0,t.getLapDistMetersIntArray()),c.getTrackCanvas().setTrackCoordinates(0,t.trackCoordinate),c.getTrackCanvas().setSteerAngles(0,t.getSteerArray()),c.getTrackCanvas().draw(),m(0,t.airTemp,t.trackTemp,"0.0N")}if(o[1].isValid()&&-1!=g.lap2&&-1==g.lap1){var e=o[1].getOneDataLap(g.lap2);l[0].draw(),l[1].setLap(1,e.getThrottleArray()),l[1].draw(),l[2].setLap(1,e.getBrakeArray()),l[2].draw(),l[3].setLap(1,e.getSpeedKmhArray()),l[3].draw(),l[4].setLap(1,e.getGearArray()),l[4].draw(),l[5].boxWidth=54,l[5].setLap(1,e.getCFSRrideHeightArray()),l[5].setMinMaxData(e.minCFSRideHeight,e.maxCFSRideHeight,0,1),l[5].draw(),l[6].boxWidth=54,l[6].setLap(1,e.getLFRideHeightArray()),l[6].setMinMaxData(e.minLFRideHeight,e.maxLFRideHeight,0,1),l[6].draw(),l[7].boxWidth=54,l[7].setLap(1,e.getRFRideHeightArray()),l[7].setMinMaxData(e.minRFRideHeight,e.maxRFRideHeight,0,1),l[7].draw(),l[8].boxWidth=54,l[8].setLap(1,e.getLRRideHeightArray()),l[8].setMinMaxData(e.minLRRideHeight,e.maxLRRideHeight,0,1),l[8].draw(),l[9].boxWidth=54,l[9].setLap(e.getRRRideHeightArray()),l[9].setMinMaxData(e.minRRRideHeight,e.maxRRRideHeight,0,1),l[9].draw(),c.setXData(1,e.getLapDistMetersIntArray()),c.getTrackCanvas().setTracCoordinates(1,e.trackCoordinate),c.getTrackCanvas().setSteerAngles(1,e.getSteerArray()),c.getTrackCanvas().draw(),m(1,e.airTemp,e.trackTemp,"0.0N")}if(o[0].isValid()&&o[1].isValid()&&g.lap1>-1&&g.lap2>-1){t=o[0].getOneDataLap(g.lap1),e=o[1].getOneDataLap(g.lap2);t.setDataLapToCompare(e);var a=t.runSyncLaps();l[0].setLap(0,a[0].getLapCurrentTimeSecondsArray()),l[0].draw(),l[1].setLap(0,a[0].getThrottleArray()),l[1].setLap(1,a[1].getThrottleArray()),l[1].draw(),l[2].setLap(0,a[0].getBrakeArray()),l[2].setLap(1,a[1].getBrakeArray()),l[2].draw(),l[3].setLap(0,a[0].getSpeedKmhArray()),l[3].setLap(1,a[1].getSpeedKmhArray()),l[3].draw(),l[4].setLap(0,a[0].getGearArray()),l[4].setLap(1,a[1].getGearArray()),l[4].draw(),l[5].boxWidth=54,l[5].setLap(0,a[0].getCFSRrideHeightArray()),l[5].setLap(1,a[1].getCFSRrideHeightArray()),l[5].setMinMaxData(a[0].minCFSRideHeight,a[0].maxCFSRideHeight,0,1),l[5].setMinMaxData(a[1].minCFSRideHeight,a[1].maxCFSRideHeight,0,1),l[5].draw(),l[6].boxWidth=54,l[6].setLap(0,a[0].getLFRideHeightArray()),l[6].setLap(1,a[1].getLFRideHeightArray()),l[6].setMinMaxData(a[0].minLFRideHeight,a[0].maxLFRideHeight,0,1),l[6].setMinMaxData(a[1].minLFRideHeight,a[1].maxLFRideHeight,0,1),l[6].draw(),l[7].boxWidth=54,l[7].setLap(0,a[0].getRFRideHeightArray()),l[7].setLap(1,a[1].getRFRideHeightArray()),l[7].setMinMaxData(a[0].minRFRideHeight,a[0].maxRFRideHeight,0,1),l[7].setMinMaxData(a[1].minRFRideHeight,a[1].maxRFRideHeight,0,1),l[7].draw(),l[8].boxWidth=54,l[8].setLap(0,a[0].getLRRideHeightArray()),l[8].setLap(1,a[1].getLRRideHeightArray()),l[8].setMinMaxData(a[0].minLRRideHeight,a[0].maxLRRideHeight,0,1),l[8].setMinMaxData(a[1].minLRRideHeight,a[1].maxLRRideHeight,0,1),l[8].draw(),l[9].boxWidth=54,l[9].setLap(0,a[0].getRRRideHeightArray()),l[9].setLap(1,a[1].getRRRideHeightArray()),l[9].setMinMaxData(a[0].minRRRideHeight,a[0].maxRRRideHeight,0,1),l[9].setMinMaxData(a[1].minRRRideHeight,a[1].maxRRRideHeight,0,1),l[9].draw(),c.setXData(0,a[0].getLapDistMetersIntArray()),c.getTrackCanvas().setTrackCoordinates(0,a[0].trackCoordinate),c.getTrackCanvas().setTrackCoordinates(1,a[1].trackCoordinate),c.getTrackCanvas().setSteerAngles(0,a[0].getSteerArray()),c.getTrackCanvas().setSteerAngles(1,a[1].getSteerArray()),c.getTrackCanvas().draw(),m(0,t.airTemp,t.trackTemp,"0.0N"),m(1,e.airTemp,e.trackTemp,"0.0N")}}(),c.activeOnMouseMove()}function m(t,e,a,i){var s=[document.querySelectorAll(".file1Info"),document.querySelectorAll(".file2Info")];if(null==o[t])return s[t][0].innerHTML="0c",s[t][1].innerHTML="0c",void(s[t][2].innerHTML=0);s[t][0].innerHTML=e+"c",s[t][1].innerHTML=a+"c",s[t][2].innerHTML=i}function R(t){if(null==t)return null;for(var e=[],a=0;a<t.length;a++)e.push(t[a].getLapTimeStr());return e}n.addEventListener("submit",(function(t){if(t.preventDefault(),function(){h.style.display="block"}(),(o=new Array(2))[0]=new i(n.file1.files[0]),o[1]=new i(n.file2.files[0]),!o[0].isValid()&&!o[1].isValid())return console.log("no files"),void setTimeout(d,1e3);o[0].isValid()&&o[0].read().then((function(t){})).catch((function(t){console.log(t)}));o[1].isValid()&&o[1].read().then((function(t){})).catch((function(t){console.log(t)}));setTimeout((function(){var t,e,a;x(),t=o[0].getDataLaps(),e=o[1].getDataLaps(),(a=new Array(2))[0]=R(t),a[1]=R(e),function(t){var e=document.querySelector(".ul-laps1");if(e.innerHTML="",null!=t[0])for(var a=0;a<t[0].length;a++)e.innerHTML+="<li data-lap='"+a+"'>"+t[0][a]+"</li>";var i=document.querySelector(".ul-laps2");if(i.innerHTML="",null!=t[1])for(a=0;a<t[1].length;a++)i.innerHTML+="<li data-lap='"+a+"'>"+t[1][a]+"</li>";var s=document.querySelectorAll(".ul-laps1 li"),r=document.querySelectorAll(".ul-laps2 li");for(let t=0;t<s.length;t++)s[t].addEventListener("click",(function(){u(s[t])}));for(let t=0;t<r.length;t++)r[t].addEventListener("click",(function(){u(r[t])}));d()}(a)}),1e3)})),document.getElementById("controller-zoom-out").onclick=function(){for(var t=0;t<c.allCanvases.length;t++)for(var e=0;e<c.allCanvases[t].data.length;e++)null!=c.allCanvases[t].data[e]&&c.allCanvases[t].setStartEndIndex(0,c.allCanvases[t].data[e].length);c.getTrackCanvas().setZoom(1),c.getTrackCanvas().setTranslate(0,0),c.getTrackCanvas().draw()};