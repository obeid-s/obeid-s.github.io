class BytesReader{constructor(t){this.buffer=t,this.pos=0,this.headers=[],this.diskHeaders=[],this.varsHeaders=[],this.data=[]}seek(t){this.pos+=t}setPos(t){this.pos=t}setHeaders(t){this.headers=t,this.loadData()}setDiskHeaders(t){this.diskHeaders=t}setVarsHeaders(t){this.varsHeaders=t}loadData(){this.data=this.buffer.slice(this.headers.buf_offset,this.buffer.length)}getPos(){return this.pos}print(){console.log("Headers"),console.log(this.headers),console.log("diskHeaders"),console.log(this.diskHeaders),console.log("varsHeaders"),console.log(this.varsHeaders),console.log("Data length"),console.log(this.data.length)}padding(t){for(var e=[],a=0;a<t;a++)e.push(this.buffer[this.pos]),this.pos+=1;return e}bytesAsArray(t){for(var e=[],a=0;a<t;a++)e.push(this.buffer[this.pos]),this.pos+=1;return e}getString(t){for(var e="",a=0;a<t;a++){e+=0==this.buffer[this.pos]?"":String.fromCharCode(this.buffer[this.pos]),this.pos+=1}return e}readUint8(){var t=255&this.buffer[this.pos];return this.pos+=1,t}readUInt32(){var t=4294967295&(this.buffer[this.pos]|this.buffer[this.pos+1]<<8|this.buffer[this.pos+2]<<16|this.buffer[this.pos+3]<<24);return this.pos+=4,t}readFloat32(){var t=new ArrayBuffer(4),e=new DataView(t);return e.setUint8(0,this.buffer[this.pos]),e.setUint8(1,this.buffer[this.pos+1]),e.setUint8(2,this.buffer[this.pos+2]),e.setUint8(3,this.buffer[this.pos+3]),this.pos+=4,e.getFloat32(0,!0)}readFloat64(){var t=new ArrayBuffer(8),e=new DataView(t);return e.setInt8(0,this.buffer[this.pos+0]),e.setInt8(1,this.buffer[this.pos+1]),e.setInt8(2,this.buffer[this.pos+2]),e.setInt8(3,this.buffer[this.pos+3]),e.setInt8(4,this.buffer[this.pos+4]),e.setInt8(5,this.buffer[this.pos+5]),e.setInt8(6,this.buffer[this.pos+6]),e.setInt8(7,this.buffer[this.pos+7]),this.pos+=8,e.getFloat64(0,!0)}getHeaderData(t,e){for(var a=null,s=0;s<this.varsHeaders.length;s++)if(this.varsHeaders[s].name==t){a=this.varsHeaders[s];break}if(null!=a){var i=e*this.headers.buf_len+a.offset;switch(a.type){case 0:a.content_type="string";var r=this.data.slice(i,i+8),h="";for(s=0;s<8;s++){h+=0==r[s]?"":String.fromCharCode(r[s])}a.content=h,8;break;case 1:a.content_type="boolean";r=this.data.slice(i,i+1);a.content=255&r,1;break;case 2:a.content_type="int32";var n=4294967295&((r=this.data.slice(i,i+4))[0]|r[1]<<8|r[2]<<16|r[3]<<24);a.content=n,4;break;case 3:n=4294967295&((r=this.data.slice(i,i+4))[0]|r[1]<<8|r[2]<<16|r[3]<<24);a.content_type="uint32",a.content=n,4;break;case 4:a.content_type="float32";r=this.data.slice(i,i+4);var o=new ArrayBuffer(4);(l=new DataView(o)).setUint8(0,r[0]),l.setUint8(1,r[1]),l.setUint8(2,r[2]),l.setUint8(3,r[3]),a.content=l.getFloat32(0,!0),4;break;case 5:a.content_type="float64";var l;r=this.data.slice(i,i+8),o=new ArrayBuffer(8);(l=new DataView(o)).setInt8(0,r[0]),l.setInt8(1,r[1]),l.setInt8(2,r[2]),l.setInt8(3,r[3]),l.setInt8(4,r[4]),l.setInt8(5,r[5]),l.setInt8(6,r[6]),l.setInt8(7,r[7]),a.content=l.getFloat64(0,!0),8;break;default:console.log("default")}return a}}}class CanvasChart{static _WIDTH=920.66;static _HEIGHT=140;constructor(t,e,a){this.canvas=document.getElementById(t),this.canvas.width=CanvasChart._WIDTH,this.canvas.height=CanvasChart._HEIGHT,this.canvas.style.background="rgba(200, 200, 200, 255)",this.width=CanvasChart._WIDTH,this.height=CanvasChart._HEIGHT,this.titleText=a,this.canvasSmaller=e,this.data1=null,this.data2=null,this.data1Length=0,this.currentX=0,this.scaleX=1,this.prevX=0,this.prevY=0,this.positionOfSliderMove=1,this.maxPointsToDraw=CanvasChart._WIDTH,this.maxLength=0,this.offsetY=10,this.offsetX=20,this.offsetWithHeight=this.height-this.offsetY,this.centerWithOffset=(this.height-(this.offsetY+this.offsetY))/2,this.start=0,this.end=this.maxPointsToDraw,this.isCenterHeight=!1,this.hoverLineX=-1,this.hoverIndex=-1,this.track=null,this.ctx=this.canvas.getContext("2d"),this.data1Color="rgba(0, 0, 255, 1.0)",this.data2Color="rgba(128, 0, 31, 0.9)",this.yAxis=0}setCanvasTrack(t){this.track=t}setTitleText(t){this.titleText=t}setPositionOfSliderMove(t){this.positionOfSliderMove=t}setIsCenterHeight(t){this.isCenterHeight=t,1==t&&(this.offsetWithHeight=this.centerWithOffset)}setData1(t){this.data1=t,this.data1Length=t.length,this.setMaxLengthAndMaxPointsToDraw()}setData2(t){this.data2=t}setMaxLengthAndMaxPointsToDraw(){this.maxLength=this.data1.length}setMaxLength(t){this.maxLength=t}setScaleX(t){this.scaleX=t}getScaleX(){return this.scaleX}getPositionOfSliderMove(){return this.positionOfSliderMove}getMaxPointsToDraw(){return this.maxPointsToDraw}activeMoveEvents(){var t=this,e=0,a=0,s=!1,i=0,r=0,h=0;this.canvas.addEventListener("mousedown",(function(t){e=t.pageX+a,s=!0})),this.canvas.onmousemove=function(a){s&&((i=-1*(a.pageX-e))<=0&&(i=0),h=(r=i)+t.maxPointsToDraw>=t.maxLength?t.maxLength:r+t.maxPointsToDraw,t.draw(r,h))},this.canvas.onmouseup=function(){s&&(s=!1),a=i}}setHoverLineX(t,e){this.hoverLineX=t,this.hoverIndex=e}getHoverLineX(){return this.hoverLineX}getHoverIndex(){return this.hoverIndex}restoreData(t){switch(this.titleText){case"Throttle":case"Brake":return(100*t).toFixed(1)+"%";case"Speed":case"FLspeed":case"FRspeed":case"RLspeed":case"RRspeed":return(320*t).toFixed(1)+" km/h";case"Gear":var e=Math.round(7*t);return 0==e?"N":e;case"Steer":return(t*(180/Math.PI)).toFixed(1)+"Â°";default:return t}}drawBoxWithValues(t){if(!(this.hoverIndex>=this.data1Length)){this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 255, 255, 0.5)",t=this.isCenterHeight?t>=15?15:t:t>=-50?-50:t,this.yAxis=t;this.ctx.fillRect(this.hoverLineX+10,t,68,50),this.ctx.fillStyle=this.data1Color,this.ctx.font="bold 12px Arial";var e=this.restoreData(this.data1[this.hoverIndex].toFixed(3));if(this.canvasSmaller.setCurrentData1(e),this.ctx.fillText(e,this.hoverLineX+15,t+20),null!=this.data2&&this.data2.length>0){this.ctx.fillStyle=this.data2Color;var a=this.restoreData(this.data2[this.hoverIndex].toFixed(3));this.canvasSmaller.setCurrentData2(a),this.ctx.fillText(a,this.hoverLineX+15,t+40)}this.canvasSmaller.draw()}}drawHoverLine(){this.ctx.beginPath(),this.ctx.strokeStyle="rgba(100, 100, 100, 0.9)",this.ctx.save(),this.ctx.translate(0,0),this.ctx.moveTo(this.hoverLineX,0),this.ctx.lineTo(this.hoverLineX,this.height),this.ctx.stroke(),this.ctx.restore()}onHoverDrawLineOnAll(t){var e=this;this.canvas.addEventListener("mousemove",(function(a){var s=a.offsetX,i=Math.round((s-e.offsetX)/e.getScaleX())+e.start;null!=e.track&&e.track.setIndex(i);for(var r=0;r<t.length;r++)t[r].setHoverLineX(s,i),t[r].reDraw(),t[r].drawDataFromHover()}))}drawLineOnChart(t){var e=(t+this.offsetX-this.getPositionOfSliderMove())/this.getScaleX();this.setHoverLineX(e,t),this.reDraw(),this.drawDataFromHover()}drawDataFromHover(){if(!(this.hoverIndex<0)){this.ctx.save(),this.ctx.translate(0,this.offsetWithHeight);var t,e=0;null!=this.data2&&this.data2.length>0&&(e=this.data2[this.hoverIndex]*-(this.offsetWithHeight-this.offsetY),this.ctx.beginPath(),this.ctx.fillStyle=this.data2Color,this.ctx.arc(this.hoverLineX,e,5,0,2*Math.PI),this.ctx.fill()),t=this.data1[this.hoverIndex]*-(this.offsetWithHeight-this.offsetY),this.ctx.beginPath(),this.ctx.fillStyle=this.data1Color,this.ctx.arc(this.hoverLineX,t,5,0,2*Math.PI),this.ctx.fill(),this.drawBoxWithValues(t),this.ctx.restore()}}setStartEndAndReDraw(t){var e=0;e=t+this.maxPointsToDraw>=this.maxLength?this.maxLength:t+this.maxPointsToDraw,this.draw(t,e)}reDraw(){this.draw(this.start,this.end)}drawBaseLinesYAxis(){this.ctx.beginPath(),this.ctx.strokeStyle="rgb(10, 10, 10)",this.ctx.lineWidth=1,this.ctx.moveTo(this.offsetX,this.offsetY),this.ctx.lineTo(this.offsetX,this.height-this.offsetY),this.ctx.stroke()}drawText(){this.ctx.fillStyle="rgba(10, 10, 10, 0.5)",this.ctx.font="24px Arial",this.ctx.fillText(this.titleText,20,24,this.width)}drawLineInMiddle(){this.ctx.beginPath(),this.ctx.strokeStyle="rgba(0, 0, 0, 0.5)",this.ctx.lineWidth=2,this.ctx.moveTo(this.offsetX,0),this.ctx.lineTo(this.width,0),this.ctx.stroke()}draw(t,e){this.ctx.clearRect(0,0,this.width,this.height),this.start=t,this.end=e,this.drawText(),this.drawBaseLinesYAxis(),this.ctx.save(),this.ctx.translate(0,this.offsetWithHeight),this.isCenterHeight&&this.drawLineInMiddle(),this.ctx.lineWidth=1.5,this.ctx.beginPath(),this.currentX=this.offsetX+1,this.prevX=this.offsetX,this.prevY=this.data1[t]*-(this.offsetWithHeight-this.offsetY),this.ctx.strokeStyle=this.data1Color;for(var a=t+1;a<e;a++){var s=this.data1[a]*-(this.offsetWithHeight-this.offsetY);this.ctx.moveTo(this.prevX,this.prevY),this.ctx.lineTo(this.currentX,s),this.prevX=this.currentX,this.currentX+=this.scaleX,this.prevY=s}if(this.ctx.stroke(),null==this.data2||null==this.data2||0==this.data2.length)return this.ctx.restore(),void(this.hoverLineX>-1&&(this.drawHoverLine(),this.drawDataFromHover()));this.ctx.beginPath(),this.currentX=this.offsetX+1,this.prevX=this.offsetX,this.prevY=this.data2[t]*-(this.offsetWithHeight-this.offsetY),this.ctx.strokeStyle=this.data2Color;for(a=t+1;a<e;a++){s=this.data2[a]*-(this.offsetWithHeight-this.offsetY);this.ctx.moveTo(this.prevX,this.prevY),this.ctx.lineTo(this.currentX,s),this.prevX=this.currentX,this.currentX+=this.scaleX,this.prevY=s}this.ctx.stroke(),this.ctx.restore(),this.hoverLineX>-1&&(this.drawHoverLine(),this.drawDataFromHover())}}class CanvasSmaller{static _WIDTH=200;static _HEIGHT=140;constructor(t){this.canvas=document.getElementById(t),this.canvas.width=CanvasSmaller._WIDTH,this.canvas.height=CanvasSmaller._HEIGHT,this.canvas.style.background="rgba(200, 200, 200, 255)",this.width=CanvasSmaller._WIDTH,this.height=CanvasSmaller._HEIGHT,this.currentData1=null,this.currentData2=null,this.offsetY=5,this.offsetX=5,this.name=t.replace("smaller-",""),this.ctx=this.canvas.getContext("2d"),this.data1Color="rgba(0, 0, 255, 1.0)",this.data2Color="rgba(128, 0, 31, 0.9)",this.steerImg=null,"steer"==this.name&&(this.steerImg=new Image(50,50),this.steerImg.src="images/wheel-tr.png")}setCurrentData1(t){"gear"==this.name?this.currentData1=t:this.currentData1=parseFloat(t)}setCurrentData2(t){"gear"==this.name?this.currentData2=t:this.currentData2=parseFloat(t)}drawSteeringWheel(){this.ctx.save(),this.ctx.translate(47.5,47.5),this.ctx.rotate(-this.currentData1*(Math.PI/180)),this.ctx.drawImage(this.steerImg,-47.5,-47.5,95,95),this.ctx.restore(),null!=this.currentData2&&(this.ctx.save(),this.ctx.translate(152.5,47.5),this.ctx.rotate(-this.currentData2*(Math.PI/180)),this.ctx.drawImage(this.steerImg,-47.5,-47.5,95,95),this.ctx.restore()),this.ctx.fillStyle=this.data1Color,this.ctx.fillRect(20,this.height-20,50,5),this.ctx.fillStyle=this.data2Color,this.ctx.fillRect(this.width/2+20,this.height-20,50,5)}drawMiddleLine(){"speed"!=this.name&&(this.ctx.beginPath(),this.ctx.fillStyle="rgba(10, 10, 10, 0.5)",this.ctx.fillRect(.5*this.width,0,2,this.height)),this.ctx.beginPath(),this.ctx.strokeStyle="rgba(10, 10, 10, 0.2)";for(var t=this.height/10,e=0,a=0;a<t;a++)this.ctx.moveTo(0,e),this.ctx.lineTo(this.width,e),e+=10;this.ctx.stroke()}drawThrottleBrake(){var t=.12*this.width,e=this.currentData1/100*(this.height-2*this.offsetY);if(this.ctx.fillStyle=this.data1Color,this.ctx.fillRect(.2*this.width,this.height-this.offsetY,t,-e),null!=this.currentData2){this.ctx.fillStyle=this.data2Color;var a=this.currentData2/100*(this.height-2*this.offsetY);this.ctx.fillRect(.7*this.width,this.height-this.offsetY,t,-a)}this.ctx.beginPath(),this.ctx.strokeStyle="rgba(5, 5, 5, 1.0)",this.ctx.rect(.2*this.width-1,this.offsetY,t+2,this.height-2*this.offsetY),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.strokeStyle="rgba(5, 5, 5, 1.0)",this.ctx.rect(.7*this.width-1,this.offsetY,t+2,this.height-2*this.offsetY),this.ctx.stroke()}drawSpeed(){var t=this.height/2;if(this.ctx.fillStyle=this.data1Color,this.ctx.font="bold 34px Arial",null!=this.currentData2){var e=(parseFloat(this.currentData1)-parseFloat(this.currentData2)).toFixed(1)+" km/h";this.ctx.fillText(e,20,t)}else this.ctx.fillText(this.currentData1.toFixed(1)+" km/h",20,t)}drawGear(){var t=40,e=this.height/2;this.ctx.fillStyle=this.data1Color,this.ctx.font="bold 34px Arial",this.ctx.fillText(this.currentData1,t,e),null!=this.currentData2&&(t=.7*this.width,this.ctx.fillStyle=this.data2Color,this.ctx.fillText(this.currentData2,t,e))}draw(){switch(this.ctx.clearRect(0,0,this.width,this.height),this.drawMiddleLine(),this.name){case"throttle":case"brake":this.drawThrottleBrake();break;case"speed":this.drawSpeed();break;case"steer":this.drawSteeringWheel();break;case"gear":this.drawGear()}}}class CanvasTrack{constructor(t){this.canvas=document.getElementById(t),this.canvas.width=700,this.canvas.height=700,this.width=700,this.height=700,this.ctx=this.canvas.getContext("2d"),this.data1X=null,this.data1Y=null,this.data2X=null,this.data2Y=null,this.allCharts=null,this.data1Color="rgba(0, 0, 255, 1.0)",this.data2Color="rgba(128, 0, 31, 0.9)",this.index=-1,this.scale=1,this.translate={x:0,y:0},this.enableMovement()}setData1(t,e){this.data1X=t,this.data1Y=e}setData2(t,e){this.data2X=t,this.data2Y=e}setIndex(t){this.index=t,this.draw()}setAllCharts(t){this.allCharts=t}updateChartIndex(){if(!(null==this.allCharts||this.allCharts.length<=0))for(var t=0;t<this.allCharts.length;t++)this.allCharts[t].drawLineOnChart(this.getIndex())}getIndex(){return this.index}enableMovement(){var t=this,e=!1,a=0,s=0;this.canvas.addEventListener("mousedown",(function(i){a=i.offsetX-t.translate.x,s=i.offsetY-t.translate.y,e=!0})),this.canvas.addEventListener("mousemove",(function(i){if(e){var r=i.offsetX-a,h=i.offsetY-s;t.translate.x=r,t.translate.y=h,t.draw()}})),this.canvas.addEventListener("mouseup",(function(t){e=!1})),this.canvas.addEventListener("mouseout",(function(t){e=!1})),this.canvas.addEventListener("wheel",(function(e){e.preventDefault(),t.isZoom=!0,e.deltaY>0?t.zoomOut(e):e.deltaY<0&&t.zoomIn(e)})),this.canvas.addEventListener("mousemove",(function(e){var a=e.offsetX-t.translate.x,s=e.offsetY-t.translate.y;for(let e=0;e<t.data1Y.length;e++){var i=t.data1X[e]-a,r=t.data1Y[e]-s;if(i<=5&&r<=5&&i>=-5&&r>=-5){t.setIndex(e),t.updateChartIndex();break}}}))}zoomIn(t){}zoomOut(t){}drawCirclePosition(){this.ctx.beginPath(),this.ctx.fillStyle=this.data1Color,this.ctx.arc(this.data1X[this.getIndex()],this.data1Y[this.getIndex()],8,0,2*Math.PI),this.ctx.fill(),null!=this.data2X&&(this.ctx.beginPath(),this.ctx.fillStyle=this.data2Color,this.ctx.arc(this.data2X[this.getIndex()],this.data2Y[this.getIndex()],8,0,2*Math.PI),this.ctx.fill())}draw(){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.save(),this.ctx.translate(this.translate.x,this.translate.y),this.ctx.scale(this.scale,this.scale),this.ctx.lineWidth=1,this.ctx.strokeStyle=this.data1Color;var t=this.data1X.length,e=this.data1X[0],a=this.data1Y[0];this.ctx.beginPath();for(var s=1;s<t;s++){if(0==(i=this.data1X[s])&0==(r=this.data1Y[s]))break;this.ctx.moveTo(e,a),this.ctx.lineTo(i,r),e=i,a=r}if(this.ctx.stroke(),null!=this.data2X){this.ctx.strokeStyle=this.data2Color;t=this.data2X.length;e=this.data2X[0],a=this.data2Y[0],this.ctx.beginPath();for(s=1;s<t;s++){var i,r;if(0==(i=this.data2X[s])&0==(r=this.data2Y[s]))break;this.ctx.moveTo(e,a),this.ctx.lineTo(i,r),e=i,a=r}this.ctx.stroke()}this.drawCirclePosition(),this.ctx.restore()}}class DriverInputs{constructor(t){this.length=t,this.lapDistPct=new Float32Array(t),this.lapDist=new Uint32Array(t),this.lapCurrentTimeSeconds=new Float32Array(t),this.throttle=new Float32Array(t),this.brake=new Float32Array(t),this.speed=new Float32Array(t),this.steer=new Float32Array(t),this.gear=new Int8Array(t),this.leftFrontSpeed=new Float32Array(t),this.rightFrontSpeed=new Float32Array(t),this.leftRearSpeed=new Float32Array(t),this.rightRearSpeed=new Float32Array(t),this.lapTimeSeconds=0,this.lapTimeString="",this.pos=0,this.optimizedLength=0,this.filename=null}getFilename(){return this.filename}getLength(){return this.length}getLapDistPct(t){return this.lapDistPct[t]}getLapDist(t){return this.lapDist[t]}getLapCurrentTimeSecond(t){return this.lapCurrentTimeSeconds[t]}getThrottle(t){return this.throttle[t]}getBrake(t){return this.brake[t]}getSpeed(t){return this.speed[t]}getSteer(t){return this.steer[t]}getGear(t){return this.gear[t]}getFLspeed(t){return this.leftFrontSpeed[t]}getFRspeed(t){return this.rightFrontSpeed[t]}getRLspeed(t){return this.leftRearSpeed[t]}getRRspeed(t){return this.rightRearSpeed[t]}getLapTimeSeconds(){return this.lapTimeSeconds}getLapTimeString(){return this.lapTimeString}getLapDistPctArray(){return this.lapDistPct}getThrottleArray(){return this.throttle}getBrakeArray(){return this.brake}printTiresSpeedArrays(){console.log("=============================================="),console.log("LF:",this.leftFrontSpeed),console.log("LR:",this.rightFrontSpeed),console.log("RL:",this.leftRearSpeed),console.log("RR:",this.rightRearSpeed)}getClutchArray(){return this.speed}setFilename(t){this.filename=t}setOptimizedLength(t){this.optimizedLength=t}runOptimization(){this.lapDistPct=this.lapDistPct.subarray(0,this.optimizedLength),this.lapDist=this.lapDist.subarray(0,this.optimizedLength),this.lapCurrentTimeSeconds=this.lapCurrentTimeSeconds.subarray(0,this.optimizedLength),this.throttle=this.throttle.subarray(0,this.optimizedLength),this.brake=this.brake.subarray(0,this.optimizedLength),this.speed=this.speed.subarray(0,this.optimizedLength),this.gear=this.gear.subarray(0,this.optimizedLength),this.leftFrontSpeed=this.leftFrontSpeed.subarray(0,this.optimizedLength),this.rightFrontSpeed=this.rightFrontSpeed.subarray(0,this.optimizedLength),this.leftRearSpeed=this.leftRearSpeed.subarray(0,this.optimizedLength),this.rightRearSpeed=this.rightRearSpeed.subarray(0,this.optimizedLength),this.length=this.optimizedLength}addLapDistPct(t){this.lapDistPct[this.pos]=t}addLapDist(t){this.lapDist[this.pos]=parseInt(t)}addLapCurrentTimeSeconds(t){this.lapCurrentTimeSeconds[this.pos]=t}addThrottle(t){this.throttle[this.pos]=t}addBrake(t){this.brake[this.pos]=t}addSpeed(t){this.speed[this.pos]=t}addSteer(t){this.steer[this.pos]=t.toFixed(4)}addGear(t){this.gear[this.pos]=t}addTiresSpeed(t,e,a,s){this.leftFrontSpeed[this.pos]=t,this.rightFrontSpeed[this.pos]=e,this.leftRearSpeed[this.pos]=a,this.rightRearSpeed[this.pos]=s}setLapTimeSeconds(t){this.lapTimeSeconds=t;var e=Math.floor(t/60),a=t%60;this.lapTimeString=e+":"+a.toFixed(4)}updatePos(){this.pos++}}class LocationReader{constructor(t){this.length=t,this.lat=new Float32Array(t),this.lon=new Float32Array(t),this.pos=0,this.optimizedLength=0,this.latLimit={min:999.999,max:-999.999},this.lonLimit={min:999.999,max:-999.999},this.xLimit={min:9999.999,max:-9999.999},this.yLimit={min:9999.999,max:-9999.999}}getLength(){return this.length}getLatLimit(){return this.latLimit}getLonLimit(){return this.lonLimit}setLatLimit(t){t<this.latLimit.min&&(this.latLimit.min=t),t>this.latLimit.max&&(this.latLimit.max=t)}setLonLimit(t){t<this.lonLimit.min&&(this.lonLimit.min=t),t>this.lonLimit.max&&(this.lonLimit.max=t)}setXLimit(t){t<this.xLimit.min&&(this.xLimit.min=t),t>this.xLimit.max&&(this.xLimit.max=t)}getXLimit(){return this.xLimit}setYLimit(t){t<this.xLimit.min&&(this.xLimit.min=t),t>this.xLimit.max&&(this.xLimit.max=t)}getLat(t){return this.lat[t]}getLon(t){return this.lon[t]}addLat(t){this.lat[this.pos]=t,this.setLatLimit(t)}addLon(t){this.lon[this.pos]=t,this.setLonLimit(t)}updatePos(){this.pos++}setOptimizedLength(t){this.optimizedLength=t}runOptimization(){this.lon=this.lon.subarray(0,this.optimizedLength),this.lat=this.lat.subarray(0,this.optimizedLength),this.length=this.optimizedLength}}const HEADER_BYTES_SIZE=112,DISK_HEADER_BYTES_SIZE=32,VAR_HEADER_BYTES_SIZE=144;function showLoading(){document.querySelector(".lds-ring").style.display="block"}function hideLoading(){document.querySelector(".lds-ring").style.display="none"}function hideLoadButton(){document.getElementById("input_load_button").style.display="none"}var formFiles=document.getElementById("files_form");function removeOutLaps(t,e){for(var a=0;a<t.length;a++)if(!(null==t[a]||null==t[a]||t[a].length<=1))for(var s=0;s<t[a].length;)t[a][s].getLapTimeSeconds()<=0?(t[a].splice(s,1),e[a].splice(s,1),s=0):s++}function optimizeLengthOfArrays(t,e){for(var a=0;a<t.length;a++)if(!(null==t[a]||null==t[a]||t[a].length<=1))for(var s=0;s<t[a].length;s++)t[a][s].runOptimization(),e[a][s].runOptimization()}function scaleNumber(t,e,a,s,i){return(t-e)*(i-s)/(a-e)+s}function displayLapsToSelect(t,e){var a=new Array(2);a[0]=document.querySelector(".file1_laps"),a[1]=document.querySelector(".file2_laps");for(var s=0;s<a.length;s++)a[s].innerHTML="";for(s=0;s<t.length;s++)if(null!=t[s]){for(var i="<span class='filename_text' title='"+(s+1)+"'>File "+t[s][0].getFilename()+"</span>"+"<ul class='ul_style'>",r=0;r<t[s].length;r++)i+="<li data-file='"+s+"' data-lap='"+r+"'>"+t[s][r].getLapTimeString()+"</li>";i+="</ul><hr>",a[s].innerHTML=i}activeOnLapClick(t,e)}formFiles.onsubmit=function(t){t.preventDefault(),showLoading(),hideLoadButton();var e=new Array(2);if(e[0]=formFiles.file_one.files[0],e[1]=formFiles.file_two.files[0],null!=e[0]||null!=e[1]){var a=new Array(2),s=new Array(2);for(let t=0;t<e.length;t++)if(null!=e[t]){var i=new FileReader;i.readAsArrayBuffer(e[t]),i.onload=function(i){var r=i.target.result;if(null==r)return void console.log("is null");var h=new Uint8Array(r),n=new BytesReader(h),o={};o.version=n.readUInt32(),o.status=n.readUInt32(),o.tick_rate=n.readUInt32(),o.sesion_info_update=n.readUInt32(),o.sesion_info_offset=n.readUInt32(),o.sesion_info_length=n.readUInt32(),o.num_vars=n.readUInt32(),o.var_header_offset=n.readUInt32(),o.num_buf=n.readUInt32(),o.buf_len=n.readUInt32(),n.pos+=12,o.buf_offset=n.readUInt32(),n.setHeaders(o),n.setPos(112);var l={};l.start_date=n.readFloat64(),l.start_time=n.readFloat64(),l.end_time=n.readFloat64(),l.lap_count=n.readUInt32(),l.record_count=n.readUInt32(),n.setDiskHeaders(l);for(var d=[],c=0;c<o.num_vars;c++)d.push({type:n.readUInt32(),offset:n.readUInt32(),count:n.readUInt32(),count_as_time:n.readUint8(),padding:n.padding(3),name:n.getString(32),desc:n.getString(64),uint:n.getString(32)});n.setVarsHeaders(d);var g=Math.round(n.data.length/n.headers.buf_len),f=n.diskHeaders.lap_count,p=0,u=0,m=0,v=0,x=0;a[t]=new Array(f),a[t][u]=new DriverInputs(g),s[t]=new Array(f),s[t][u]=new LocationReader(g);const L=320;var w=0;for(let i=0;i<g;i++){if((m=n.getHeaderData("Lap",i).content)==v){a[t][p].addLapDistPct(parseFloat(n.getHeaderData("LapDistPct",i).content).toFixed(4));var S=n.getHeaderData("LapCurrentLapTime",i).content,y=n.getHeaderData("Throttle",i).content,D=n.getHeaderData("Brake",i).content,C=(3600*n.getHeaderData("Speed",i).content/1e3/L).toFixed(2),b=n.getHeaderData("SteeringWheelAngle",i).content,I=n.getHeaderData("Gear",i).content,F=n.getHeaderData("LapDist",i).content,T=n.getHeaderData("Lat",i).content,k=n.getHeaderData("Lon",i).content,A=(3600*n.getHeaderData("LFspeed",i).content/1e3/L).toFixed(2),H=(3600*n.getHeaderData("RFspeed",i).content/1e3/L).toFixed(2),X=(3600*n.getHeaderData("LFspeed",i).content/1e3/L).toFixed(2),_=(3600*n.getHeaderData("RFspeed",i).content/1e3/L).toFixed(2);y<=0&&(y=0),D<=0&&(D=0),C<=0&&(C=0),s[t][p].addLat(T),s[t][p].addLon(k),s[t][p].setLatLimit(T),s[t][p].setLonLimit(k),s[t][p].updatePos(),a[t][p].addLapDist(F),a[t][p].addLapCurrentTimeSeconds(S),a[t][p].addThrottle(y),a[t][p].addBrake(D),a[t][p].addSpeed(C),a[t][p].addSteer(b),a[t][p].addGear(I),a[t][p].addTiresSpeed(A,H,X,_),a[t][p].updatePos(),x++}if(m!=v||i>=g-1){var R=n.getHeaderData("LapLastLapTime",i).content;if(R==w?a[t][u].setLapTimeSeconds(0):a[t][u].setLapTimeSeconds(R),w=R,a[t][u].setFilename(e[t].name),a[t][p].setOptimizedLength(x),s[t][p].setOptimizedLength(x),x=0,u=p,v=m,i<g-1&&(p++,a[t][p]=new DriverInputs(g),s[t][p]=new LocationReader(g)),i>=g-1)break}}}}setTimeout((function(){hideLoading(),removeOutLaps(a,s),optimizeLengthOfArrays(a,s),displayLapsToSelect(a,s)}),2e3)}else console.log("Error")};var lapChoosed=[{lap:0},{lap:0}];function activeOnLapClick(t,e){var a=document.querySelectorAll(".ul_style li"),s=new Array(2);for(let i=0;i<a.length;i++)a[i].addEventListener("click",(function(){if(null!=a[i].getAttribute("data-file")){var r=parseInt(a[i].getAttribute("data-file"));s[r]=a[i],lapChoosed[r].lap=parseInt(a[i].getAttribute("data-lap"));for(var h=0;h<a.length;h++)a[h].className="";for(h=0;h<s.length;h++)null!=s[h]&&(s[h].className=0==h?"selected-file1":"selected-file2");displayData(t,e)}}))}function initSliderRange(t,e,a){var s=document.getElementById("slider_range_value"),i=document.getElementById("slider_range");i.setAttribute("min",t),i.setAttribute("max",e),i.oninput=function(){s.textContent="Move "+i.value;for(var t=0;t<a.length;t++)a[t].setStartEndAndReDraw(parseInt(i.value)),a[t].setPositionOfSliderMove(i.value)},i.onchange=function(){s.textContent="Move "+i.value;for(var t=0;t<a.length;t++)a[t].setStartEndAndReDraw(parseInt(i.value))}}function initSliderScaleX(t){var e=document.getElementById("slider_scale_value"),a=document.getElementById("slider_scale");a.oninput=function(){e.textContent="ScaleX "+a.value;for(var s=0;s<t.length;s++)t[s].setScaleX(parseFloat(a.value)),t[s].reDraw()},a.onchange=function(){e.textContent="ScaleX "+a.value;for(var s=0;s<t.length;s++)t[s].setScaleX(parseFloat(a.value)),t[s].reDraw()}}async function displayData(t,e){var a,s=new CanvasChart("delta",new CanvasSmaller("smaller-delta"),"Delta"),i=new CanvasChart("throttle",new CanvasSmaller("smaller-throttle"),"Throttle"),r=new CanvasChart("brake",new CanvasSmaller("smaller-brake"),"Brake"),h=new CanvasChart("speed",new CanvasSmaller("smaller-speed"),"Speed"),n=new CanvasChart("steer",new CanvasSmaller("smaller-steer"),"Steer"),o=new CanvasChart("gear",new CanvasSmaller("smaller-gear"),"Gear"),l=new CanvasChart("FL_speed",new CanvasSmaller("smaller-Fleft"),"FLspeed"),d=new CanvasChart("FR_speed",new CanvasSmaller("smaller-Fright"),"FRspeed"),c=new CanvasChart("RL_speed",new CanvasSmaller("smaller-Rleft"),"RLspeed"),g=new CanvasChart("RR_speed",new CanvasSmaller("smaller-Rright"),"RRspeed"),f=new CanvasTrack("track");a=await syncData(t,e,lapChoosed[0].lap,lapChoosed[1].lap),s.setData1(a.delta),s.setData2(null),s.setIsCenterHeight(!0),i.setData1(a.throttle.data1),i.setData2(null),r.setData1(a.brake.data1),r.setData2(null),h.setData1(a.speed.data1),h.setData2(null),n.setData1(a.steer.data1),n.setData2(null),n.setIsCenterHeight(!0),o.setData1(a.gear.data1),o.setData2(null),l.setData1(a.flSpeed.data1),l.setData2(null),d.setData1(a.frSpeed.data1),d.setData2(null),c.setData1(a.rlSpeed.data1),c.setData2(null),g.setData1(a.rrSpeed.data1),g.setData2(null),f.setData1(a.track.data1.x,a.track.data1.y),f.setData2(null),null!=t[1]&&t[1].length>0&&(i.setData2(a.throttle.data2),r.setData2(a.brake.data2),h.setData2(a.speed.data2),n.setData2(a.steer.data2),o.setData2(a.gear.data2),l.setData2(a.flSpeed.data2),d.setData2(a.frSpeed.data2),c.setData2(a.rlSpeed.data2),g.setData2(a.rrSpeed.data2),f.setData2(a.track.data2.x,a.track.data2.y)),f.draw();var p=[s,i,r,h,n,o,l,d,c,g];f.setAllCharts(p);for(var u=0;u<p.length;u++)p[u].setMaxLength(a.length),p[u].draw(0,p[u].getMaxPointsToDraw()),p[u].onHoverDrawLineOnAll(p),p[u].setCanvasTrack(f);initSliderRange(1,a.length-CanvasChart._WIDTH+20,p),initSliderScaleX(p)}async function syncData(t,e,a,s){var i=t[0][a].getLength(),r=null!=t[1]?t[1][s].getLength():0,h={length:0,distance:new Float32Array(i),delta:new Float32Array(i),distMeters:new Uint32Array(i),currentSeconds:{data1:new Float32Array(i),data2:new Float32Array(r)},throttle:{data1:new Float32Array(i),data2:new Float32Array(r)},brake:{data1:new Float32Array(i),data2:new Float32Array(r)},speed:{data1:new Float32Array(i),data2:new Float32Array(r)},steer:{data1:new Float32Array(i),data2:new Float32Array(r)},gear:{data1:new Float32Array(i),data2:new Float32Array(r)},flSpeed:{data1:new Float32Array(i),data2:new Float32Array(r)},frSpeed:{data1:new Float32Array(i),data2:new Float32Array(r)},rlSpeed:{data1:new Float32Array(i),data2:new Float32Array(r)},rrSpeed:{data1:new Float32Array(i),data2:new Float32Array(r)},track:{data1:{lat:new Float32Array(i),lon:new Float32Array(i),x:new Int32Array(i),y:new Int32Array(i)},data2:{lat:new Float32Array(r),lon:new Float32Array(r),x:new Int32Array(r),y:new Int32Array(r)}}},n=565,o=0;if(0==r)for(let s=0;s<i;s++){h.distMeters[o]=t[0][a].getLapDist(s),h.delta[o]=0,h.throttle.data1[o]=t[0][a].getThrottle(s),h.brake.data1[o]=t[0][a].getBrake(s),h.speed.data1[o]=t[0][a].getSpeed(s),h.steer.data1[o]=t[0][a].getSteer(s),h.gear.data1[o]=t[0][a].getGear(s)/7,h.track.data1.lat[o]=e[0][a].getLat(s),h.track.data1.lon[o]=e[0][a].getLon(s);var l=e[0][a].getLonLimit().min,d=e[0][a].getLonLimit().max,c=e[0][a].getLatLimit().min,g=e[0][a].getLatLimit().max,f=(e[0][a].getLon(s)-l)*(300/(d-l)),p=n-(e[0][a].getLat(s)-c)*(n/(g-c));h.track.data1.x[o]=parseInt(f),h.track.data1.y[o]=parseInt(p),o++}var u=0;for(let x=0;x<i&&0!=r;x++){var m=t[0][a].getLapDist(x);for(let i=0;i<r;i++){var v=t[1][s].getLapDist(i);if(m==v){u=i,v==t[1][s].getLapDist(i+1)&&(u=i+1),v==t[1][s].getLapDist(i+2)&&(u=i+2),h.distMeters[o]=m,h.delta[o]=t[0][a].getLapCurrentTimeSecond(x)-t[1][s].getLapCurrentTimeSecond(u),h.throttle.data1[o]=t[0][a].getThrottle(x),h.throttle.data2[o]=t[1][s].getThrottle(u),h.brake.data1[o]=t[0][a].getBrake(x),h.brake.data2[o]=t[1][s].getBrake(u),h.speed.data1[o]=t[0][a].getSpeed(x),h.speed.data2[o]=t[1][s].getSpeed(u),h.steer.data1[o]=t[0][a].getSteer(x),h.steer.data2[o]=t[1][s].getSteer(u),h.gear.data1[o]=t[0][a].getGear(x)/7,h.gear.data2[o]=t[1][s].getGear(u)/7,h.flSpeed.data1[o]=t[0][a].getFLspeed(x),h.flSpeed.data2[o]=t[1][s].getFLspeed(u),h.frSpeed.data1[o]=t[0][a].getFRspeed(x),h.frSpeed.data2[o]=t[1][s].getFRspeed(u),h.rlSpeed.data1[o]=t[0][a].getRLspeed(x),h.rlSpeed.data2[o]=t[1][s].getRLspeed(u),h.rrSpeed.data1[o]=t[0][a].getRRspeed(x),h.rrSpeed.data2[o]=t[1][s].getRRspeed(u),h.track.data1.lat[o]=e[0][a].getLat(x),h.track.data1.lon[o]=e[0][a].getLon(x),h.track.data2.lat[o]=e[1][s].getLat(u),h.track.data2.lon[o]=e[1][s].getLon(u);l=e[0][a].getLonLimit().min,d=e[0][a].getLonLimit().max,c=e[0][a].getLatLimit().min,g=e[0][a].getLatLimit().max,f=(e[0][a].getLon(x)-l)*(300/(d-l)),p=n-(e[0][a].getLat(x)-c)*(n/(g-c));h.track.data1.x[o]=f,h.track.data1.y[o]=p;l=e[1][s].getLonLimit().min,d=e[1][s].getLonLimit().max,c=e[1][s].getLatLimit().min,g=e[1][s].getLatLimit().max,f=(e[1][s].getLon(u)-l)*(300/(d-l)),p=n-(e[1][s].getLat(u)-c)*(n/(g-c));h.track.data2.x[o]=f,h.track.data2.y[o]=p,o++;break}if(m<v)break}}return h.length=o+1,h}