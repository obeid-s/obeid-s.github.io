class t{constructor(t,e){this.smallCanvas=new a(t,e);var s=document.getElementById(t),i=s.clientWidth,r=s.clientHeight,n=s.parentElement;s.remove(),this.canvas=document.createElement("canvas"),this.canvas.id=t,this.canvas.className="main-canvas",this.canvas.width=i,this.canvas.height=r,n.appendChild(this.canvas),this.offsetX=25,this.offsetY=25,this.xPosAt=0,this.stepsX=0,this.isTranslateCenter=!1,this.ctx=this.canvas.getContext("2d"),this.titleText=e,this.data=new Array(2),this.currentIndexAt=new Array(2),this.startMetersIndex=0,this.endMetersIndex=0,this.lineColorMainData="rgb(31, 7, 102)",this.lineColorComparedData="rgb(102, 2, 2)",this.lineWidth=1.5,this.boxWidth=38,"Speed"==this.titleText&&(this.boxWidth=54),"Gear"==this.titleText&&(this.boxWidth=22)}clear(){this.data=new Array(2),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.closePath(),this.startMetersIndex=0,this.endMetersIndex=0}setLap(t,e){t>=2?console.log("Error: You Cannot Set More Than 2 data Laps!"):(this.data[t]=e,this.startMetersIndex=0,this.endMetersIndex=null!=this.data[0]?this.data[0].length:this.data[1].length,this.draw())}setStartEndIndex(t,e){this.startMetersIndex=t,this.endMetersIndex=e,this.draw()}setIsTranslateCenter(t){this.isTranslateCenter=t}getCanvas(){return this.canvas}getCurrentIndexAt(t){return this.currentIndexAt[t]}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}drawTextTitle(){this.ctx.font="bold 26px Arial",this.ctx.fillStyle="rgba(130, 17, 49, 0.5)",this.ctx.fillText(this.titleText,25,25)}drawBaseLines(){this.ctx.strokeStyle="rgba(0, 0, 0, 0.2)";var t=(this.canvas.height-this.offsetY)/5;this.ctx.beginPath();for(var e=t;e<this.canvas.height;e+=t)this.ctx.moveTo(this.offsetX,e),this.ctx.lineTo(this.canvas.width,e);this.ctx.stroke(),this.ctx.strokeStyle="rgba(0, 0, 0, 0.8)",this.ctx.beginPath(),this.ctx.moveTo(this.offsetX,5),this.ctx.lineTo(this.offsetX,this.canvas.height-this.offsetY),this.ctx.stroke()}drawCircleOnHoveredPoint(t){this.ctx.beginPath(),this.ctx.fillStyle=0==t?this.lineColorMainData:this.lineColorComparedData;var e=this.currentIndexAt[t],a=-(this.canvas.height-(this.offsetY+5));this.isTranslateCenter&&(a/=2);var s=this.data[t][e]*a;this.ctx.arc(this.xPosAt+this.offsetX,s,4,0,2*Math.PI),this.ctx.fill()}drawBoxData(t){var e=this.currentIndexAt[t];this.ctx.beginPath(),this.ctx.fillStyle=0==t?this.lineColorMainData:this.lineColorComparedData;var a=this.xPosAt+this.offsetX;a>this.canvas.width/2&&(a-=this.boxWidth);var s=-this.canvas.height/2;this.isTranslateCenter&&(s=0),1==t&&(s+=16),this.ctx.fillRect(a,s,this.boxWidth,14),this.ctx.beginPath(),this.ctx.font="bold 12px Arial",this.ctx.fillStyle="rgba(255, 255, 255, 1.0)";var i=this.extractOriginData(t,e);this.ctx.fillText(i,a+2,s+12)}extractOriginData(t,e){switch(this.titleText){case"Delta":return null!=this.data[t][e]?this.data[t][e].toFixed(2)+"s":"0.00s";case"Throttle":case"Brake":return(100*this.data[t][e]).toFixed(0)+"%";case"Gear":return Math.round(8*this.data[t][e]);case"Speed":return Math.round(320*this.data[t][e])+"km/h";default:return this.data[t][e].toFixed(1)}}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBaseLines(),this.drawTextTitle(),this.ctx.save(),this.isTranslateCenter?(this.ctx.translate(0,(this.canvas.height-this.offsetY)/2),this.ctx.strokeStyle="rgba(0, 0, 0, 0.8)",this.ctx.moveTo(this.offsetX,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.stroke()):this.ctx.translate(0,this.canvas.height-this.offsetY),this.ctx.lineWidth=this.lineWidth;for(var t=0,e=0;e<this.data.length;e++)if(null!=this.data[e]&&null!=this.data[e]){this.ctx.strokeStyle=0==e?this.lineColorMainData:this.lineColorComparedData,this.ctx.beginPath(),t=Math.abs(this.startMetersIndex-this.endMetersIndex),this.stepsX=(this.canvas.width-this.offsetX)/t;var a=this.stepsX,s=0,i=this.data[e][this.startMetersIndex]*-(this.canvas.height-(this.offsetY+5)),r=0;r=this.isTranslateCenter?-(this.canvas.height-(this.offsetY+5))/2:-(this.canvas.height-(this.offsetY+5)),this.ctx.moveTo(this.offsetX+s,i);for(var n=this.startMetersIndex+1;n<this.endMetersIndex;n++){var h=this.data[e][n]*r;this.ctx.lineTo(this.offsetX+a,h),s=a,i=h,a+=this.stepsX}this.ctx.stroke()}for(e=0;e<this.data.length;e++)null!=this.data[e]&&null!=this.data[e]&&(this.currentIndexAt[e]=Math.round(this.xPosAt/(this.canvas.width-this.offsetX)*t)+this.startMetersIndex,this.drawCircleOnHoveredPoint(e),this.drawBoxData(e),this.smallCanvas.putCurrentData(e,this.data[e][this.currentIndexAt[e]]));this.smallCanvas.draw(),this.ctx.restore()}}class e{constructor(t){this.lapNumber=t,this.airTemp=0,this.trackTemp=0;var e=2e4;this.LapDistPct=new Float32Array(e),this.lapDistMeters=new Float32Array(e),this.lapDistMetersInt=new Uint32Array(e),this.lapCurrentTimeSeconds=new Float32Array(e),this.throttle=new Float32Array(e),this.brake=new Float32Array(e),this.speedKmh=new Float32Array(e),this.gear=new Float32Array(e),this.steer=new Float32Array(e),this.cFSRrideHeight=new Float32Array(e),this.trackCoordinate=new r(t,e),this.lapTimeStr="",this.index=0,this.size=0,this.dataLapToCompare=null,this.differentTimeBetweenTwoData=null}setDataLapToCompare(t){this.dataLapToCompare=t}runSyncLaps(){if(null==this.dataLapToCompare)return console.log("No data lap to compare!"),this;var t=new Array(2);t[0]=new e(1),t[1]=new e(2);new Array(this.size);for(var a=0;a<this.size;a++)for(var s=1;s<this.dataLapToCompare.size;){if(this.lapDistMetersInt[a]==this.dataLapToCompare.lapDistMetersInt[s]){var i=this.dataLapToCompare,r=Math.abs(this.lapDistMeters[a]-i.lapDistMeters[s]),n=Math.abs(this.lapDistMeters[a]-i.lapDistMeters[s+1]),h=Math.abs(this.lapDistMeters[a]-i.lapDistMeters[s-1]);n<=r&&n<=h&&(s+=1),h<=r&&h<=n&&(s-=1);var o=this.lapCurrentTimeSeconds[a]-i.lapCurrentTimeSeconds[s];t[0].addLapCurrentTimeSeconds(o),t[1].addLapCurrentTimeSeconds(0),t[0].addLapDistPct(this.LapDistPct[a]),t[0].addLapDistMeters(this.lapDistMeters[a]),t[0].addLapDistMetersInt(this.lapDistMetersInt[a]),t[0].addThrottle(this.throttle[a]),t[0].addBrake(this.brake[a]),t[0].addSpeedKmh(this.speedKmh[a]),t[0].addGear(this.gear[a]),t[0].addSteer(this.steer[a]),t[0].trackCoordinate.addLat(this.trackCoordinate.lat[a]),t[0].trackCoordinate.addLon(this.trackCoordinate.lon[a]),t[1].addLapDistPct(i.LapDistPct[s]),t[1].addLapDistMeters(i.lapDistMeters[s]),t[1].addLapDistMetersInt(i.lapDistMetersInt[s]),t[1].addThrottle(i.throttle[s]),t[1].addBrake(i.brake[s]),t[1].addSpeedKmh(i.speedKmh[s]),t[1].addGear(i.gear[s]),t[1].addSteer(i.steer[s]),t[1].trackCoordinate.addLat(i.trackCoordinate.lat[s]),t[1].trackCoordinate.addLon(i.trackCoordinate.lon[s]),t[0].updateIndex(),t[0].updateSize(),t[0].trackCoordinate.updateIndex(),t[0].trackCoordinate.updateSize(),t[1].updateIndex(),t[1].updateSize(),t[1].trackCoordinate.updateIndex(),t[1].trackCoordinate.updateSize();break}s++}for(a=0;a<t.length;a++)t[a].optimizeArraySize();return t}getDataLapToCompare(){return this.dataLapToCompare}getLapTimeStr(){return this.lapTimeStr}getAirTemp(){return this.airTemp}getTrackTemp(){return this.trackTemp}getLapDistPctArray(){return this.LapDistPct}getLapCurrentTimeSecondsArray(){return this.lapCurrentTimeSeconds}getLapCurrentTimeSeconds(t){return this.lapCurrentTimeSeconds[t]}getThrottleArray(){return this.throttle}getBrakeArray(){return this.brake}getSpeedKmhArray(){return this.speedKmh}getGearArray(){return this.gear}getSteerArray(){return this.steer}getCFSRrideHeightArray(){return this.cFSRrideHeight}getLapDistMetersArray(){return this.lapDistMeters}getLapDistMetersIntArray(){return this.lapDistMetersInt}getThrottle(t){return this.throttle[t]}getLapDistMeters(t){return this.lapDistMeters[t]}getLapDistMetersInt(t){return this.lapDistMetersInt[t]}updateIndex(){this.index+=1}updateSize(){this.size+=1}optimizeArraySize(){this.LapDistPct=this.LapDistPct.slice(0,this.size),this.lapDistMeters=this.lapDistMeters.slice(0,this.size),this.lapDistMetersInt=this.lapDistMetersInt.slice(0,this.size),this.lapCurrentTimeSeconds=this.lapCurrentTimeSeconds.slice(0,this.size),this.throttle=this.throttle.slice(0,this.size),this.brake=this.brake.slice(0,this.size),this.speedKmh=this.speedKmh.slice(0,this.size),this.gear=this.gear.slice(0,this.size),this.steer=this.steer.slice(0,this.size),this.cFSRrideHeight=this.cFSRrideHeight.slice(0,this.size),this.trackCoordinate.lat=this.trackCoordinate.lat.slice(0,this.size),this.trackCoordinate.lon=this.trackCoordinate.lon.slice(0,this.size)}setAirTemp(t){this.airTemp=t}setTrackTemp(t){this.trackTemp=t}addLapCurrentTimeSeconds(t){this.lapCurrentTimeSeconds[this.index]=t}addLapDistPct(t){this.LapDistPct[this.index]=t}addLapDistMeters(t){this.lapDistMeters[this.index]=t}addLapDistMetersInt(t){this.lapDistMetersInt[this.index]=t}addThrottle(t){this.throttle[this.index]=t}addBrake(t){this.brake[this.index]=t}addSpeedKmh(t){this.speedKmh[this.index]=t}addGear(t){this.gear[this.index]=t}addSteer(t){this.steer[this.index]=t}addcFSRrideHeight(t){this.cFSRrideHeight[this.index]=t}setLapTimeSeconds(t){var e=this.lapCurrentTimeSeconds[this.size-1],a=Math.floor(e/60),s=e%60;this.lapTimeStr=a+":"+s.toFixed(4)}}class a{constructor(t,e){this.titleText=e;var a="small-"+t,s=document.getElementById(a),i=s.clientWidth,r=s.clientHeight,n=s.parentElement;s.remove(),this.canvas=document.createElement("canvas"),this.canvas.id=a,this.canvas.className="small-canvas",this.canvas.width=i,this.canvas.height=r,n.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.currentData=new Array(2),this.lineColorMainData="rgb(31, 7, 102)",this.lineColorComparedData="rgb(102, 2, 2)"}putCurrentData(t,e){t>=2?console.log("Error: Could not add more than 2 data in small canvas!"):this.currentData[t]=e}drawThrottleBrake(t){var e=0==t?38:62,a=this.canvas.height-40;this.ctx.beginPath(),this.ctx.lineWidth=2,this.ctx.strokeStyle=0==t?this.lineColorMainData:this.lineColorComparedData,this.ctx.strokeRect(e,20,20,a),this.ctx.beginPath(),this.ctx.fillStyle="Throttle"==this.titleText?"rgba(0, 165, 0, 1.0)":"rgba(165, 0, 0, 1.0)",this.ctx.fillRect(e,20+a,20,-a*this.currentData[t]),this.ctx.beginPath(),this.ctx.fillStyle=0==t?this.lineColorMainData:this.lineColorComparedData,this.ctx.arc(e+10,this.canvas.height-10,8,0,2*Math.PI),this.ctx.fill()}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var t=0;t<this.currentData.length;t++)if(null!=this.currentData[t])switch(this.titleText){case"Throttle":case"Brake":this.drawThrottleBrake(t)}}}class s{constructor(t){this.file=t,this.header={},this.diskHeader={},this.varsHeader=[],this.dataLaps=null,this.data=null}getHeader(){return this.header}getDiskHeader(){return this.diskHeader}getVarsHeader(){return this.varsHeader}getData(){return this.data}getDataLaps(){return this.dataLaps}getOneDataLap(t){return this.dataLaps[t]}isValid(){return null!=this.file}read(){if(this.isValid()){var t=this;return new Promise((function(e,a){var s=new FileReader;s.onloadend=function(a){t.extractData(a.target.result),e(a.target.result)},s.onerror=function(t){a(t.target.error.message)},s.readAsArrayBuffer(t.file)}))}}extractData(t){var e=new DataView(t,0,112);this.header.version=e.getUint32(0,!0),this.header.status=e.getUint32(4,!0),this.header.tick_rate=e.getUint32(8,!0),this.header.session_info_update=e.getUint32(12,!0),this.header.session_info_offset=e.getUint32(16,!0),this.header.session_info_length=e.getUint32(20,!0),this.header.num_vars=e.getUint32(24,!0),this.header.var_header_offset=e.getUint32(28,!0),this.header.num_buf=e.getUint32(32,!0),this.header.buf_len=e.getUint32(36,!0),this.header.buf_offset=e.getUint32(52,!0);var a=new DataView(t,112,32);this.diskHeader.start_date=a.getFloat64(0,!0),this.diskHeader.start_time=a.getFloat64(8,!0),this.diskHeader.end_time=a.getFloat64(16,!0),this.diskHeader.lap_count=a.getUint32(24,!0),this.diskHeader.record_count=a.getUint32(28,!0);for(var s=new DataView(t,this.header.var_header_offset,144*this.header.num_vars),i=0,r=0;r<this.header.num_vars;r++)this.varsHeader.push({type:s.getUint32(i+0,!0),offset:s.getUint32(i+4,!0),count:s.getUint32(i+8,!0),count_as_time:s.getUint8(i+12,!0),name:this.convertToString(s,i+16,i+16+32),desc:this.convertToString(s,i+48,i+48+64),unit:this.convertToString(s,i+112,i+112+32)}),i+=144;this.data=new Uint8Array(t.slice(this.header.buf_offset)),this.loadDataLaps()}print(){console.log(this.header),console.log(this.diskHeader),console.log(this.varsHeader),console.log("Data Length:",this.data.length)}convertToString(t,e,a){for(var s="",i=a-e,r=0;r<i;r++){s+=0==t.getUint8(r+e)?"":String.fromCharCode(t.getUint8(r+e))}return s}loadDataLaps(){for(var t=new Array(this.diskHeader.lap_count),a=1;a<=this.diskHeader.lap_count;a++)t[a-1]=new e(a);for(var s=this.data.length/this.header.buf_len,i=0,r=this.getHeaderData("Lap",0).content,n=0,h=0,o=0,l=0;l<s;l++){if((i=this.getHeaderData("Lap",l).content)!=r){if(t[o].setLapTimeSeconds(0),t[o].optimizeArraySize(),h+1>=this.diskHeader.lap_count)break;h++}var d=this.getHeaderData("LapDistPct",l).content,c=parseFloat(this.getHeaderData("LapDist",l).content),g=parseInt(c),p=this.getHeaderData("AirTemp",l).content.toFixed(1),u=this.getHeaderData("TrackTemp",l).content.toFixed(1),v=0;g>160&&(v=parseFloat(this.getHeaderData("LapCurrentLapTime",l).content));var f=this.getHeaderData("Throttle",l).content,x=this.getHeaderData("Brake",l).content,m=(3600*this.getHeaderData("Speed",l).content/1e3/320).toFixed(3),T=(this.getHeaderData("Gear",l).content/8).toFixed(1),C=this.getHeaderData("SteeringWheelAngle",l).content,L=this.getHeaderData("CFSRrideHeight",l).content,k=this.getHeaderData("Lat",l).content,D=this.getHeaderData("Lon",l).content;t[h].setAirTemp(p),t[h].setTrackTemp(u),t[h].addLapCurrentTimeSeconds(v),t[h].addLapDistPct(d),t[h].addLapDistMeters(c),t[h].addLapDistMetersInt(g),t[h].addThrottle(f),t[h].addBrake(x),t[h].addSpeedKmh(m),0==T&&(T=n),t[h].addGear(T),t[h].addSteer(C),t[h].addcFSRrideHeight(L),t[h].trackCoordinate.addLat(k),t[h].trackCoordinate.addLon(D),t[h].updateSize(),t[h].updateIndex(),t[h].trackCoordinate.updateSize(),t[h].trackCoordinate.updateIndex(),r=i,o=h,n=T}t[h].setLapTimeSeconds(0),t[h].optimizeArraySize(),this.dataLaps=t}getHeaderData(t,e){for(var a=null,s=0;s<this.varsHeader.length;s++)if(this.varsHeader[s].name==t){a=this.varsHeader[s];break}if(null!=a){var i=e*this.header.buf_len+a.offset;switch(a.type){case 0:a.content_type="string";var r=this.data.slice(i,i+8),n="";for(s=0;s<8;s++){n+=0==r[s]?"":String.fromCharCode(r[s])}a.content=n,8;break;case 1:a.content_type="boolean";r=this.data.slice(i,i+1);a.content=255&r,1;break;case 2:a.content_type="int32";var h=4294967295&((r=this.data.slice(i,i+4))[0]|r[1]<<8|r[2]<<16|r[3]<<24);a.content=h,4;break;case 3:h=4294967295&((r=this.data.slice(i,i+4))[0]|r[1]<<8|r[2]<<16|r[3]<<24);a.content_type="uint32",a.content=h,4;break;case 4:a.content_type="float32";r=this.data.slice(i,i+4);var o=new ArrayBuffer(4);(l=new DataView(o)).setUint8(0,r[0]),l.setUint8(1,r[1]),l.setUint8(2,r[2]),l.setUint8(3,r[3]),a.content=l.getFloat32(0,!0),4;break;case 5:a.content_type="float64";var l;r=this.data.slice(i,i+8),o=new ArrayBuffer(8);(l=new DataView(o)).setInt8(0,r[0]),l.setInt8(1,r[1]),l.setInt8(2,r[2]),l.setInt8(3,r[3]),l.setInt8(4,r[4]),l.setInt8(5,r[5]),l.setInt8(6,r[6]),l.setInt8(7,r[7]),a.content=l.getFloat64(0,!0),8;break;default:console.log("default")}return a}console.log("Could not find this var header!")}}class i{constructor(){var t="track-canvas",e=document.getElementById(t),a=e.clientWidth,s=e.clientHeight,i=e.parentElement;e.remove(),this.canvas=document.createElement("canvas"),this.canvas.id=t,this.canvas.width=a,this.canvas.height=s,i.appendChild(this.canvas),this.widthForTrack=this.canvas.width-100,this.heightForTrack=this.canvas.height-80,this.ctx=this.canvas.getContext("2d"),this.currentIndexAt=0,this.trackCoordinates=new Array(2),this.steerAngles=new Array(2),this.steerImgs=new Array(2),this.steerImgs[0]=document.getElementById("steeringWheel1"),this.steerImgs[1]=document.getElementById("steeringWheel2"),this.xTranslate=0,this.yTranslate=0,this.zoom=1,this.trackLineColorMain="rgb(31, 7, 252, 1.0)",this.trackLineColorCompared="rgba(252, 31, 7, 1.0)",this.drawTestLines(),this.activeMoveTrack()}setZoom(t){this.zoom=t}setTranslate(t,e){this.xTranslate=t,this.yTranslate=e}setTrackCoordinates(t,e){t>=2?console.log("Error: You Cannot Set More Than 2 data Laps!"):this.trackCoordinates[t]=e}setSteerAngles(t,e){t>=2?console.log("Error: You Cannot Set More Than 2 data Laps!"):this.steerAngles[t]=e}updateCurrentIndexAt(t){this.currentIndexAt=t,this.draw()}activeMoveTrack(){var t=this,e=!1,a=0,s=0;this.canvas.addEventListener("mousedown",(function(i){null==t.trackCoordinates[0]&&null==t.trackCoordinates[1]||(a=i.pageX-t.xTranslate,s=i.pageY-t.yTranslate,e=!0)})),this.canvas.addEventListener("mousemove",(function(i){e&&(t.xTranslate=i.pageX-a,t.yTranslate=i.pageY-s,t.draw())})),this.canvas.addEventListener("mouseup",(function(){e&&(e=!1)})),this.canvas.addEventListener("mouseout",(function(){e&&(e=!1)}));this.canvas.addEventListener("wheel",(function(e){if(null!=t.trackCoordinates[0]||null!=t.trackCoordinates[1]){e.preventDefault();var a=1;a="Up"==(e.deltaY>0?"Down":"Up")?t.zoom+.1:t.zoom-.1,t.zoom=a,t.draw()}}))}convertLatLonToCanvas(t,e){var a=this.trackCoordinates[t];return{x:(a.lon[e]-a.minLon)*(this.widthForTrack/(a.maxLon-a.minLon)),y:this.heightForTrack-(a.lat[e]-a.minLat)*(this.heightForTrack/(a.maxLat-a.minLat))}}drawTestLines(){this.ctx.strokeStyle="rgba(255, 255, 255, 1.0)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.stroke()}drawCircleOnTrack(){this.ctx.beginPath(),this.ctx.fillStyle="rgb(255, 255, 255)";var t=this.convertLatLonToCanvas(0,this.currentIndexAt);this.ctx.arc(t.x,t.y,4,0,2*Math.PI),this.ctx.fill()}drawSteerAngles(){if(null!=this.steerAngles[0]||null!=this.steerAngles[1])for(var t=10,e=this.canvas.width-90,a=0;a<this.steerAngles.length;a++)null!=this.steerAngles[a]&&(t=t+80*a+5,this.ctx.beginPath(),this.ctx.save(),this.ctx.translate(e+40,t+40),this.ctx.rotate(-this.steerAngles[a][this.currentIndexAt]),this.ctx.drawImage(this.steerImgs[a],-40,-40,80,80),this.ctx.restore(),this.ctx.fillStyle=0==a?this.trackLineColorMain:this.trackLineColorCompared,this.ctx.arc(e+40,t+40,8,0,2*Math.PI),this.ctx.fill())}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.translate(this.xTranslate,this.yTranslate),this.ctx.scale(this.zoom,this.zoom),this.ctx.lineWidth=1;for(let r=0;r<this.trackCoordinates.length;r++)if(null!=this.trackCoordinates[r]&&null!=this.trackCoordinates[r]){var t=this.trackCoordinates[r],e=this.convertLatLonToCanvas(r,0);this.ctx.strokeStyle=0==r?this.trackLineColorMain:this.trackLineColorCompared;var a=e.x,s=e.y;this.ctx.beginPath();for(var i=1;i<t.size;i++)e=this.convertLatLonToCanvas(r,i),this.ctx.moveTo(a,s),a=e.x,s=e.y,e.x*this.zoom-5+this.xTranslate>this.canvas.width||e.x*this.zoom+this.xTranslate<-5||e.y*this.zoom-5+this.yTranslate>this.canvas.height||e.y*this.zoom+this.yTranslate<-5||this.ctx.lineTo(e.x,e.y);this.ctx.stroke()}this.drawCircleOnTrack(),this.ctx.restore(),this.drawSteerAngles()}}class r{constructor(t,e){this.lapNum=t,this.lat=new Float32Array(e),this.lon=new Float32Array(e),this.minLat=9999,this.maxLat=-9999,this.minLon=9999,this.maxLon=-9999,this.size=0,this.index=0}updateSize(){this.size+=1}updateIndex(){this.index+=1}addLat(t){this.lat[this.index]=t,this.minLat>t&&(this.minLat=t),this.maxLat<t&&(this.maxLat=t)}addLon(t){this.lon[this.index]=t,this.minLon>t&&(this.minLon=t),this.maxLon<t&&(this.maxLon=t)}getLatArray(){return this.lat}getLonArray(){return this.lon}}var n=document.getElementById("form_data");null==n&&console.log("Error: Could not find the form to upload");var h=document.querySelector(".loading_div");function o(){h.style.display="none"}var l=new Array(2),d=new Array(5),c=new class{constructor(){this.allCanvases=[],this.TrackCanvas=new i,this.isMouseDown=!1,this.xData=new Array(2),this.MAX_SELECTION=400}addCanvas(t){this.allCanvases.push(t)}clearAllCanvas(){this.allCanvases=[],this.TrackCanvas=new i}getTrackCanvas(){return this.TrackCanvas}setXData(t,e){this.xData[t]=e}activeOnMouseMove(){var t=this;for(let e=0;e<this.allCanvases.length;e++)this.allCanvases[e].getCanvas().onmousemove=function(e){for(let a=0;a<t.allCanvases.length;a++)t.canvasOnMouseMove(e,t.allCanvases[a],t)},this.allCanvases[e].getCanvas().onmousedown=function(a){for(let s=0;s<t.allCanvases.length;s++)t.canvasOnMouseDown(a,t.allCanvases[e])}}canvasOnMouseMove(t,e,a){if(e.xPosAt=t.offsetX-e.getOffsetX(),!(e.xPosAt<0)){e.draw(),e.ctx.strokeStyle="rgba(130, 17, 49, 0.5)",e.ctx.lineWidth=1,e.ctx.beginPath(),e.ctx.moveTo(t.offsetX,0),e.ctx.lineTo(t.offsetX,e.getCanvas().height-e.getOffsetY()),e.ctx.stroke(),e.ctx.fillStyle="rgba(255, 255, 255, 1.0)";var s=a.xData[0][e.getCurrentIndexAt(0)];e.ctx.font="bold 12px Arial",e.ctx.fillStyle="rgba(130, 17, 49, 0.8)",e.ctx.fillText(s+"m",t.offsetX-10,e.getCanvas().height-10),a.TrackCanvas.updateCurrentIndexAt(e.getCurrentIndexAt(0))}}canvasOnMouseDown(t,e){var a=t.offsetX,s=e.getCurrentIndexAt(0),i=0;a-e.getOffsetX()<0&&(a=0),this.isMouseDown=!0;var r=this;window.onmousemove=function(t){if(r.isMouseDown&&!(t.offsetX-e.getOffsetX()<0)){var s=t.offsetX-a;i=e.getCurrentIndexAt(0),r.highlightsSelectedPart(a,s)}},window.onmouseup=function(){if(r.isMouseDown){if(s+i!=s&&Math.abs(s-i)>r.MAX_SELECTION){if(s>i){var t=s;s=i,i=t}for(var e=0;e<r.allCanvases.length;e++)r.allCanvases[e].setStartEndIndex(s,i)}r.isMouseDown=!1}}}highlightsSelectedPart(t,e){for(var a=0;a<this.allCanvases.length;a++){var s=this.allCanvases[a].ctx;s.beginPath(),s.fillStyle="rgba(26, 55, 84, 0.2)",s.fillRect(t,0,e,this.allCanvases[a].getCanvas().height)}}},g={lap1:-1,lap2:-1};function p(){d[0]=new t("delta","Delta"),d[0].setIsTranslateCenter(!0),d[1]=new t("throttle","Throttle"),d[2]=new t("brake","Brake"),d[3]=new t("speed","Speed"),d[4]=new t("gear","Gear"),c.clearAllCanvas();for(var e=0;e<d.length;e++)d[e].clear(),c.addCanvas(d[e]);c.activeOnMouseMove()}function u(t){for(var e=document.querySelectorAll(t),a=0;a<e.length;a++)e[a].className=""}function v(t){p();var e=parseInt(t.parentElement.getAttribute("data-file-index")),a=parseInt(t.getAttribute("data-lap"));0==e?(u(".ul-laps1 li"),g.lap1=a,t.className="selectedFile1"):(u(".ul-laps2 li"),g.lap2=a,t.className="selectedFile2"),function(){if(l[0].isValid()&&-1!=g.lap1&&-1==g.lap2){var t=l[0].getOneDataLap(g.lap1);d[1].setLap(0,t.getThrottleArray()),d[2].setLap(0,t.getBrakeArray()),d[3].setLap(0,t.getSpeedKmhArray()),d[4].setLap(0,t.getGearArray()),c.setXData(0,t.getLapDistMetersIntArray()),c.getTrackCanvas().setTrackCoordinates(0,t.trackCoordinate),c.getTrackCanvas().setSteerAngles(0,t.getSteerArray()),c.getTrackCanvas().draw(),f(0,t.airTemp,t.trackTemp,"0.0N")}if(l[1].isValid()&&-1!=g.lap2&&-1==g.lap1){var e=l[1].getOneDataLap(g.lap2);d[1].setLap(1,e.getThrottleArray()),d[2].setLap(1,e.getBrakeArray()),d[3].setLap(1,e.getSpeedKmhArray()),d[4].setLap(1,e.getGearArray()),c.setXData(1,e.getLapDistMetersIntArray()),c.getTrackCanvas().setTracCoordinates(1,e.trackCoordinate),c.getTrackCanvas().setSteerAngles(1,e.getSteerArray()),c.getTrackCanvas().draw(),f(1,e.airTemp,e.trackTemp,"0.0N")}if(l[0].isValid()&&l[1].isValid()&&g.lap1>-1&&g.lap2>-1){t=l[0].getOneDataLap(g.lap1),e=l[1].getOneDataLap(g.lap2);t.setDataLapToCompare(e);var a=t.runSyncLaps();d[0].setLap(0,a[0].getLapCurrentTimeSecondsArray()),d[1].setLap(0,a[0].getThrottleArray()),d[1].setLap(1,a[1].getThrottleArray()),d[2].setLap(0,a[0].getBrakeArray()),d[2].setLap(1,a[1].getBrakeArray()),d[3].setLap(0,a[0].getSpeedKmhArray()),d[3].setLap(1,a[1].getSpeedKmhArray()),d[4].setLap(0,a[0].getGearArray()),d[4].setLap(1,a[1].getGearArray()),c.setXData(0,a[0].getLapDistMetersIntArray()),c.getTrackCanvas().setTrackCoordinates(0,a[0].trackCoordinate),c.getTrackCanvas().setTrackCoordinates(1,a[1].trackCoordinate),c.getTrackCanvas().setSteerAngles(0,a[0].getSteerArray()),c.getTrackCanvas().setSteerAngles(1,a[1].getSteerArray()),c.getTrackCanvas().draw(),f(0,t.airTemp,t.trackTemp,"0.0N"),f(1,e.airTemp,e.trackTemp,"0.0N")}}()}function f(t,e,a,s){var i=[document.querySelectorAll(".file1Info"),document.querySelectorAll(".file2Info")];if(null==l[t])return i[t][0].innerHTML="0c",i[t][1].innerHTML="0c",void(i[t][2].innerHTML=0);i[t][0].innerHTML=e+"c",i[t][1].innerHTML=a+"c",i[t][2].innerHTML=s}function x(t){if(null==t)return null;for(var e=[],a=0;a<t.length;a++)e.push(t[a].getLapTimeStr());return e}n.addEventListener("submit",(function(t){if(t.preventDefault(),function(){h.style.display="block"}(),(l=new Array(2))[0]=new s(n.file1.files[0]),l[1]=new s(n.file2.files[0]),!l[0].isValid()&&!l[1].isValid())return console.log("no files"),void setTimeout(o,1e3);l[0].isValid()&&l[0].read().then((function(t){})).catch((function(t){console.log(t)}));l[1].isValid()&&l[1].read().then((function(t){})).catch((function(t){console.log(t)}));setTimeout((function(){var t,e,a;p(),t=l[0].getDataLaps(),e=l[1].getDataLaps(),(a=new Array(2))[0]=x(t),a[1]=x(e),function(t){var e=document.querySelector(".ul-laps1");if(e.innerHTML="",null!=t[0])for(var a=0;a<t[0].length;a++)e.innerHTML+="<li data-lap='"+a+"'>"+t[0][a]+"</li>";var s=document.querySelector(".ul-laps2");if(s.innerHTML="",null!=t[1])for(a=0;a<t[1].length;a++)s.innerHTML+="<li data-lap='"+a+"'>"+t[1][a]+"</li>";var i=document.querySelectorAll(".ul-laps1 li"),r=document.querySelectorAll(".ul-laps2 li");for(let t=0;t<i.length;t++)i[t].addEventListener("click",(function(){v(i[t])}));for(let t=0;t<r.length;t++)r[t].addEventListener("click",(function(){v(r[t])}));o()}(a)}),1e3)})),document.getElementById("controller-zoom-out").onclick=function(){for(var t=0;t<d.length;t++)null!=d[t]&&null!=d[t].data[0]&&d[t].setStartEndIndex(0,d[t].data[0].length);c.getTrackCanvas().setZoom(1),c.getTrackCanvas().setTranslate(0,0),c.getTrackCanvas().draw()};