class t{constructor(t,e){this.smallCanvas=new i(t,e);var a=document.getElementById(t),s=a.clientWidth,r=a.clientHeight,n=a.parentElement;a.remove(),this.canvas=document.createElement("canvas"),this.canvas.id=t,this.canvas.className="main-canvas",this.canvas.width=s,this.canvas.height=r,n.appendChild(this.canvas),this.offsetX=25,this.offsetY=25,this.xPosAt=0,this.stepsX=0,this.isTranslateCenter=!1,this.ctx=this.canvas.getContext("2d"),this.titleText=e,this.data=new Array(2),this.currentIndexAt=new Array(2),this.startMetersIndex=0,this.endMetersIndex=0,this.lineColorMainData="rgb(31, 7, 102)",this.lineColorComparedData="rgb(102, 2, 2)",this.lineWidth=1,this.boxWidth=38,"Speed"==this.titleText&&(this.boxWidth=54),"Gear"==this.titleText&&(this.boxWidth=22),this.dataMinMax={oldMin:99999,oldMax:-99999,newMin:99999,newMax:-99999}}clear(){this.data=new Array(2),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.closePath(),this.startMetersIndex=0,this.endMetersIndex=0}setLap(t,e){t>=2?console.log("Error: You Cannot Set More Than 2 data Laps!"):(this.data[t]=e,this.startMetersIndex=0,this.endMetersIndex=null!=this.data[0]?this.data[0].length:this.data[1].length)}setMinMaxData(t,e,i,a){this.dataMinMax.oldMin>t&&(this.dataMinMax.oldMin=t),this.dataMinMax.oldMax<e&&(this.dataMinMax.oldMax=e),this.dataMinMax.newMin>i&&(this.dataMinMax.newMin=i),this.dataMinMax.newMax<a&&(this.dataMinMax.newMax=a)}setStartEndIndex(t,e){this.startMetersIndex=t,this.endMetersIndex=e,this.draw()}setIsTranslateCenter(t){this.isTranslateCenter=t}getCanvas(){return this.canvas}getCurrentIndexAt(t){return this.currentIndexAt[t]}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}drawTextTitle(){this.ctx.font="bold 26px Arial",this.ctx.fillStyle="rgba(130, 17, 49, 0.5)",this.ctx.fillText(this.titleText,25,25)}drawBaseLines(){this.ctx.strokeStyle="rgba(0, 0, 0, 0.2)";var t=(this.canvas.height-this.offsetY)/5;this.ctx.beginPath();for(var e=t;e<this.canvas.height;e+=t)this.ctx.moveTo(this.offsetX,e),this.ctx.lineTo(this.canvas.width,e);this.ctx.stroke(),this.ctx.strokeStyle="rgba(0, 0, 0, 0.8)",this.ctx.beginPath(),this.ctx.moveTo(this.offsetX,5),this.ctx.lineTo(this.offsetX,this.canvas.height-this.offsetY),this.ctx.stroke()}drawCircleOnHoveredPoint(t){this.ctx.beginPath(),this.ctx.fillStyle=0==t?this.lineColorMainData:this.lineColorComparedData;var e=this.currentIndexAt[t],i=-(this.canvas.height-(this.offsetY+5));this.isTranslateCenter&&(i/=2);var a=0;a="CFSRideHeight"==this.titleText||"Left front"==this.titleText||"Right front"==this.titleText||"Left rear"==this.titleText||"Right rear"==this.titleText?i*((this.dataMinMax.newMax-this.dataMinMax.newMin)*(this.data[t][e]-this.dataMinMax.oldMin)/(this.dataMinMax.oldMax-this.dataMinMax.oldMin)+this.dataMinMax.newMin):this.data[t][e]*i,this.ctx.arc(this.xPosAt+this.offsetX,a,4,0,2*Math.PI),this.ctx.fill()}drawBoxData(t){var e=this.currentIndexAt[t];this.ctx.beginPath(),this.ctx.fillStyle=0==t?this.lineColorMainData:this.lineColorComparedData;var i=this.xPosAt+this.offsetX;i>this.canvas.width/2&&(i-=this.boxWidth);var a=-this.canvas.height/2;this.isTranslateCenter&&(a=0),1==t&&(a+=16),this.ctx.fillRect(i,a,this.boxWidth,14),this.ctx.beginPath(),this.ctx.font="bold 12px Arial",this.ctx.fillStyle="rgba(255, 255, 255, 1.0)";var s=this.extractOriginData(t,e);this.ctx.fillText(s,i+2,a+12)}extractOriginData(t,e){switch(this.titleText){case"Delta":return null!=this.data[t][e]?this.data[t][e].toFixed(2)+"s":"0.00s";case"Throttle":case"Brake":return(100*this.data[t][e]).toFixed(0)+"%";case"Gear":return Math.round(8*this.data[t][e]);case"Speed":return Math.round(320*this.data[t][e])+"km/h";case"CFSRideHeight":case"Left front":case"Right front":case"Left rear":case"Right rear":return this.data[t][e].toFixed(4)+"m";default:return this.data[t][e].toFixed(3)}}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBaseLines(),this.drawTextTitle(),this.ctx.save(),this.isTranslateCenter?(this.ctx.translate(0,(this.canvas.height-this.offsetY)/2),this.ctx.strokeStyle="rgba(0, 0, 0, 0.8)",this.ctx.moveTo(this.offsetX,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.stroke()):this.ctx.translate(0,this.canvas.height-this.offsetY),this.ctx.lineWidth=this.lineWidth;for(var t=0,e=0;e<this.data.length;e++)if(null!=this.data[e]&&null!=this.data[e]){this.ctx.strokeStyle=0==e?this.lineColorMainData:this.lineColorComparedData,this.ctx.beginPath(),t=Math.abs(this.startMetersIndex-this.endMetersIndex),this.stepsX=(this.canvas.width-this.offsetX)/t;var i=this.stepsX,a=0;if("CFSRideHeight"==this.titleText||"Left front"==this.titleText||"Right front"==this.titleText||"Left rear"==this.titleText||"Right rear"==this.titleText)var s=((this.dataMinMax.newMax-this.dataMinMax.newMin)*(this.data[e][h]-this.dataMinMax.oldMin)/(this.dataMinMax.oldMax-this.dataMinMax.oldMin)+this.dataMinMax.newMin)*-(this.canvas.height-(this.offsetY+5));else s=this.data[e][this.startMetersIndex]*-(this.canvas.height-(this.offsetY+5));var r=0;r=this.isTranslateCenter?-(this.canvas.height-(this.offsetY+5))/2:-(this.canvas.height-(this.offsetY+5)),this.ctx.moveTo(this.offsetX+a,s);for(var n=0,h=this.startMetersIndex+1;h<this.endMetersIndex;h++)n="CFSRideHeight"==this.titleText||"Left front"==this.titleText||"Right front"==this.titleText||"Left rear"==this.titleText||"Right rear"==this.titleText?r*((this.dataMinMax.newMax-this.dataMinMax.newMin)*(this.data[e][h]-this.dataMinMax.oldMin)/(this.dataMinMax.oldMax-this.dataMinMax.oldMin)+this.dataMinMax.newMin):this.data[e][h]*r,this.ctx.lineTo(this.offsetX+i,n),a=i,s=n,i+=this.stepsX;this.ctx.stroke()}for(e=0;e<this.data.length;e++)null!=this.data[e]&&null!=this.data[e]&&(this.currentIndexAt[e]=Math.round(this.xPosAt/(this.canvas.width-this.offsetX)*t)+this.startMetersIndex,this.drawCircleOnHoveredPoint(e),this.drawBoxData(e),this.smallCanvas.isCanvasValid&&this.smallCanvas.putCurrentData(e,this.data[e][this.currentIndexAt[e]]));this.smallCanvas.isCanvasValid&&this.smallCanvas.draw(),this.ctx.restore()}}class e{constructor(t){this.lapNumber=t,this.airTemp=0,this.trackTemp=0,this.windSpeed=0;var e=2e4;this.LapDistPct=new Float32Array(e),this.lapDistMeters=new Float32Array(e),this.lapDistMetersInt=new Uint32Array(e),this.lapCurrentTimeSeconds=new Float32Array(e),this.throttle=new Float32Array(e),this.brake=new Float32Array(e),this.speedKmh=new Float32Array(e),this.gear=new Float32Array(e),this.steer=new Float32Array(e),this.windDir=new Float32Array(e),this.windVel=new Float32Array(e),this.fuelLevel=new Float32Array(e),this.cFSRrideHeight=new Float32Array(e),this.minCFSRideHeight=9999,this.maxCFSRideHeight=-9999,this.lFRideHeight=new Float32Array(e),this.minLFRideHeight=9999,this.maxLFRideHeight=-9999,this.rFRideHeight=new Float32Array(e),this.minRFRideHeight=9999,this.maxRFRideHeight=-9999,this.lRRideHeight=new Float32Array(e),this.minLRRideHeight=9999,this.maxLRRideHeight=-9999,this.rRRideHeight=new Float32Array(e),this.minRRRideHeight=9999,this.maxRRRideHeight=-9999,this.trackCoordinate=new r(t,e),this.lapTimeStr="",this.index=0,this.size=0,this.dataLapToCompare=null}setDataLapToCompare(t){this.dataLapToCompare=t}runSyncLaps(){if(null==this.dataLapToCompare)return console.log("No data lap to compare!"),this;var t=new Array(2);t[0]=new e(1),t[1]=new e(2);for(var i=0;i<this.size;i++)for(var a=1;a<this.dataLapToCompare.size;){if(this.lapDistMetersInt[i]==this.dataLapToCompare.lapDistMetersInt[a]){var s=this.dataLapToCompare,r=Math.abs(this.lapDistMeters[i]-s.lapDistMeters[a]),n=Math.abs(this.lapDistMeters[i]-s.lapDistMeters[a+1]),h=Math.abs(this.lapDistMeters[i]-s.lapDistMeters[a-1]);n<=r&&n<=h&&(a+=1),h<=r&&h<=n&&(a-=1);var d=this.lapCurrentTimeSeconds[i]-s.lapCurrentTimeSeconds[a];t[0].addLapCurrentTimeSeconds(d),t[1].addLapCurrentTimeSeconds(0),t[0].addLapDistPct(this.LapDistPct[i]),t[0].addLapDistMeters(this.lapDistMeters[i]),t[0].addLapDistMetersInt(this.lapDistMetersInt[i]),t[0].addThrottle(this.throttle[i]),t[0].addBrake(this.brake[i]),t[0].addSpeedKmh(this.speedKmh[i]),t[0].addGear(this.gear[i]),t[0].addSteer(this.steer[i]),t[0].addWindDir(this.windDir[i]),t[0].addWindVel(this.windVel[i]),t[0].addFuelLevel(this.fuelLevel[i]),t[0].addcFSRrideHeight(this.cFSRrideHeight[i]),t[0].addFrontRideHeight(this.lFRideHeight[i],this.rFRideHeight[i]),t[0].addRearRideHeight(this.lRRideHeight[i],this.rRRideHeight[i]),t[0].trackCoordinate.addLat(this.trackCoordinate.lat[i]),t[0].trackCoordinate.addLon(this.trackCoordinate.lon[i]),t[1].addLapDistPct(s.LapDistPct[a]),t[1].addLapDistMeters(s.lapDistMeters[a]),t[1].addLapDistMetersInt(s.lapDistMetersInt[a]),t[1].addThrottle(s.throttle[a]),t[1].addBrake(s.brake[a]),t[1].addSpeedKmh(s.speedKmh[a]),t[1].addGear(s.gear[a]),t[1].addSteer(s.steer[a]),t[1].addWindDir(s.windDir[a]),t[1].addWindVel(s.windVel[a]),t[1].addFuelLevel(s.fuelLevel[a]),t[1].addcFSRrideHeight(s.cFSRrideHeight[a]),t[1].addFrontRideHeight(s.lFRideHeight[a],s.rFRideHeight[a]),t[1].addRearRideHeight(s.lRRideHeight[a],s.rRRideHeight[a]),t[1].trackCoordinate.addLat(s.trackCoordinate.lat[a]),t[1].trackCoordinate.addLon(s.trackCoordinate.lon[a]),t[0].updateIndex(),t[0].updateSize(),t[0].trackCoordinate.updateIndex(),t[0].trackCoordinate.updateSize(),t[1].updateIndex(),t[1].updateSize(),t[1].trackCoordinate.updateIndex(),t[1].trackCoordinate.updateSize();break}a++}for(i=0;i<t.length;i++)t[i].optimizeArraySize();return t}getDataLapToCompare(){return this.dataLapToCompare}getLapTimeStr(){return this.lapTimeStr}getAirTemp(){return this.airTemp}getTrackTemp(){return this.trackTemp}getLapDistPctArray(){return this.LapDistPct}getLapCurrentTimeSecondsArray(){return this.lapCurrentTimeSeconds}getLapCurrentTimeSeconds(t){return this.lapCurrentTimeSeconds[t]}getThrottleArray(){return this.throttle}getBrakeArray(){return this.brake}getSpeedKmhArray(){return this.speedKmh}getGearArray(){return this.gear}getSteerArray(){return this.steer}getWindDirArray(){return this.windDir}getWindVelArray(){return this.windVel}getFuelLevelArray(){return this.fuelLevel}getCFSRrideHeightArray(){return this.cFSRrideHeight}getLFRideHeightArray(){return this.lFRideHeight}getRFRideHeightArray(){return this.rFRideHeight}getLRRideHeightArray(){return this.lRRideHeight}getRRRideHeightArray(){return this.rRRideHeight}getLapDistMetersArray(){return this.lapDistMeters}getLapDistMetersIntArray(){return this.lapDistMetersInt}getThrottle(t){return this.throttle[t]}getLapDistMeters(t){return this.lapDistMeters[t]}getLapDistMetersInt(t){return this.lapDistMetersInt[t]}updateIndex(){this.index+=1}updateSize(){this.size+=1}optimizeArraySize(){this.LapDistPct=this.LapDistPct.slice(0,this.size),this.lapDistMeters=this.lapDistMeters.slice(0,this.size),this.lapDistMetersInt=this.lapDistMetersInt.slice(0,this.size),this.lapCurrentTimeSeconds=this.lapCurrentTimeSeconds.slice(0,this.size),this.throttle=this.throttle.slice(0,this.size),this.brake=this.brake.slice(0,this.size),this.speedKmh=this.speedKmh.slice(0,this.size),this.gear=this.gear.slice(0,this.size),this.steer=this.steer.slice(0,this.size),this.windDir=this.windDir.slice(0,this.size),this.windVel=this.windVel.slice(0,this.size),this.fuelLevel=this.fuelLevel.slice(0,this.size),this.cFSRrideHeight=this.cFSRrideHeight.slice(0,this.size),this.lFRideHeight=this.lFRideHeight.slice(0,this.size),this.rFRideHeight=this.rFRideHeight.slice(0,this.size),this.lRRideHeight=this.lRRideHeight.slice(0,this.size),this.rRRideHeight=this.rRRideHeight.slice(0,this.size),this.trackCoordinate.lat=this.trackCoordinate.lat.slice(0,this.size),this.trackCoordinate.lon=this.trackCoordinate.lon.slice(0,this.size)}setAirTemp(t){this.airTemp=t}setTrackTemp(t){this.trackTemp=t}addLapCurrentTimeSeconds(t){this.lapCurrentTimeSeconds[this.index]=t}addLapDistPct(t){this.LapDistPct[this.index]=t}addLapDistMeters(t){this.lapDistMeters[this.index]=t}addLapDistMetersInt(t){this.lapDistMetersInt[this.index]=t}addThrottle(t){this.throttle[this.index]=t}addBrake(t){this.brake[this.index]=t}addSpeedKmh(t){this.speedKmh[this.index]=t}addGear(t){this.gear[this.index]=t}addSteer(t){this.steer[this.index]=t}addWindDir(t){this.windDir[this.index]=t}addWindVel(t){this.windVel[this.index]=t}addFuelLevel(t){this.fuelLevel[this.index]=t}addcFSRrideHeight(t){this.cFSRrideHeight[this.index]=t,this.minCFSRideHeight>t&&(this.minCFSRideHeight=t),this.maxCFSRideHeight<t&&(this.maxCFSRideHeight=t)}addFrontRideHeight(t,e){this.lFRideHeight[this.index]=t,this.rFRideHeight[this.index]=e,this.minLFRideHeight>t&&(this.minLFRideHeight=t),this.maxLFRideHeight<t&&(this.maxLFRideHeight=t),this.minRFRideHeight>e&&(this.minRFRideHeight=e),this.maxRFRideHeight<e&&(this.maxRFRideHeight=e)}addRearRideHeight(t,e){this.lRRideHeight[this.index]=t,this.rRRideHeight[this.index]=e,this.minLRRideHeight>t&&(this.minLRRideHeight=t),this.maxLRRideHeight<t&&(this.maxLRRideHeight=t),this.minRRRideHeight>e&&(this.minRRRideHeight=e),this.maxRRRideHeight<e&&(this.maxRRRideHeight=e)}setLapTimeSeconds(t){var e=this.lapCurrentTimeSeconds[this.size-1],i=Math.floor(e/60),a=e%60;this.lapTimeStr=i+":"+a.toFixed(4)}}class i{constructor(t,e){var i="small-"+t;if(this.isCanvasValid=!0,null!=document.getElementById(i)){this.titleText=e;var a=document.getElementById(i),s=a.clientWidth,r=a.clientHeight,n=a.parentElement;a.remove(),this.canvas=document.createElement("canvas"),this.canvas.id=i,this.canvas.className="small-canvas",this.canvas.width=s,this.canvas.height=r,n.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.currentData=new Array(2),this.lineColorMainData="rgb(31, 7, 102)",this.lineColorComparedData="rgb(102, 2, 2)"}else this.isCanvasValid=!1}putCurrentData(t,e){t>=2?console.log("Error: Could not add more than 2 data in small canvas!"):this.currentData[t]=e}drawThrottleBrake(t){var e=0==t?38:62,i=this.canvas.height-40;this.ctx.beginPath(),this.ctx.lineWidth=2,this.ctx.strokeStyle=0==t?this.lineColorMainData:this.lineColorComparedData,this.ctx.strokeRect(e,20,20,i),this.ctx.beginPath(),this.ctx.fillStyle="Throttle"==this.titleText?"rgba(0, 165, 0, 1.0)":"rgba(165, 0, 0, 1.0)",this.ctx.fillRect(e,20+i,20,-i*this.currentData[t]),this.ctx.beginPath(),this.ctx.fillStyle=0==t?this.lineColorMainData:this.lineColorComparedData,this.ctx.arc(e+10,this.canvas.height-10,8,0,2*Math.PI),this.ctx.fill()}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var t=0;t<this.currentData.length;t++)if(null!=this.currentData[t])switch(this.titleText){case"Throttle":case"Brake":this.drawThrottleBrake(t)}}}class a{constructor(t){this.file=t,this.header={},this.diskHeader={},this.varsHeader=[],this.dataLaps=null,this.data=null,this.sessionInfo=null}getHeader(){return this.header}getDiskHeader(){return this.diskHeader}getVarsHeader(){return this.varsHeader}getData(){return this.data}getDataLaps(){return this.dataLaps}getOneDataLap(t){return this.dataLaps[t]}isValid(){return null!=this.file}read(){if(this.isValid()){var t=this;return new Promise((function(e,i){var a=new FileReader;a.onloadend=function(i){t.extractData(i.target.result),e(i.target.result)},a.onerror=function(t){i(t.target.error.message)},a.readAsArrayBuffer(t.file)}))}}extractData(t){var e=new DataView(t,0,112);this.header.version=e.getUint32(0,!0),this.header.status=e.getUint32(4,!0),this.header.tick_rate=e.getUint32(8,!0),this.header.session_info_update=e.getUint32(12,!0),this.header.session_info_length=e.getUint32(16,!0),this.header.session_info_offset=e.getUint32(20,!0),this.header.num_vars=e.getUint32(24,!0),this.header.var_header_offset=e.getUint32(28,!0),this.header.num_buf=e.getUint32(32,!0),this.header.buf_len=e.getUint32(36,!0),this.header.buf_offset=e.getUint32(52,!0);var i=new DataView(t,112,32);this.diskHeader.start_date=i.getFloat64(0,!0),this.diskHeader.start_time=i.getFloat64(8,!0),this.diskHeader.end_time=i.getFloat64(16,!0),this.diskHeader.lap_count=i.getUint32(24,!0),this.diskHeader.record_count=i.getUint32(28,!0);for(var a=new DataView(t,this.header.var_header_offset,144*this.header.num_vars),s=0,r=0;r<this.header.num_vars;r++)this.varsHeader.push({type:a.getUint32(s+0,!0),offset:a.getUint32(s+4,!0),count:a.getUint32(s+8,!0),count_as_time:a.getUint8(s+12,!0),name:this.convertToString(a,s+16,s+16+32),desc:this.convertToString(a,s+48,s+48+64),unit:this.convertToString(a,s+112,s+112+32)}),s+=144;this.sessionInfo=new Uint8Array(t.slice(this.header.session_info_offset,this.header.session_info_offset+this.header.session_info_length)),this.data=new Uint8Array(t.slice(this.header.buf_offset)),this.loadDataLaps()}print(){console.log(this.header),console.log(this.diskHeader),console.log(this.varsHeader),console.log("Data Length:",this.data.length)}convertToString(t,e,i){for(var a="",s=i-e,r=0;r<s;r++){a+=0==t.getUint8(r+e)?"":String.fromCharCode(t.getUint8(r+e))}return a}loadDataLaps(){for(var t=new Array(this.diskHeader.lap_count),i=1;i<=this.diskHeader.lap_count;i++)t[i-1]=new e(i);for(var a=this.data.length/this.header.buf_len,s=0,r=this.getHeaderData("Lap",0).content,n=0,h=0,d=0,l=0;l<a;l++){if((s=this.getHeaderData("Lap",l).content)!=r){if(t[d].setLapTimeSeconds(0),t[d].optimizeArraySize(),h+1>=this.diskHeader.lap_count)break;h++}var o=this.getHeaderData("LapDistPct",l).content,c=parseFloat(this.getHeaderData("LapDist",l).content),g=parseInt(c),x=this.getHeaderData("AirTemp",l).content.toFixed(1),u=this.getHeaderData("TrackTemp",l).content.toFixed(1),p=0;g>165&&(p=parseFloat(this.getHeaderData("LapCurrentLapTime",l).content));var m=this.getHeaderData("Throttle",l).content,v=this.getHeaderData("Brake",l).content,f=(3600*this.getHeaderData("Speed",l).content/1e3/320).toFixed(3),R=(this.getHeaderData("Gear",l).content/8).toFixed(1),L=this.getHeaderData("SteeringWheelAngle",l).content,C=this.getHeaderData("WindDir",l).content,M=3.6*this.getHeaderData("WindVel",l).content,w=this.getHeaderData("FuelLevel",l).content,H=this.getHeaderData("CFSRrideHeight",l).content,T=this.getHeaderData("LFrideHeight",l).content,D=this.getHeaderData("RFrideHeight",l).content,y=this.getHeaderData("LRrideHeight",l).content,A=this.getHeaderData("RRrideHeight",l).content,F=this.getHeaderData("Lat",l).content,k=this.getHeaderData("Lon",l).content;t[h].setAirTemp(x),t[h].setTrackTemp(u),t[h].addLapCurrentTimeSeconds(p),t[h].addLapDistPct(o),t[h].addLapDistMeters(c),t[h].addLapDistMetersInt(g),t[h].addThrottle(m),t[h].addBrake(v),t[h].addSpeedKmh(f),0==R&&(R=n),t[h].addGear(R),t[h].addSteer(L),t[h].addWindDir(C),t[h].addWindVel(M),t[h].addFuelLevel(w),t[h].addcFSRrideHeight(H),t[h].addFrontRideHeight(T,D),t[h].addRearRideHeight(y,A),t[h].trackCoordinate.addLat(F),t[h].trackCoordinate.addLon(k),t[h].updateSize(),t[h].updateIndex(),t[h].trackCoordinate.updateSize(),t[h].trackCoordinate.updateIndex(),r=s,d=h,n=R}t[h].setLapTimeSeconds(0),t[h].optimizeArraySize(),this.dataLaps=t}getHeaderData(t,e){for(var i=null,a=0;a<this.varsHeader.length;a++)if(this.varsHeader[a].name==t){i=this.varsHeader[a];break}if(null==i)return i={content:0};var s=e*this.header.buf_len+i.offset;switch(i.type){case 0:i.content_type="string";var r=this.data.slice(s,s+8),n="";for(a=0;a<8;a++){n+=0==r[a]?"":String.fromCharCode(r[a])}i.content=n,8;break;case 1:i.content_type="boolean";r=this.data.slice(s,s+1);i.content=255&r,1;break;case 2:i.content_type="int32";var h=4294967295&((r=this.data.slice(s,s+4))[0]|r[1]<<8|r[2]<<16|r[3]<<24);i.content=h,4;break;case 3:h=4294967295&((r=this.data.slice(s,s+4))[0]|r[1]<<8|r[2]<<16|r[3]<<24);i.content_type="uint32",i.content=h,4;break;case 4:i.content_type="float32";r=this.data.slice(s,s+4);var d=new ArrayBuffer(4);(l=new DataView(d)).setUint8(0,r[0]),l.setUint8(1,r[1]),l.setUint8(2,r[2]),l.setUint8(3,r[3]),i.content=l.getFloat32(0,!0),4;break;case 5:i.content_type="float64";var l;r=this.data.slice(s,s+8),d=new ArrayBuffer(8);(l=new DataView(d)).setInt8(0,r[0]),l.setInt8(1,r[1]),l.setInt8(2,r[2]),l.setInt8(3,r[3]),l.setInt8(4,r[4]),l.setInt8(5,r[5]),l.setInt8(6,r[6]),l.setInt8(7,r[7]),i.content=l.getFloat64(0,!0),8;break;default:console.log("default")}return i}printSessionInfo(){for(var t=0,e="";t<this.sessionInfo.length;)e+=String.fromCharCode(this.sessionInfo[t]),t++;console.log(e)}}class s{constructor(){var t="track-canvas",e=document.getElementById(t),i=e.clientWidth,a=e.clientHeight,s=e.parentElement;e.remove(),this.canvas=document.createElement("canvas"),this.canvas.className=e.className,this.canvas.id=t,this.canvas.width=i,this.canvas.height=a,s.appendChild(this.canvas),this.widthForTrack=this.canvas.width-100,this.heightForTrack=this.canvas.height-80,this.ctx=this.canvas.getContext("2d"),this.currentIndexAt=0,this.trackCoordinates=new Array(2),this.steerAngles=new Array(2),this.windDirs=new Array(2),this.steerImgs=new Array(2),this.steerImgs[0]=document.getElementById("steeringWheel1"),this.steerImgs[1]=document.getElementById("steeringWheel2"),this.windDirImgs=new Array(2),this.windDirImgs[0]=document.getElementById("windDir1"),this.windDirImgs[1]=document.getElementById("windDir2"),this.compassImg=document.getElementById("arrow-compass"),this.xTranslate=0,this.yTranslate=0,this.zoom=1,this.trackLineColorMain="rgb(31, 7, 252, 1.0)",this.trackLineColorCompared="rgba(252, 31, 7, 1.0)",this.drawTestLines(),this.activeMoveTrack()}setZoom(t){this.zoom=t}setTranslate(t,e){this.xTranslate=t,this.yTranslate=e}setTrackCoordinates(t,e){t>=2?console.log("Error: You Cannot Set More Than 2 data Laps!"):this.trackCoordinates[t]=e}setSteerAngles(t,e){t>=2?console.log("Error: You Cannot Set More Than 2 data Laps!"):this.steerAngles[t]=e}setWindDirs(t,e){t>=2?console.log("Error: You Cannot Set More Than 2 data Laps!"):this.windDirs[t]=e}updateCurrentIndexAt(t){this.currentIndexAt=t,this.draw()}activeMoveTrack(){var t=this,e=!1,i=0,a=0;this.canvas.addEventListener("mousedown",(function(s){null==t.trackCoordinates[0]&&null==t.trackCoordinates[1]||(i=s.pageX-t.xTranslate,a=s.pageY-t.yTranslate,e=!0)})),this.canvas.addEventListener("mousemove",(function(s){e&&(t.xTranslate=s.pageX-i,t.yTranslate=s.pageY-a,t.draw())})),this.canvas.addEventListener("mouseup",(function(){e&&(e=!1)})),this.canvas.addEventListener("mouseout",(function(){e&&(e=!1)}));this.canvas.addEventListener("wheel",(function(e){if(null!=t.trackCoordinates[0]||null!=t.trackCoordinates[1]){e.preventDefault();var i=1;i="Up"==(e.deltaY>0?"Down":"Up")?t.zoom+.1:t.zoom-.1,t.zoom=i,t.draw()}}))}convertLatLonToCanvas(t,e){var i=this.trackCoordinates[t];return{x:(i.lon[e]-i.minLon)*(this.widthForTrack/(i.maxLon-i.minLon)),y:this.heightForTrack-(i.lat[e]-i.minLat)*(this.heightForTrack/(i.maxLat-i.minLat))}}drawTestLines(){this.ctx.strokeStyle="rgba(255, 255, 255, 1.0)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.stroke()}drawCircleOnTrack(){this.ctx.beginPath(),this.ctx.fillStyle="rgb(255, 255, 255)";var t=this.convertLatLonToCanvas(0,this.currentIndexAt);this.ctx.arc(t.x,t.y,4,0,2*Math.PI),this.ctx.fill()}drawSteerAngles(){if(null!=this.steerAngles[0]||null!=this.steerAngles[1])for(var t=10,e=this.canvas.width-90,i=0;i<this.steerAngles.length;i++)null!=this.steerAngles[i]&&(t=t+80*i+5,this.ctx.beginPath(),this.ctx.save(),this.ctx.translate(e+40,t+40),this.ctx.rotate(-this.steerAngles[i][this.currentIndexAt]),this.ctx.drawImage(this.steerImgs[i],-40,-40,80,80),this.ctx.restore(),this.ctx.fillStyle=0==i?"rgb(31, 7, 102)":"rgb(102, 2, 2)",this.ctx.arc(e+40,t+40,8,0,2*Math.PI),this.ctx.fill())}drawWindDir(){if(null!=this.steerAngles[0]||null!=this.steerAngles[1])for(var t=15,e=0;e<this.windDirs.length;e++)null!=this.windDirs[e]&&(t+=0==e?30:80,this.ctx.beginPath(),this.ctx.save(),this.ctx.translate(50,t+15),this.ctx.drawImage(this.compassImg,-38,-32,70,70),this.ctx.rotate(this.windDirs[e][this.currentIndexAt]),this.ctx.drawImage(this.windDirImgs[e],-15,-15,30,30),this.ctx.restore())}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.translate(this.xTranslate,this.yTranslate),this.ctx.scale(this.zoom,this.zoom),this.ctx.lineWidth=1;for(let r=0;r<this.trackCoordinates.length;r++)if(null!=this.trackCoordinates[r]&&null!=this.trackCoordinates[r]){var t=this.trackCoordinates[r],e=this.convertLatLonToCanvas(r,0);this.ctx.strokeStyle=0==r?this.trackLineColorMain:this.trackLineColorCompared;var i=e.x,a=e.y;this.ctx.beginPath();for(var s=1;s<t.size;s++)e=this.convertLatLonToCanvas(r,s),this.ctx.moveTo(i,a),i=e.x,a=e.y,e.x*this.zoom-5+this.xTranslate>this.canvas.width||e.x*this.zoom+this.xTranslate<-5||e.y*this.zoom-5+this.yTranslate>this.canvas.height||e.y*this.zoom+this.yTranslate<-5||this.ctx.lineTo(e.x,e.y);this.ctx.stroke()}this.drawCircleOnTrack(),this.ctx.restore(),this.drawSteerAngles(),this.drawWindDir()}}class r{constructor(t,e){this.lapNum=t,this.lat=new Float32Array(e),this.lon=new Float32Array(e),this.minLat=9999,this.maxLat=-9999,this.minLon=9999,this.maxLon=-9999,this.size=0,this.index=0}updateSize(){this.size+=1}updateIndex(){this.index+=1}addLat(t){this.lat[this.index]=t,this.minLat>t&&(this.minLat=t),this.maxLat<t&&(this.maxLat=t)}addLon(t){this.lon[this.index]=t,this.minLon>t&&(this.minLon=t),this.maxLon<t&&(this.maxLon=t)}getLatArray(){return this.lat}getLonArray(){return this.lon}}var n=document.getElementById("form_data");null==n&&console.log("Error: Could not find the form to upload");var h=document.querySelector(".loading_div");function d(){h.style.display="none"}var l=new Array(2),o=new Array(10),c=new class{constructor(){this.allCanvases=[],this.TrackCanvas=new s,this.isMouseDown=!1,this.xData=new Array(2),this.fuelLevels=new Array(2),this.windVel=new Array(2),this.filesInfoElements=[document.querySelectorAll(".file1Info"),document.querySelectorAll(".file2Info")],this.MAX_SELECTION=400}addCanvas(t){this.allCanvases.push(t)}clearAllCanvas(){this.allCanvases=[],this.TrackCanvas=new s}getTrackCanvas(){return this.TrackCanvas}setXData(t,e){this.xData[t]=e}setFuelLevel(t,e){this.fuelLevels[t]=e}setWindVel(t,e){this.windVel[t]=e}activeOnMouseMove(){var t=this;for(let e=0;e<this.allCanvases.length;e++)this.allCanvases[e].getCanvas().onmousemove=function(e){for(let i=0;i<t.allCanvases.length;i++)t.canvasOnMouseMove(e,t.allCanvases[i],t)},this.allCanvases[e].getCanvas().onmousedown=function(i){for(let a=0;a<t.allCanvases.length;a++)t.canvasOnMouseDown(i,t.allCanvases[e])}}canvasOnMouseMove(t,e,i){if(e.xPosAt=t.offsetX-e.getOffsetX(),!(e.xPosAt<0||e.xPosAt+e.getOffsetX()>=e.canvas.width)){e.draw(),e.ctx.strokeStyle="rgba(130, 17, 49, 0.5)",e.ctx.lineWidth=1,e.ctx.beginPath(),e.ctx.moveTo(t.offsetX,0),e.ctx.lineTo(t.offsetX,e.getCanvas().height-e.getOffsetY()),e.ctx.stroke(),e.ctx.fillStyle="rgba(255, 255, 255, 1.0)";var a=0;null!=e.getCurrentIndexAt(0)&&(a=i.xData[0][e.getCurrentIndexAt(0)]),e.ctx.font="bold 12px Arial",e.ctx.fillStyle="rgba(130, 17, 49, 0.8)",e.ctx.fillText(a+"m",t.offsetX-10,e.getCanvas().height-10),i.TrackCanvas.updateCurrentIndexAt(e.getCurrentIndexAt(0)),null!=i.fuelLevels[0]&&(i.filesInfoElements[0][2].textContent=parseFloat(i.windVel[0][e.getCurrentIndexAt(0)]).toFixed(1)+"km/h",i.filesInfoElements[0][3].textContent=parseFloat(i.fuelLevels[0][e.getCurrentIndexAt(0)]).toFixed(2)+"L"),null!=i.fuelLevels[1]&&(i.filesInfoElements[1][2].textContent=parseFloat(i.windVel[1][e.getCurrentIndexAt(1)]).toFixed(1)+"km/h",i.filesInfoElements[1][3].textContent=parseFloat(i.fuelLevels[1][e.getCurrentIndexAt(1)]).toFixed(2)+"L")}}canvasOnMouseDown(t,e){var i=t.offsetX,a=e.getCurrentIndexAt(0),s=0;i-e.getOffsetX()<0&&(i=0),this.isMouseDown=!0;var r=this;window.onmousemove=function(t){if(r.isMouseDown&&!(t.offsetX-e.getOffsetX()<0)){var a=t.offsetX-i;s=e.getCurrentIndexAt(0),r.highlightsSelectedPart(i,a)}},window.onmouseup=function(){if(r.isMouseDown){if(a+s!=a&&Math.abs(a-s)>r.MAX_SELECTION){if(a>s){var t=a;a=s,s=t}for(var e=0;e<r.allCanvases.length;e++)r.allCanvases[e].setStartEndIndex(a,s)}r.isMouseDown=!1}}}highlightsSelectedPart(t,e){for(var i=0;i<this.allCanvases.length;i++){var a=this.allCanvases[i].ctx;a.beginPath(),a.fillStyle="rgba(26, 55, 84, 0.2)",a.fillRect(t,0,e,this.allCanvases[i].getCanvas().height)}}},g={lap1:-1,lap2:-1};function x(){o[0]=new t("delta","Delta"),o[0].setIsTranslateCenter(!0),o[1]=new t("throttle","Throttle"),o[2]=new t("brake","Brake"),o[3]=new t("speed","Speed"),o[4]=new t("gear","Gear"),o[5]=new t("CFSRideHeight","CFSRideHeight"),o[6]=new t("LFRideHeight","Left front"),o[7]=new t("RFRideHeight","Right front"),o[8]=new t("LRRideHeight","Left rear"),o[9]=new t("RRRideHeight","Right rear"),c.clearAllCanvas();for(var e=0;e<o.length;e++)o[e].clear(),c.addCanvas(o[e])}function u(t){for(var e=document.querySelectorAll(t),i=0;i<e.length;i++)e[i].className=""}function p(t){x();var e=parseInt(t.parentElement.getAttribute("data-file-index")),i=parseInt(t.getAttribute("data-lap"));0==e?(u(".ul-laps1 li"),g.lap1=i,t.className="selectedFile1"):(u(".ul-laps2 li"),g.lap2=i,t.className="selectedFile2"),function(){if(l[0].isValid()&&-1!=g.lap1&&-1==g.lap2){var t=l[0].getOneDataLap(g.lap1);o[0].draw(),o[1].setLap(0,t.getThrottleArray()),o[1].draw(),o[2].setLap(0,t.getBrakeArray()),o[2].draw(),o[3].setLap(0,t.getSpeedKmhArray()),o[3].draw(),o[4].setLap(0,t.getGearArray()),o[4].draw(),o[5].boxWidth=54,o[5].setLap(0,t.getCFSRrideHeightArray()),o[5].setMinMaxData(t.minCFSRideHeight,t.maxCFSRideHeight,0,1),o[5].draw(),o[6].boxWidth=54,o[6].setLap(0,t.getLFRideHeightArray()),o[6].setMinMaxData(t.minLFRideHeight,t.maxLFRideHeight,0,1),o[6].draw(),o[7].boxWidth=54,o[7].setLap(0,t.getRFRideHeightArray()),o[7].setMinMaxData(t.minRFRideHeight,t.maxRFRideHeight,0,1),o[7].draw(),o[8].boxWidth=54,o[8].setLap(0,t.getLRRideHeightArray()),o[8].setMinMaxData(t.minLRRideHeight,t.maxLRRideHeight,0,1),o[8].draw(),o[9].boxWidth=54,o[9].setLap(0,t.getRRRideHeightArray()),o[9].setMinMaxData(t.minRRRideHeight,t.maxRRRideHeight,0,1),o[9].draw(),c.setXData(0,t.getLapDistMetersIntArray()),c.getTrackCanvas().setTrackCoordinates(0,t.trackCoordinate),c.getTrackCanvas().setSteerAngles(0,t.getSteerArray()),c.getTrackCanvas().setWindDirs(0,t.getWindDirArray()),c.setWindVel(0,t.getWindVelArray()),c.setFuelLevel(0,t.getFuelLevelArray()),c.getTrackCanvas().draw(),m(0,t.airTemp,t.trackTemp,t.windVel[0],t.fuelLevel[0])}if(l[1].isValid()&&-1!=g.lap2&&-1==g.lap1){var e=l[1].getOneDataLap(g.lap2);o[0].draw(),o[1].setLap(1,e.getThrottleArray()),o[1].draw(),o[2].setLap(1,e.getBrakeArray()),o[2].draw(),o[3].setLap(1,e.getSpeedKmhArray()),o[3].draw(),o[4].setLap(1,e.getGearArray()),o[4].draw(),o[5].boxWidth=54,o[5].setLap(1,e.getCFSRrideHeightArray()),o[5].setMinMaxData(e.minCFSRideHeight,e.maxCFSRideHeight,0,1),o[5].draw(),o[6].boxWidth=54,o[6].setLap(1,e.getLFRideHeightArray()),o[6].setMinMaxData(e.minLFRideHeight,e.maxLFRideHeight,0,1),o[6].draw(),o[7].boxWidth=54,o[7].setLap(1,e.getRFRideHeightArray()),o[7].setMinMaxData(e.minRFRideHeight,e.maxRFRideHeight,0,1),o[7].draw(),o[8].boxWidth=54,o[8].setLap(1,e.getLRRideHeightArray()),o[8].setMinMaxData(e.minLRRideHeight,e.maxLRRideHeight,0,1),o[8].draw(),o[9].boxWidth=54,o[9].setLap(e.getRRRideHeightArray()),o[9].setMinMaxData(e.minRRRideHeight,e.maxRRRideHeight,0,1),o[9].draw(),c.setXData(1,e.getLapDistMetersIntArray()),c.getTrackCanvas().setTracCoordinates(1,e.trackCoordinate),c.getTrackCanvas().setSteerAngles(1,e.getSteerArray()),c.getTrackCanvas().setWindDirs(1,e.getWindDirArray()),c.setWindVel(1,e.getWindVelArray()),c.setFuelLevel(1,e.getFuelLevelArray()),c.getTrackCanvas().draw(),m(1,e.airTemp,e.trackTemp,e.windVel[0],e.fuelLevel[0])}if(l[0].isValid()&&l[1].isValid()&&g.lap1>-1&&g.lap2>-1){t=l[0].getOneDataLap(g.lap1),e=l[1].getOneDataLap(g.lap2);t.setDataLapToCompare(e);var i=t.runSyncLaps();o[0].setLap(0,i[0].getLapCurrentTimeSecondsArray()),o[0].draw(),o[1].setLap(0,i[0].getThrottleArray()),o[1].setLap(1,i[1].getThrottleArray()),o[1].draw(),o[2].setLap(0,i[0].getBrakeArray()),o[2].setLap(1,i[1].getBrakeArray()),o[2].draw(),o[3].setLap(0,i[0].getSpeedKmhArray()),o[3].setLap(1,i[1].getSpeedKmhArray()),o[3].draw(),o[4].setLap(0,i[0].getGearArray()),o[4].setLap(1,i[1].getGearArray()),o[4].draw(),o[5].boxWidth=54,o[5].setLap(0,i[0].getCFSRrideHeightArray()),o[5].setLap(1,i[1].getCFSRrideHeightArray()),o[5].setMinMaxData(i[0].minCFSRideHeight,i[0].maxCFSRideHeight,0,1),o[5].setMinMaxData(i[1].minCFSRideHeight,i[1].maxCFSRideHeight,0,1),o[5].draw(),o[6].boxWidth=54,o[6].setLap(0,i[0].getLFRideHeightArray()),o[6].setLap(1,i[1].getLFRideHeightArray()),o[6].setMinMaxData(i[0].minLFRideHeight,i[0].maxLFRideHeight,0,1),o[6].setMinMaxData(i[1].minLFRideHeight,i[1].maxLFRideHeight,0,1),o[6].draw(),o[7].boxWidth=54,o[7].setLap(0,i[0].getRFRideHeightArray()),o[7].setLap(1,i[1].getRFRideHeightArray()),o[7].setMinMaxData(i[0].minRFRideHeight,i[0].maxRFRideHeight,0,1),o[7].setMinMaxData(i[1].minRFRideHeight,i[1].maxRFRideHeight,0,1),o[7].draw(),o[8].boxWidth=54,o[8].setLap(0,i[0].getLRRideHeightArray()),o[8].setLap(1,i[1].getLRRideHeightArray()),o[8].setMinMaxData(i[0].minLRRideHeight,i[0].maxLRRideHeight,0,1),o[8].setMinMaxData(i[1].minLRRideHeight,i[1].maxLRRideHeight,0,1),o[8].draw(),o[9].boxWidth=54,o[9].setLap(0,i[0].getRRRideHeightArray()),o[9].setLap(1,i[1].getRRRideHeightArray()),o[9].setMinMaxData(i[0].minRRRideHeight,i[0].maxRRRideHeight,0,1),o[9].setMinMaxData(i[1].minRRRideHeight,i[1].maxRRRideHeight,0,1),o[9].draw(),c.setXData(0,i[0].getLapDistMetersIntArray()),c.getTrackCanvas().setTrackCoordinates(0,i[0].trackCoordinate),c.getTrackCanvas().setTrackCoordinates(1,i[1].trackCoordinate),c.getTrackCanvas().setSteerAngles(0,i[0].getSteerArray()),c.getTrackCanvas().setSteerAngles(1,i[1].getSteerArray()),c.getTrackCanvas().setWindDirs(0,i[0].getWindDirArray()),c.getTrackCanvas().setWindDirs(1,i[1].getWindDirArray()),c.setWindVel(0,i[0].getWindVelArray()),c.setWindVel(1,i[1].getWindVelArray()),c.setFuelLevel(0,i[0].getFuelLevelArray()),c.setFuelLevel(1,i[1].getFuelLevelArray()),c.getTrackCanvas().draw(),m(0,t.airTemp,t.trackTemp,i[0].windVel[0],i[0].fuelLevel[0]),m(1,e.airTemp,e.trackTemp,i[1].windVel[0],i[1].fuelLevel[0])}}(),c.activeOnMouseMove()}function m(t,e,i,a,s){var r=[document.querySelectorAll(".file1Info"),document.querySelectorAll(".file2Info")];if(null==l[t])return r[t][0].textContent="0c",r[t][1].textContent="0c",r[t][2].textContent="0km/h",void(r[t][3].textContent="0L");r[t][0].textContent=e+"c",r[t][1].textContent=i+"c",r[t][2].textContent=parseFloat(a).toFixed(1)+"km/h",r[t][3].textContent=parseFloat(s).toFixed(2)+"L"}function v(t){if(null==t)return null;for(var e=[],i=0;i<t.length;i++)e.push(t[i].getLapTimeStr());return e}n.addEventListener("submit",(function(t){if(t.preventDefault(),function(){h.style.display="block"}(),(l=new Array(2))[0]=new a(n.file1.files[0]),l[1]=new a(n.file2.files[0]),!l[0].isValid()&&!l[1].isValid())return console.log("no files"),void setTimeout(d,1e3);l[0].isValid()&&l[0].read().then((function(t){})).catch((function(t){console.log(t)}));l[1].isValid()&&l[1].read().then((function(t){})).catch((function(t){console.log(t)}));setTimeout((function(){var t,e,i;x(),t=l[0].getDataLaps(),e=l[1].getDataLaps(),(i=new Array(2))[0]=v(t),i[1]=v(e),function(t){var e=document.querySelector(".ul-laps1");if(e.innerHTML="",null!=t[0])for(var i=0;i<t[0].length;i++)e.innerHTML+="<li data-lap='"+i+"'>"+t[0][i]+"</li>";var a=document.querySelector(".ul-laps2");if(a.innerHTML="",null!=t[1])for(i=0;i<t[1].length;i++)a.innerHTML+="<li data-lap='"+i+"'>"+t[1][i]+"</li>";var s=document.querySelectorAll(".ul-laps1 li"),r=document.querySelectorAll(".ul-laps2 li");for(let t=0;t<s.length;t++)s[t].addEventListener("click",(function(){p(s[t])}));for(let t=0;t<r.length;t++)r[t].addEventListener("click",(function(){p(r[t])}));d()}(i)}),2e3)})),document.getElementById("controller-zoom-out").onclick=function(){for(var t=0;t<c.allCanvases.length;t++)for(var e=0;e<c.allCanvases[t].data.length;e++)null!=c.allCanvases[t].data[e]&&c.allCanvases[t].setStartEndIndex(0,c.allCanvases[t].data[e].length);c.getTrackCanvas().setZoom(1),c.getTrackCanvas().setTranslate(0,0),c.getTrackCanvas().draw()};