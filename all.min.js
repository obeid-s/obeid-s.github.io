class t{constructor(t,e){this.smallCanvas=new a(t,e);var i=document.getElementById(t),s=i.clientWidth,r=i.clientHeight,n=i.parentElement;i.remove(),this.canvas=document.createElement("canvas"),this.canvas.id=t,this.canvas.className="main-canvas",this.canvas.width=s,this.canvas.height=r,n.appendChild(this.canvas),this.offsetX=25,this.offsetY=25,this.marginTop=10,this.xPosAt=0,this.stepsX=0,this.isTranslateCenter=!1,this.ctx=this.canvas.getContext("2d"),this.shadowLinesInGraphNumber=5,this.shadowLineGap=(this.canvas.height-(this.offsetY+this.marginTop))/this.shadowLinesInGraphNumber,this.xTranslate=0,this.yTranslate=this.canvas.height-this.offsetY,this.titleText=e,this.dataSize=1,this.data=new Array(2),this.data[0]=new Array(this.dataSize),this.data[1]=new Array(this.dataSize),this.subscribeData=new Array(2),this.currentIndexAt=0,this.startMetersIndex=0,this.endMetersIndex=0,this.lineColors=[["rgb(72, 109, 232)","rgb(82, 119, 242)","rgb(92, 129, 252)"],["rgb(197, 83, 5)","rgb(207, 93, 15)","rgb(217, 103, 25)"]],this.lineColorMainData="rgb(72, 109, 232)",this.lineColorComparedData="rgb(197, 83, 5)",this.fillColorMainData="rgba(72, 109, 232, 0.3)",this.fillColorComparedData="rgba(197, 83, 5, 0.3)",this.lineWidth=1,this.boxWidth=38,"Speed"==this.titleText&&(this.boxWidth=54),"Gear"==this.titleText&&(this.boxWidth=110),this.dataMinMax={oldMin:99999,oldMax:-99999,newMin:99999,newMax:-99999},this.yMin=9999,this.yMax=-9999}clear(){this.data=new Array(2),this.data[0]=new Array(1),this.data[1]=new Array(1),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.closePath(),this.startMetersIndex=0,this.endMetersIndex=0}resetStartEndMeters(){this.setStartEndIndex(0,null!=this.data[0][0]?this.data[0][0].length:this.data[1][0].length)}setLap(t,e,i){if(t>=2)console.log("Error: You Cannot Set More Than 2 data Laps!");else{if(e>=this.dataSize){this.dataSize+=1;for(var a=new Array(this.dataSize),s=0;s<this.data[t].length;s++)a[s]=this.data[t][s];this.data[t]=a,a=null}this.data[t][e]=i,this.startMetersIndex=0,this.endMetersIndex=null!=this.data[0][0]?this.data[0][0].length:this.data[1][0].length}}setSubscribeData(t,e){t>=2?console.log("Error: You Cannot Set More Than 2 data Laps!"):this.subscribeData[t]=e}setMinMaxData(t,e,i,a){this.dataMinMax.oldMin>t&&(this.dataMinMax.oldMin=t),this.dataMinMax.oldMax<e&&(this.dataMinMax.oldMax=e),this.dataMinMax.newMin>i&&(this.dataMinMax.newMin=i),this.dataMinMax.newMax<a&&(this.dataMinMax.newMax=a)}setStartEndIndex(t,e){t=t<0?0:t,this.startMetersIndex=t,this.endMetersIndex=e,this.draw()}setIsTranslateCenter(t){this.isTranslateCenter=t,this.xTranslate=0,this.yTranslate=(this.canvas.height-this.offsetY)/2}getCanvas(){return this.canvas}getCurrentIndexAt(){return this.currentIndexAt}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}drawTextTitle(){this.ctx.beginPath(),this.ctx.font="bold 20px Arial",this.ctx.fillStyle="rgba(255, 255, 255, 0.5)",this.ctx.textAlign="left",this.ctx.fillText(this.titleText,29,25)}drawBaseLines(){this.ctx.strokeStyle="rgba(100, 100, 100, 0.2)";var t=this.canvas.height-this.offsetY+this.marginTop;this.ctx.beginPath(),this.ctx.lineWidth=1;for(var e=this.marginTop;e<t;e+=this.shadowLineGap)this.ctx.moveTo(this.offsetX,e),this.ctx.lineTo(this.canvas.width,e);this.ctx.stroke(),this.ctx.beginPath(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.8)",this.ctx.moveTo(this.offsetX,this.marginTop),this.ctx.lineTo(this.offsetX,this.canvas.height-this.offsetY),this.ctx.stroke()}drawBaseLinesValues(){this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.textAlign="center",this.ctx.font="bold 10px Arial";var t=this.canvas.height-this.offsetY+this.marginTop;switch(this.titleText){case"Delta":this.ctx.beginPath(),this.ctx.fillText("0.0s",12,2+(this.canvas.height-this.offsetY)/2);break;case"Throttle":case"Brake":for(var e=100,i=e/this.shadowLinesInGraphNumber,a=this.marginTop;a<t;a+=this.shadowLineGap)this.ctx.beginPath(),this.ctx.fillText(Math.round(e),12,a+2),e-=i;break;case"Speed":var s=320;for(i=s/this.shadowLinesInGraphNumber,a=this.marginTop;a<t;a+=this.shadowLineGap)this.ctx.beginPath(),this.ctx.fillText(parseInt(s.toFixed(0)),12,a+2),s-=i;break;case"Gear":var r=this.dataMinMax.oldMax;for(i=r/this.shadowLinesInGraphNumber,a=this.marginTop;a<t;a+=this.shadowLineGap)this.ctx.beginPath(),this.ctx.fillText(Math.floor(r),12,a+2),r-=i;break;case"CFSRideHeight":case"Left front":case"Right front":case"Left rear":case"Right rear":this.ctx.font="bold 8px Arial";var n=this.dataMinMax.oldMax;for(i=n/this.shadowLinesInGraphNumber,a=this.marginTop;a<t;a+=this.shadowLineGap)this.ctx.beginPath(),this.ctx.fillText(n.toFixed(1),12,a+2),n-=i}}drawCircleOnHoveredPoint(t,e){this.ctx.beginPath(),this.ctx.fillStyle=this.lineColors[t][e];var i=this.currentIndexAt,a=-(this.canvas.height-(this.offsetY+this.marginTop));this.isTranslateCenter&&(a/=2);var s=0;s="CFSRideHeight"==this.titleText||"Left front"==this.titleText||"Right front"==this.titleText||"Left rear"==this.titleText||"Right rear"==this.titleText||"Gear"==this.titleText||"LF Temps (OMI)"==this.titleText||"RF Temps (IMO)"==this.titleText||"LR Temps (OMI)"==this.titleText||"RR Temps (IMO)"==this.titleText?this.data[t][e][i]/this.dataMinMax.oldMax*a:this.data[t][e][i]*a,this.ctx.arc(this.xPosAt+this.offsetX,s,4,0,2*Math.PI),this.ctx.fill()}drawLineOnHover(){this.ctx.beginPath(),this.ctx.save(),this.ctx.translate(-this.xTranslate,-this.yTranslate),this.ctx.strokeStyle="rgba(255, 255, 255, 1.0)",this.ctx.lineWidth=1,this.ctx.moveTo(this.xPosAt+this.offsetX,0),this.ctx.lineTo(this.xPosAt+this.offsetX,this.canvas.height-this.offsetY),this.ctx.stroke(),this.ctx.restore()}drawBoxData(t,e){var i=this.currentIndexAt;this.ctx.beginPath(),this.ctx.fillStyle=this.lineColors[t][e];var a=this.xPosAt+this.offsetX+this.marginTop;a>this.canvas.width/2&&(a-=this.boxWidth+20);var s=-this.canvas.height/2;this.isTranslateCenter&&(s=0),1==t&&(s+=17),this.ctx.fillRect(a,s,this.boxWidth,16),this.ctx.beginPath(),this.ctx.font="12px Arial",this.ctx.fillStyle="rgba(255, 255, 255, 1.0)",this.ctx.textAlign="center";var r=this.extractOriginData(t,e,i);"Gear"==this.titleText&&(r+=" ("+this.subscribeData[t][i].toFixed(0)+" revs/min)"),this.ctx.fillText(r,a+this.boxWidth/2,s+12)}extractOriginData(t,e,i){switch(this.titleText){case"Delta":return null!=this.data[t][e][i]?this.data[t][e][i].toFixed(2)+"s":"0.00s";case"Throttle":case"Brake":return(100*this.data[t][e][i]).toFixed(0)+"%";case"Gear":return this.data[t][e][i];case"Speed":return Math.round(320*this.data[t][e][i])+"km/h";case"CFSRideHeight":case"Left front":case"Right front":case"Left rear":case"Right rear":return this.data[t][e][i].toFixed(2)+"mm";case"LF Temps (OMI)":case"LR Temps (OMI)":return this.data[t][0][i].toFixed(1)+"c,"+this.data[t][1][i].toFixed(1)+"c,"+this.data[t][2][i].toFixed(1)+"c";case"RF Temps (IMO)":case"RR Temps (IMO)":return this.data[t][2][i].toFixed(1)+"c,"+this.data[t][1][i].toFixed(1)+"c,"+this.data[t][0][i].toFixed(1)+"c";default:return this.data[t][e][i].toFixed(3)}}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBaseLines(),this.drawTextTitle(),this.ctx.save(),this.ctx.translate(this.xTranslate,this.yTranslate),this.isTranslateCenter&&(this.ctx.beginPath(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.5)",this.ctx.moveTo(this.offsetX,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.stroke()),this.ctx.lineWidth=this.lineWidth;var t=Math.abs(this.startMetersIndex-this.endMetersIndex);this.currentIndexAt=Math.round(this.xPosAt/(this.canvas.width-this.offsetX)*t)+this.startMetersIndex;for(var e=0;e<this.data.length;e++)if(null!=this.data[e]&&null!=this.data[e])for(var i=0;i<this.data[e].length;i++)if(null!=this.data[e][i]&&null!=this.data[e][i]){this.ctx.strokeStyle=this.lineColors[e][i],this.ctx.fillStyle=0==e?this.fillColorMainData:this.fillColorComparedData,this.ctx.beginPath(),this.stepsX=(this.canvas.width-this.offsetX)/t;var a=this.stepsX,s=0;if("CFSRideHeight"==this.titleText||"Left front"==this.titleText||"Right front"==this.titleText||"Left rear"==this.titleText||"Right rear"==this.titleText||"Gear"==this.titleText||"LF Temps (OMI)"==this.titleText||"RF Temps (IMO)"==this.titleText||"LR Temps (OMI)"==this.titleText||"RR Temps (IMO)"==this.titleText)var r=((this.dataMinMax.newMax-this.dataMinMax.newMin)*(this.data[e][d]-this.dataMinMax.oldMin)/(this.dataMinMax.oldMax-this.dataMinMax.oldMin)+this.dataMinMax.newMin)*-(this.canvas.height-(this.offsetY+this.marginTop));else r=this.data[e][this.startMetersIndex]*-(this.canvas.height-(this.offsetY+this.marginTop));var n=0;n=this.isTranslateCenter?-(this.canvas.height-(this.offsetY+this.marginTop))/2:-(this.canvas.height-(this.offsetY+this.marginTop)),this.ctx.moveTo(this.offsetX+s,r);for(var h=0,d=this.startMetersIndex+1;d<this.endMetersIndex;d++)h="CFSRideHeight"==this.titleText||"Left front"==this.titleText||"Right front"==this.titleText||"Left rear"==this.titleText||"Right rear"==this.titleText||"Gear"==this.titleText||"LF Temps (OMI)"==this.titleText||"RF Temps (IMO)"==this.titleText||"LR Temps (OMI)"==this.titleText||"RR Temps (IMO)"==this.titleText?this.data[e][i][d]/this.dataMinMax.oldMax*n:this.data[e][i][d]*n,this.ctx.lineTo(this.offsetX+a,h),null!=this.subscribeData[e]&&this.subscribeData[e][d]>0&&"Brake"==this.titleText&&this.ctx.fillRect(this.offsetX+a,0,this.stepsX,this.subscribeData[e][d]*n),s=a,r=h,a+=this.stepsX;this.ctx.stroke()}this.drawLineOnHover();for(e=0;e<this.data.length;e++)if(null!=this.data[e]&&null!=this.data[e])for(i=0;i<this.data[e].length;i++)null!=this.data[e][i]&&null!=this.data[e][i]&&(this.drawCircleOnHoveredPoint(e,i),this.drawBoxData(e,i),this.smallCanvas.isCanvasValid&&(this.smallCanvas.putCurrentData(e,this.data[e][i][this.currentIndexAt]),null!=this.subscribeData[e]&&this.smallCanvas.putSubsCurrentData(e,this.subscribeData[e][this.currentIndexAt])));this.smallCanvas.isCanvasValid&&this.smallCanvas.draw(),this.ctx.restore(),this.drawBaseLinesValues()}}class e{constructor(t){this.LFtempL=new Float32Array(t),this.LFtempM=new Float32Array(t),this.LFtempR=new Float32Array(t),this.RFtempL=new Float32Array(t),this.RFtempM=new Float32Array(t),this.RFtempR=new Float32Array(t),this.LRtempL=new Float32Array(t),this.LRtempM=new Float32Array(t),this.LRtempR=new Float32Array(t),this.RRtempL=new Float32Array(t),this.RRtempM=new Float32Array(t),this.RRtempR=new Float32Array(t),this.index=0,this.size=0}updateIndex(){this.index+=1,this.size+=1}addLFtempL(t){this.LFtempL[this.index]=t}addLFtempM(t){this.LFtempM[this.index]=t}addLFtempR(t){this.LFtempR[this.index]=t}addRFtempL(t){this.RFtempL[this.index]=t}addRFtempM(t){this.RFtempM[this.index]=t}addRFtempR(t){this.RFtempR[this.index]=t}addLRtempL(t){this.LRtempL[this.index]=t}addLRtempM(t){this.LRtempM[this.index]=t}addLRtempR(t){this.LRtempR[this.index]=t}addRRtempL(t){this.RRtempL[this.index]=t}addRRtempM(t){this.RRtempM[this.index]=t}addRRtempR(t){this.RRtempR[this.index]=t}print(){console.log("----- Left Front -----"),console.log(this.LFtempL),console.log(this.LFtempM),console.log(this.LFtempR),console.log("----- Right Front -----"),console.log(this.RFtempL),console.log(this.RFtempM),console.log(this.RFtempR)}}class i{constructor(t){this.lapNumber=t,this.airTemp=0,this.trackTemp=0,this.airDensity=0,this.airPressure=0,this.windSpeed=0;var i=35e3;this.LapDistPct=new Float32Array(i),this.lapDistMeters=new Float32Array(i),this.lapDistMetersInt=new Uint32Array(i),this.lapCurrentTimeSeconds=new Float32Array(i),this.throttle=new Float32Array(i),this.brake=new Float32Array(i),this.absActive=new Uint8Array(i),this.speedKmh=new Float32Array(i),this.gear=new Int32Array(i),this.rpm=new Float32Array(i),this.minGear=99,this.maxGear=-99,this.steer=new Float32Array(i),this.windDir=new Float32Array(i),this.windVel=new Float32Array(i),this.fuelLevel=new Float32Array(i),this.yawNorth=new Float32Array(i),this.tires=new e(i),this.cFSRrideHeight=new Float32Array(i),this.minCFSRideHeight=9999,this.maxCFSRideHeight=-9999,this.lFRideHeight=new Float32Array(i),this.minLFRideHeight=9999,this.maxLFRideHeight=-9999,this.rFRideHeight=new Float32Array(i),this.minRFRideHeight=9999,this.maxRFRideHeight=-9999,this.lRRideHeight=new Float32Array(i),this.minLRRideHeight=9999,this.maxLRRideHeight=-9999,this.rRRideHeight=new Float32Array(i),this.minRRRideHeight=9999,this.maxRRRideHeight=-9999,this.trackCoordinate=new n(t,i),this.lapTimeStr="",this.index=0,this.size=0,this.dataLapToCompare=null}setDataLapToCompare(t){this.dataLapToCompare=t}runSyncLaps(){if(null==this.dataLapToCompare)return console.log("No data lap to compare!"),this;var t=new Array(2);t[0]=new i(1),t[1]=new i(2);for(var e=0;e<this.size;e++)for(var a=2;a<this.dataLapToCompare.size;){if(this.lapDistMetersInt[e]==this.dataLapToCompare.lapDistMetersInt[a]){var s=this.dataLapToCompare,r=Math.abs(this.lapDistMeters[e]-s.lapDistMeters[a]),n=Math.abs(this.lapDistMeters[e]-s.lapDistMeters[a+1]),h=Math.abs(this.lapDistMeters[e]-s.lapDistMeters[a-1]),d=Math.abs(this.lapDistMeters[e]-s.lapDistMeters[a+2]),l=Math.abs(this.lapDistMeters[e]-s.lapDistMeters[a-2]),o=0;r<=n&&r<=h&&(o=0),n<=r&&n<=h&&(o=1,r=n),h<=r&&h<=n&&(o=-1,r=h),d<=r&&d<=l&&(o=2,r=d),l<=r&&l<=d&&(o=-2,r=l),a+=o;var c=this.lapCurrentTimeSeconds[e]-s.lapCurrentTimeSeconds[a];t[0].addLapCurrentTimeSeconds(c),t[1].addLapCurrentTimeSeconds(0),t[0].addLapDistPct(this.LapDistPct[e]),t[0].addLapDistMeters(this.lapDistMeters[e]),t[0].addLapDistMetersInt(this.lapDistMetersInt[e]),t[0].addThrottle(this.throttle[e]),t[0].addBrake(this.brake[e]),t[0].addAbsActive(this.absActive[e]),t[0].addSpeedKmh(this.speedKmh[e]),t[0].addGear(this.gear[e]),t[0].addRpm(this.rpm[e]),t[0].addSteer(this.steer[e]),t[0].addWindDir(this.windDir[e]),t[0].addWindVel(this.windVel[e]),t[0].addFuelLevel(this.fuelLevel[e]),t[0].addYawNorth(this.yawNorth[e]),t[0].tires.addLFtempL(this.tires.LFtempL[e]),t[0].tires.addLFtempM(this.tires.LFtempM[e]),t[0].tires.addLFtempR(this.tires.LFtempR[e]),t[0].tires.addRFtempL(this.tires.RFtempL[e]),t[0].tires.addRFtempM(this.tires.RFtempM[e]),t[0].tires.addRFtempR(this.tires.RFtempR[e]),t[0].tires.addLRtempL(this.tires.LRtempL[e]),t[0].tires.addLRtempM(this.tires.LRtempM[e]),t[0].tires.addLRtempR(this.tires.LRtempR[e]),t[0].tires.addRRtempL(this.tires.RRtempL[e]),t[0].tires.addRRtempM(this.tires.RRtempM[e]),t[0].tires.addRRtempR(this.tires.RRtempR[e]),t[0].addcFSRrideHeight(this.cFSRrideHeight[e]),t[0].addFrontRideHeight(this.lFRideHeight[e],this.rFRideHeight[e]),t[0].addRearRideHeight(this.lRRideHeight[e],this.rRRideHeight[e]),t[0].trackCoordinate.addLat(this.trackCoordinate.lat[e]),t[0].trackCoordinate.addLon(this.trackCoordinate.lon[e]),t[1].addLapDistPct(s.LapDistPct[a]),t[1].addLapDistMeters(s.lapDistMeters[a]),t[1].addLapDistMetersInt(s.lapDistMetersInt[a]),t[1].addThrottle(s.throttle[a]),t[1].addBrake(s.brake[a]),t[1].addAbsActive(s.absActive[a]),t[1].addSpeedKmh(s.speedKmh[a]),t[1].addGear(s.gear[a]),t[1].addRpm(s.rpm[a]),t[1].addSteer(s.steer[a]),t[1].addWindDir(s.windDir[a]),t[1].addWindVel(s.windVel[a]),t[1].addFuelLevel(s.fuelLevel[a]),t[1].addYawNorth(s.yawNorth[a]),t[1].tires.addLFtempL(s.tires.LFtempL[a]),t[1].tires.addLFtempM(s.tires.LFtempM[a]),t[1].tires.addLFtempR(s.tires.LFtempR[a]),t[1].tires.addRFtempL(s.tires.RFtempL[a]),t[1].tires.addRFtempM(s.tires.RFtempM[a]),t[1].tires.addRFtempR(s.tires.RFtempR[a]),t[1].tires.addLRtempL(s.tires.LRtempL[a]),t[1].tires.addLRtempM(s.tires.LRtempM[a]),t[1].tires.addLRtempR(s.tires.LRtempR[a]),t[1].tires.addRRtempL(s.tires.RRtempL[a]),t[1].tires.addRRtempM(s.tires.RRtempM[a]),t[1].tires.addRRtempR(s.tires.RRtempR[a]),t[1].addcFSRrideHeight(s.cFSRrideHeight[a]),t[1].addFrontRideHeight(s.lFRideHeight[a],s.rFRideHeight[a]),t[1].addRearRideHeight(s.lRRideHeight[a],s.rRRideHeight[a]),t[1].trackCoordinate.addLat(s.trackCoordinate.lat[a]),t[1].trackCoordinate.addLon(s.trackCoordinate.lon[a]),t[0].updateIndex(),t[0].updateSize(),t[0].trackCoordinate.updateIndex(),t[0].trackCoordinate.updateSize(),t[0].tires.updateIndex(),t[1].updateIndex(),t[1].updateSize(),t[1].trackCoordinate.updateIndex(),t[1].trackCoordinate.updateSize(),t[1].tires.updateIndex();break}a++}for(e=0;e<t.length;e++)t[e].optimizeArraySize();return t}getDataLapToCompare(){return this.dataLapToCompare}getLapTimeStr(){return this.lapTimeStr}getAirTemp(){return this.airTemp}getTrackTemp(){return this.trackTemp}getLapDistPctArray(){return this.LapDistPct}getLapCurrentTimeSecondsArray(){return this.lapCurrentTimeSeconds}getLapCurrentTimeSeconds(t){return this.lapCurrentTimeSeconds[t]}getThrottleArray(){return this.throttle}getBrakeArray(){return this.brake}getAbsAcvtiveArray(){return this.absActive}getSpeedKmhArray(){return this.speedKmh}getGearArray(){return this.gear}getRpmArray(){return this.rpm}getSteerArray(){return this.steer}getWindDirArray(){return this.windDir}getWindVelArray(){return this.windVel}getFuelLevelArray(){return this.fuelLevel}getYawNorthArray(){return this.yawNorth}getTires(){return this.tires}getCFSRrideHeightArray(){return this.cFSRrideHeight}getLFRideHeightArray(){return this.lFRideHeight}getRFRideHeightArray(){return this.rFRideHeight}getLRRideHeightArray(){return this.lRRideHeight}getRRRideHeightArray(){return this.rRRideHeight}getLapDistMetersArray(){return this.lapDistMeters}getLapDistMetersIntArray(){return this.lapDistMetersInt}getThrottle(t){return this.throttle[t]}getLapDistMeters(t){return this.lapDistMeters[t]}getLapDistMetersInt(t){return this.lapDistMetersInt[t]}updateIndex(){this.index+=1}updateSize(){this.size+=1}optimizeArraySize(){this.LapDistPct=this.LapDistPct.slice(0,this.size),this.lapDistMeters=this.lapDistMeters.slice(0,this.size),this.lapDistMetersInt=this.lapDistMetersInt.slice(0,this.size),this.lapCurrentTimeSeconds=this.lapCurrentTimeSeconds.slice(0,this.size),this.throttle=this.throttle.slice(0,this.size),this.brake=this.brake.slice(0,this.size),this.absActive=this.absActive.slice(0,this.size),this.speedKmh=this.speedKmh.slice(0,this.size),this.gear=this.gear.slice(0,this.size),this.rpm=this.rpm.slice(0,this.size),this.steer=this.steer.slice(0,this.size),this.windDir=this.windDir.slice(0,this.size),this.windVel=this.windVel.slice(0,this.size),this.fuelLevel=this.fuelLevel.slice(0,this.size),this.yawNorth=this.yawNorth.slice(0,this.size),this.tires.LFtempL=this.tires.LFtempL.slice(0,this.size),this.tires.LFtempM=this.tires.LFtempM.slice(0,this.size),this.tires.LFtempR=this.tires.LFtempR.slice(0,this.size),this.tires.RFtempL=this.tires.RFtempL.slice(0,this.size),this.tires.RFtempM=this.tires.RFtempM.slice(0,this.size),this.tires.RFtempR=this.tires.RFtempR.slice(0,this.size),this.tires.LRtempL=this.tires.LRtempL.slice(0,this.size),this.tires.LRtempM=this.tires.LRtempM.slice(0,this.size),this.tires.LRtempR=this.tires.LRtempR.slice(0,this.size),this.tires.RRtempL=this.tires.RRtempL.slice(0,this.size),this.tires.RRtempM=this.tires.RRtempM.slice(0,this.size),this.tires.RRtempR=this.tires.RRtempR.slice(0,this.size),this.cFSRrideHeight=this.cFSRrideHeight.slice(0,this.size),this.lFRideHeight=this.lFRideHeight.slice(0,this.size),this.rFRideHeight=this.rFRideHeight.slice(0,this.size),this.lRRideHeight=this.lRRideHeight.slice(0,this.size),this.rRRideHeight=this.rRRideHeight.slice(0,this.size),this.trackCoordinate.lat=this.trackCoordinate.lat.slice(0,this.size),this.trackCoordinate.lon=this.trackCoordinate.lon.slice(0,this.size)}setAirTemp(t){this.airTemp=t}setTrackTemp(t){this.trackTemp=t}setAirDensity(t){this.airDensity=t}setAirPressure(t){this.airPressure=t}addLapCurrentTimeSeconds(t){this.lapCurrentTimeSeconds[this.index]=t}addLapDistPct(t){this.LapDistPct[this.index]=t}addLapDistMeters(t){this.lapDistMeters[this.index]=t}addLapDistMetersInt(t){this.lapDistMetersInt[this.index]=t}addThrottle(t){this.throttle[this.index]=t}addBrake(t){this.brake[this.index]=t}addAbsActive(t){this.absActive[this.index]=t}addSpeedKmh(t){this.speedKmh[this.index]=t}addGear(t){this.gear[this.index]=t,t<this.minGear&&(this.minGear=t),t>this.maxGear&&(this.maxGear=t)}addRpm(t){this.rpm[this.index]=t}addSteer(t){this.steer[this.index]=t}addWindDir(t){this.windDir[this.index]=t}addWindVel(t){this.windVel[this.index]=t}addFuelLevel(t){this.fuelLevel[this.index]=t}addYawNorth(t){this.yawNorth[this.index]=t}addcFSRrideHeight(t){this.cFSRrideHeight[this.index]=t,this.minCFSRideHeight>t&&(this.minCFSRideHeight=t),this.maxCFSRideHeight<t&&(this.maxCFSRideHeight=t)}addFrontRideHeight(t,e){this.lFRideHeight[this.index]=t,this.rFRideHeight[this.index]=e,this.minLFRideHeight>t&&(this.minLFRideHeight=t),this.maxLFRideHeight<t&&(this.maxLFRideHeight=t),this.minRFRideHeight>e&&(this.minRFRideHeight=e),this.maxRFRideHeight<e&&(this.maxRFRideHeight=e)}addRearRideHeight(t,e){this.lRRideHeight[this.index]=t,this.rRRideHeight[this.index]=e,this.minLRRideHeight>t&&(this.minLRRideHeight=t),this.maxLRRideHeight<t&&(this.maxLRRideHeight=t),this.minRRRideHeight>e&&(this.minRRRideHeight=e),this.maxRRRideHeight<e&&(this.maxRRRideHeight=e)}setLapTimeSeconds(t){var e=this.lapCurrentTimeSeconds[this.size-1],i=Math.floor(e/60),a=e%60,s="";a<10&&(s="0"),this.lapTimeStr=i+":"+s+a.toFixed(3)}}class a{constructor(t,e){var i="small-"+t;if(this.isCanvasValid=!0,null!=document.getElementById(i)){this.titleText=e;var a=document.getElementById(i),s=a.clientWidth,r=a.clientHeight,n=a.parentElement;a.remove(),this.canvas=document.createElement("canvas"),this.canvas.id=i,this.canvas.className="small-canvas",this.canvas.width=s,this.canvas.height=r,n.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.currentData=new Array(2),this.subsCurrentData=new Array(2),this.lineColorMainData="rgb(72, 109, 232)",this.lineColorComparedData="rgb(197, 83, 5)"}else this.isCanvasValid=!1}putCurrentData(t,e){t>=2?console.log("Error: Could not add more than 2 data in small canvas!"):this.currentData[t]=e}putSubsCurrentData(t,e){t>=2?console.log("Error: Could not add more than 2 data in small canvas!"):this.subsCurrentData[t]=e}drawThrottleBrake(t){var e=0==t?10:40,i=this.canvas.height-55;this.ctx.beginPath(),this.ctx.fillStyle="Throttle"==this.titleText?"rgba(0, 165, 0, 1.0)":"rgba(165, 0, 0, 1.0)","Throttle"==this.titleText?this.ctx.fillStyle="rgba(0, 165, 0, 1.0)":this.ctx.fillStyle=1==this.subsCurrentData[t]?"rgba(255, 255, 255, 0.8)":"rgba(165, 0, 0, 1.0)",this.ctx.fillRect(e,20+i,20,-i*this.currentData[t]),this.ctx.beginPath(),this.ctx.lineWidth=2,this.ctx.strokeStyle=0==t?this.lineColorMainData:this.lineColorComparedData,this.ctx.strokeRect(e,20,20,i),this.ctx.beginPath(),this.ctx.fillStyle=0==t?this.lineColorMainData:this.lineColorComparedData,this.ctx.rect(e,this.canvas.height-30,20,10),this.ctx.fill()}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var t=0;t<this.currentData.length;t++)if(null!=this.currentData[t])switch(this.titleText){case"Throttle":case"Brake":this.drawThrottleBrake(t)}}}class s{constructor(t){this.file=t,this.header={},this.diskHeader={},this.varsHeader=[],this.dataLaps=null,this.data=null,this.sessionInfoBytes=null,this.sessionInfo={}}getHeader(){return this.header}getDiskHeader(){return this.diskHeader}getVarsHeader(){return this.varsHeader}getData(){return this.data}getDataLaps(){return this.dataLaps}getOneDataLap(t){return this.dataLaps[t]}isValid(){return null!=this.file}read(){if(this.isValid()){var t=this;return new Promise((function(e,i){var a=new FileReader;a.onloadend=function(i){t.extractData(i.target.result),e(i.target.result)},a.onerror=function(t){i(t.target.error.message)},a.readAsArrayBuffer(t.file)}))}}extractData(t){var e=new DataView(t,0,112);this.header.version=e.getUint32(0,!0),this.header.status=e.getUint32(4,!0),this.header.tick_rate=e.getUint32(8,!0),this.header.session_info_update=e.getUint32(12,!0),this.header.session_info_length=e.getUint32(16,!0),this.header.session_info_offset=e.getUint32(20,!0),this.header.num_vars=e.getUint32(24,!0),this.header.var_header_offset=e.getUint32(28,!0),this.header.num_buf=e.getUint32(32,!0),this.header.buf_len=e.getUint32(36,!0),this.header.buf_offset=e.getUint32(52,!0);var i=new DataView(t,112,32);this.diskHeader.start_date=i.getFloat64(0,!0),this.diskHeader.start_time=i.getFloat64(8,!0),this.diskHeader.end_time=i.getFloat64(16,!0),this.diskHeader.lap_count=i.getUint32(24,!0),this.diskHeader.record_count=i.getUint32(28,!0);for(var a=new DataView(t,this.header.var_header_offset,144*this.header.num_vars),s=0,r=0;r<this.header.num_vars;r++)this.varsHeader.push({type:a.getUint32(s+0,!0),offset:a.getUint32(s+4,!0),count:a.getUint32(s+8,!0),count_as_time:a.getUint8(s+12,!0),name:this.convertToString(a,s+16,s+16+32),desc:null,unit:null}),s+=144;this.sessionInfoBytes=new Uint8Array(t.slice(this.header.session_info_offset,this.header.session_info_offset+this.header.session_info_length)),this.loadSessionInfo(),this.data=new Uint8Array(t.slice(this.header.buf_offset)),this.loadDataLaps()}print(){console.log(this.header),console.log(this.diskHeader),console.log(this.varsHeader),console.log(this.sessionInfo),console.log("Data Length:",this.data.length)}convertToString(t,e,i){for(var a="",s=i-e,r=0;r<s;r++){a+=0==t.getUint8(r+e)?"":String.fromCharCode(t.getUint8(r+e))}return a}initArrayOfDataLap(t){for(var e=new Array(t),a=1;a<=t;a++)e[a-1]=new i(a);return e}loadDataLaps(){for(var t=this.diskHeader.lap_count,e=this.initArrayOfDataLap(t),i=this.data.length/this.header.buf_len,a=0,s=this.getHeaderData("Lap",0).content,r=0,n=0,h=0,d=[],l=0;l<i;l++){if((a=this.getHeaderData("Lap",l).content)!=s){if(e[h].setLapTimeSeconds(0),e[h].optimizeArraySize(),n+1>=this.diskHeader.lap_count){t+=1;for(var o=this.initArrayOfDataLap(t),c=0;c<e.length;c++)o[c]=e[c];e=o,o=null}n++}0==this.getHeaderData("EnterExitReset",l).content&&d.push(s);var p=this.getHeaderData("LapDistPct",l).content,m=parseFloat(this.getHeaderData("LapDist",l).content),g=parseInt(m),R=this.getHeaderData("AirTemp",l).content.toFixed(1),x=this.getHeaderData("TrackTemp",l).content.toFixed(1),L=this.getHeaderData("AirDensity",l).content.toFixed(1),u=this.getHeaderData("AirPressure",l).content.toFixed(1),f=0;g>210&&(f=parseFloat(this.getHeaderData("LapCurrentLapTime",l).content));var v=this.getHeaderData("Throttle",l).content,M=this.getHeaderData("Brake",l).content,F=this.getHeaderData("BrakeABSactive",l).content,w=(3600*this.getHeaderData("Speed",l).content/1e3/320).toFixed(3),T=this.getHeaderData("Gear",l).content,y=this.getHeaderData("RPM",l).content,A=this.getHeaderData("SteeringWheelAngle",l).content,C=this.getHeaderData("WindDir",l).content,D=3.6*this.getHeaderData("WindVel",l).content,I=this.getHeaderData("FuelLevel",l).content,H=this.getHeaderData("YawNorth",l).content,b=1e3*this.getHeaderData("CFSRrideHeight",l).content,S=1e3*this.getHeaderData("LFrideHeight",l).content,k=1e3*this.getHeaderData("RFrideHeight",l).content,z=1e3*this.getHeaderData("LRrideHeight",l).content,W=1e3*this.getHeaderData("RRrideHeight",l).content,P=this.getHeaderData("Lat",l).content,E=this.getHeaderData("Lon",l).content;e[n].lapNumber=a,e[n].setAirTemp(R),e[n].setTrackTemp(x),e[n].setAirDensity(L),e[n].setAirPressure(u),e[n].addLapCurrentTimeSeconds(f),e[n].addLapDistPct(p),e[n].addLapDistMeters(m),e[n].addLapDistMetersInt(g),v<0&&(v=0),M<0&&(M=0),e[n].addThrottle(v),e[n].addBrake(M),e[n].addAbsActive(F),e[n].addSpeedKmh(w),0==T&&(T=r),e[n].addGear(T),e[n].addRpm(y),e[n].addSteer(A),e[n].addWindDir(C),e[n].addWindVel(D),e[n].addFuelLevel(I),e[n].addYawNorth(H),e[n].tires.addLFtempL(this.getHeaderData("LFtempL",l).content),e[n].tires.addLFtempM(this.getHeaderData("LFtempM",l).content),e[n].tires.addLFtempR(this.getHeaderData("LFtempR",l).content),e[n].tires.addRFtempL(this.getHeaderData("RFtempL",l).content),e[n].tires.addRFtempM(this.getHeaderData("RFtempM",l).content),e[n].tires.addRFtempR(this.getHeaderData("RFtempR",l).content),e[n].tires.addLRtempL(this.getHeaderData("LRtempL",l).content),e[n].tires.addLRtempM(this.getHeaderData("LRtempM",l).content),e[n].tires.addLRtempR(this.getHeaderData("LRtempR",l).content),e[n].tires.addRRtempL(this.getHeaderData("RRtempL",l).content),e[n].tires.addRRtempM(this.getHeaderData("RRtempM",l).content),e[n].tires.addRRtempR(this.getHeaderData("RRtempR",l).content),e[n].addcFSRrideHeight(b),e[n].addFrontRideHeight(S,k),e[n].addRearRideHeight(z,W),e[n].trackCoordinate.addLat(P),e[n].trackCoordinate.addLon(E),e[n].updateSize(),e[n].updateIndex(),e[n].trackCoordinate.updateSize(),e[n].trackCoordinate.updateIndex(),e[n].tires.updateIndex(),s=a,h=n,r=T}e[n].setLapTimeSeconds(0),e[n].optimizeArraySize();for(var O=0,_=e.length;O<_;)0!=e[O].lapNumber?d.includes(e[O].lapNumber)?(e.splice(O,1),_-=1,O=0):O++:(e.splice(O,1),_-=1,O=0);d=null,this.dataLaps=e}getHeaderData(t,e){for(var i=null,a=0;a<this.varsHeader.length;a++)if(this.varsHeader[a].name==t){i=this.varsHeader[a];break}if(null==i)return i={content:0};var s=e*this.header.buf_len+i.offset;switch(i.type){case 0:i.content_type="string";var r=this.data.slice(s,s+8),n="";for(a=0;a<8;a++){n+=0==r[a]?"":String.fromCharCode(r[a])}i.content=n,8;break;case 1:i.content_type="boolean";r=this.data.slice(s,s+1);i.content=255&r,1;break;case 2:i.content_type="int32";var h=4294967295&((r=this.data.slice(s,s+4))[0]|r[1]<<8|r[2]<<16|r[3]<<24);i.content=h,4;break;case 3:h=4294967295&((r=this.data.slice(s,s+4))[0]|r[1]<<8|r[2]<<16|r[3]<<24);i.content_type="uint32",i.content=h,4;break;case 4:i.content_type="float32";r=this.data.slice(s,s+4);var d=new ArrayBuffer(4);(l=new DataView(d)).setUint8(0,r[0]),l.setUint8(1,r[1]),l.setUint8(2,r[2]),l.setUint8(3,r[3]),i.content=l.getFloat32(0,!0),4;break;case 5:i.content_type="float64";var l;r=this.data.slice(s,s+8),d=new ArrayBuffer(8);(l=new DataView(d)).setInt8(0,r[0]),l.setInt8(1,r[1]),l.setInt8(2,r[2]),l.setInt8(3,r[3]),l.setInt8(4,r[4]),l.setInt8(5,r[5]),l.setInt8(6,r[6]),l.setInt8(7,r[7]),i.content=l.getFloat64(0,!0),8;break;default:console.log("default")}return i}loadSessionInfo(){for(var t=0,e="";t<this.sessionInfoBytes.length;)e+=String.fromCharCode(this.sessionInfoBytes[t]),t++;this.sessionInfo=jsyaml.load(e)}}class r{constructor(){var t="track-canvas",e=document.getElementById(t),i=e.clientWidth,a=e.clientHeight,s=e.parentElement;e.remove(),this.canvas=document.createElement("canvas"),this.canvas.className=e.className,this.canvas.id=t,this.canvas.width=i,this.canvas.height=a,s.appendChild(this.canvas),this.widthForTrack=this.canvas.width,this.heightForTrack=this.canvas.height,this.ctx=this.canvas.getContext("2d"),this.currentIndexAt=0,this.trackCoordinates=new Array(2),this.steerAngles=new Array(2),this.windDirs=new Array(2),this.carsYaw=new Array(2),this.LFtemp={left:new Array(2),middle:new Array(2),right:new Array(2)},this.RFtemp={left:new Array(2),middle:new Array(2),right:new Array(2)},this.LRtemp={left:new Array(2),middle:new Array(2),right:new Array(2)},this.RRtemp={left:new Array(2),middle:new Array(2),right:new Array(2)},this.steerImgs=new Array(2),this.steerImgs[0]=document.getElementById("steeringWheel1"),this.steerImgs[1]=document.getElementById("steeringWheel2"),this.windDirImgs=new Array(2),this.windDirImgs[0]=document.getElementById("windDir1"),this.windDirImgs[1]=document.getElementById("windDir2"),this.compassImg=document.getElementById("arrow-compass"),this.carDirImgs=new Array(2),this.carDirImgs[0]=document.getElementById("carDir-main"),this.carDirImgs[1]=document.getElementById("carDir-compared"),this.xTranslate=0,this.yTranslate=0,this.zoom=.8,this.trackLineColorMain="rgb(72, 109, 232)",this.trackLineColorCompared="rgb(197, 83, 5)",this.circleSize=4,this.drawTestLines(),this.activeMoveTrack()}setZoom(t){this.zoom=t}setTranslate(t,e){this.xTranslate=t,this.yTranslate=e}setTrackCoordinates(t,e){t>=2?console.log("Error: You Cannot Set More Than 2 data Laps!"):(this.trackCoordinates[t]=e,this.trackCoordinates[t].generateXY(this.widthForTrack,this.heightForTrack))}setSteerAngles(t,e){t>=2?console.log("Error: You Cannot Set More Than 2 data Laps!"):this.steerAngles[t]=e}setWindDirs(t,e){t>=2?console.log("Error: You Cannot Set More Than 2 data Laps!"):this.windDirs[t]=e}setCarsYaw(t,e){t>=2?console.log("Error: You Cannot Set More Than 2 data Laps!"):this.carsYaw[t]=e}setTiresFrontTemp(t,e,i,a,s,r,n){this.LFtemp.left[t]=e,this.LFtemp.middle[t]=i,this.LFtemp.right[t]=a,this.RFtemp.left[t]=s,this.RFtemp.middle[t]=r,this.RFtemp.right[t]=n}setTiresRearTemp(t,e,i,a,s,r,n){this.LRtemp.left[t]=e,this.LRtemp.middle[t]=i,this.LRtemp.right[t]=a,this.RRtemp.left[t]=s,this.RRtemp.middle[t]=r,this.RRtemp.right[t]=n}updateCurrentIndexAt(t){this.currentIndexAt=t,this.draw()}resetTrackPositionOnCanvas(){this.zoom=.8,this.xTranslate=this.canvas.width/4,this.yTranslate=10,this.draw()}activeMoveTrack(){var t=this,e=!1,i=0,a=0;this.canvas.addEventListener("mousedown",(function(s){null==t.trackCoordinates[0]&&null==t.trackCoordinates[1]||(i=s.pageX-t.xTranslate,a=s.pageY-t.yTranslate,e=!0)})),this.canvas.addEventListener("mousemove",(function(s){e&&(t.xTranslate=s.pageX-i,t.yTranslate=s.pageY-a,t.draw())})),this.canvas.addEventListener("mouseup",(function(){e&&(e=!1)})),this.canvas.addEventListener("mouseout",(function(){e&&(e=!1)}));var s=0,r=0,n=0,h=0;this.canvas.addEventListener("wheel",(function(e){null==t.trackCoordinates[0]&&null==t.trackCoordinates[1]||(e.preventDefault(),s=e.offsetX,r=e.offsetY,n=e.deltaY>0?.9:1.1,(h=t.zoom*n)>20||h<.1||(t.xTranslate=s-(s-t.xTranslate)*n,t.yTranslate=r-(r-t.yTranslate)*n,t.zoom=h,t.draw()))})),window.onscroll=function(){var t=document.querySelectorAll(".data-canvas")[0],e=document.querySelectorAll(".track")[0],i=window.scrollY;i+e.clientHeight>=t.clientHeight||(e.style.top=i+"px")}}convertLatLonToCanvas(t,e){var i=this.trackCoordinates[t];const a=i.maxLat-i.minLat,s=i.maxLon-i.minLon,r=Math.max(a,s),n=this.widthForTrack/r;return{x:(i.lon[e]-i.minLon)*n,y:this.heightForTrack-(i.lat[e]-i.minLat)*n}}drawTestLines(){this.ctx.fillStyle=this.trackLineColorMain,this.ctx.strokeStyle=this.trackLineColorCompared,this.ctx.beginPath(),this.ctx.font="bold 48px Arial",this.ctx.fillText("TRACK",this.canvas.width/2-92,this.canvas.height/2),this.ctx.strokeText("TRACK",this.canvas.width/2-92,this.canvas.height/2)}drawCircleOnTrack(){for(var t=12/this.zoom,e=t/2,i=0;i<this.carDirImgs.length;i++)if(null!=this.trackCoordinates[i]){this.ctx.beginPath();var a=this.trackCoordinates[i].getXY(this.currentIndexAt);this.ctx.save(),this.ctx.translate(a.x,a.y),this.ctx.rotate(this.carsYaw[i][this.currentIndexAt]),this.ctx.drawImage(this.carDirImgs[i],-e,-e,t,t),this.ctx.restore()}}drawSteerAngles(){if(null!=this.steerAngles[0]||null!=this.steerAngles[1])for(var t=10,e=this.canvas.width-70,i=0;i<this.steerAngles.length;i++)null!=this.steerAngles[i]&&(t=t+60*i+8,this.ctx.beginPath(),this.ctx.fillStyle=0==i?this.trackLineColorMain:this.trackLineColorCompared,this.ctx.textAlign="center",this.ctx.font="12px Arial",this.ctx.fillText((-this.steerAngles[i][this.currentIndexAt]*(180/Math.PI)).toFixed(1)+"°",e+30,t+2),this.ctx.beginPath(),this.ctx.save(),this.ctx.translate(e+30,t+30),this.ctx.rotate(-this.steerAngles[i][this.currentIndexAt]),this.ctx.drawImage(this.steerImgs[i],-30,-30,60,60),this.ctx.restore(),this.ctx.fillStyle=0==i?this.trackLineColorMain:this.trackLineColorCompared,this.ctx.arc(e+30,t+30,4,0,2*Math.PI),this.ctx.fill())}drawWindDir(){if(null!=this.steerAngles[0]||null!=this.steerAngles[1])for(var t=10,e=0;e<this.windDirs.length;e++)null!=this.windDirs[e]&&(t+=0==e?30:60,this.ctx.beginPath(),this.ctx.save(),this.ctx.translate(42.5,t+12.5),this.ctx.drawImage(this.compassImg,-32,-28,60,60),this.ctx.rotate(this.windDirs[e][this.currentIndexAt]),this.ctx.drawImage(this.windDirImgs[e],-12.5,-12.5,25,25),this.ctx.restore())}drawTires(){for(var t=20,e=50,i=0;i<2;i++)if(null!=this.LFtemp.left[i]){var a=0==i?15:95;this.ctx.lineWidth=2,this.ctx.strokeStyle=0==i?this.trackLineColorMain:this.trackLineColorCompared,this.ctx.rect(a,this.canvas.height-160,72,140),this.ctx.stroke(),t=0==i?20:100,this.ctx.fillStyle="rgb(255, 255, 255)";var s=150,r=0,n=0,h=0;this.ctx.beginPath(),r=this.LFtemp.left[i][this.currentIndexAt]/s*255,this.ctx.fillStyle="rgb("+r+", "+(255-r)+", 0)",this.ctx.fillRect(t,this.canvas.height-150,8,e),n=this.LFtemp.middle[i][this.currentIndexAt]/s*255,this.ctx.fillStyle="rgb("+n+", "+(255-n)+", 0)",this.ctx.fillRect(t+8+2,this.canvas.height-150,8,e),h=this.LFtemp.right[i][this.currentIndexAt]/s*255,this.ctx.fillStyle="rgb("+h+", "+(255-h)+", 0)",this.ctx.fillRect(t+16+4,this.canvas.height-150,8,e),t+=34,r=this.RFtemp.left[i][this.currentIndexAt]/s*255,this.ctx.fillStyle="rgb("+r+", "+(255-r)+", 0)",this.ctx.fillRect(t,this.canvas.height-150,8,e),n=this.RFtemp.middle[i][this.currentIndexAt]/s*255,this.ctx.fillStyle="rgb("+r+", "+(255-r)+", 0)",this.ctx.fillRect(t+8+2,this.canvas.height-150,8,e),h=this.RFtemp.right[i][this.currentIndexAt]/s*255,this.ctx.fillStyle="rgb("+r+", "+(255-r)+", 0)",this.ctx.fillRect(t+16+4,this.canvas.height-150,8,e),this.ctx.beginPath(),t=0==i?20:100,r=this.LRtemp.left[i][this.currentIndexAt]/s*255,this.ctx.fillStyle="rgb("+r+", "+(255-r)+", 0)",this.ctx.fillRect(t,this.canvas.height-80,8,e),n=this.LRtemp.middle[i][this.currentIndexAt]/s*255,this.ctx.fillStyle="rgb("+r+", "+(255-r)+", 0)",this.ctx.fillRect(t+8+2,this.canvas.height-80,8,e),h=this.LRtemp.right[i][this.currentIndexAt]/s*255,this.ctx.fillStyle="rgb("+r+", "+(255-r)+", 0)",this.ctx.fillRect(t+16+4,this.canvas.height-80,8,e),t+=34,r=this.RRtemp.left[i][this.currentIndexAt]/s*255,this.ctx.fillStyle="rgb("+r+", "+(255-r)+", 0)",this.ctx.fillRect(t,this.canvas.height-80,8,e),n=this.RRtemp.middle[i][this.currentIndexAt]/s*255,this.ctx.fillStyle="rgb("+r+", "+(255-r)+", 0)",this.ctx.fillRect(t+8+2,this.canvas.height-80,8,e),h=this.RRtemp.right[i][this.currentIndexAt]/s*255,this.ctx.fillStyle="rgb("+r+", "+(255-r)+", 0)",this.ctx.fillRect(t+16+4,this.canvas.height-80,8,e)}}drawTrackSurface(){}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.translate(this.xTranslate,this.yTranslate),this.ctx.scale(this.zoom,this.zoom),this.ctx.lineWidth=1/this.zoom;for(let r=0;r<this.trackCoordinates.length;r++)if(null!=this.trackCoordinates[r]&&null!=this.trackCoordinates[r]){var t=this.trackCoordinates[r],e=this.trackCoordinates[r].getXY(0);this.ctx.strokeStyle=0==r?this.trackLineColorMain:this.trackLineColorCompared;var i=e.x,a=e.y;this.ctx.beginPath();for(var s=1;s<t.size;s++)e=this.trackCoordinates[r].getXY(s),this.ctx.moveTo(i,a),i=e.x,a=e.y,e.x*this.zoom-5+this.xTranslate>this.canvas.width||e.x*this.zoom+this.xTranslate<-5||e.y*this.zoom-5+this.yTranslate>this.canvas.height||e.y*this.zoom+this.yTranslate<-5||this.ctx.lineTo(e.x,e.y);this.ctx.stroke()}this.drawCircleOnTrack(),this.ctx.restore(),this.drawSteerAngles(),this.drawWindDir(),this.drawTires()}}class n{constructor(t,e){this.lapNum=t,this.lat=new Float64Array(e),this.lon=new Float64Array(e),this.x=new Float64Array(e),this.y=new Float64Array(e),this.minLat=9999,this.maxLat=-9999,this.minLon=9999,this.maxLon=-9999,this.latRange=0,this.lonRange=0,this.maxRange=0,this.scale=0,this.size=0,this.index=0}updateSize(){this.size+=1}updateIndex(){this.index+=1}generateXY(t,e){this.scale=t/this.maxRange;for(var i=0;i<this.size;i++)this.x[i]=(this.lon[i]-this.minLon)*this.scale,this.y[i]=e-(this.lat[i]-this.minLat)*this.scale}getX(t){return this.x[t]}getY(t){return this.y[t]}getXY(t){return{x:this.x[t],y:this.y[t]}}#t(){this.latRange=this.maxLat-this.minLat,this.lonRange=this.maxLon-this.minLon,this.maxRange=Math.max(this.latRange,this.lonRange)}addLat(t){this.lat[this.index]=t,this.minLat>t&&(this.minLat=t),this.maxLat<t&&(this.maxLat=t),this.#t()}addLon(t){this.lon[this.index]=t,this.minLon>t&&(this.minLon=t),this.maxLon<t&&(this.maxLon=t),this.#t()}getLatArray(){return this.lat}getLonArray(){return this.lon}}var h=document.getElementById("form_data");null==h&&console.log("Error: Could not find the form to upload");var d=document.querySelector(".loading_div");function l(){d.style.display="none"}var o=document.querySelectorAll(".str_file_name"),c=new Array(2),p=[{},{}],m=new Array(14),g=new class{constructor(){this.allCanvases=[],this.TrackCanvas=new r,this.isMouseDown=!1,this.xData=new Array(2),this.fuelLevels=new Array(2),this.windVel=new Array(2),this.filesInfoElements=[document.querySelectorAll(".file1Info"),document.querySelectorAll(".file2Info")],this.MAX_SELECTION=200}addCanvas(t){this.allCanvases.push(t)}clearAllCanvas(){this.allCanvases=[],this.TrackCanvas=new r}getTrackCanvas(){return this.TrackCanvas}setXData(t,e){this.xData[t]=e}setFuelLevel(t,e){this.fuelLevels[t]=e}setWindVel(t,e){this.windVel[t]=e}activeOnMouseMove(){var t=this;for(let e=0;e<this.allCanvases.length;e++)this.allCanvases[e].getCanvas().onmousemove=function(i){t.allCanvases[e].xPosAt=i.offsetX-t.allCanvases[e].getOffsetX();var a=t.allCanvases[e].xPosAt/(t.allCanvases[e].canvas.width-t.allCanvases[e].getOffsetX());for(let e=0;e<t.allCanvases.length;e++)t.canvasOnMouseMove(i,a,t.allCanvases[e],t)},this.allCanvases[e].getCanvas().onmousedown=function(i){t.canvasOnMouseDown(i,t.allCanvases[e])},this.allCanvases[e].getCanvas().ondblclick=function(){t.TrackCanvas.resetTrackPositionOnCanvas();for(let e=0;e<t.allCanvases.length;e++)t.allCanvases[e].resetStartEndMeters()}}canvasOnMouseMove(t,e,i,a){if(i.xPosAt=e*(i.canvas.width-i.getOffsetX()),!(i.xPosAt<0||i.xPosAt+i.getOffsetX()>=i.canvas.width)){var s=i.xPosAt+i.getOffsetX();i.draw();var r=i.getCurrentIndexAt(),n=a.xData[0][r];i.ctx.beginPath(),i.ctx.font="bold 10px Arial",i.ctx.textAlign="center",i.ctx.fillStyle="rgba(255, 255, 255, 1.0)",i.ctx.fillText(n+"m",s,i.getCanvas().height-10),a.TrackCanvas.updateCurrentIndexAt(r),null!=i.getCurrentIndexAt()&&null!=a.fuelLevels[0]&&(a.filesInfoElements[0][2].textContent=parseFloat(a.windVel[0][r]).toFixed(1)+"km/h",a.filesInfoElements[0][3].textContent=parseFloat(a.fuelLevels[0][r]).toFixed(2)+"L"),null!=i.getCurrentIndexAt()&&null!=a.fuelLevels[1]&&(a.filesInfoElements[1][2].textContent=parseFloat(a.windVel[1][r]).toFixed(1)+"km/h",a.filesInfoElements[1][3].textContent=parseFloat(a.fuelLevels[1][r]).toFixed(2)+"L")}}canvasOnMouseDown(t,e){var i=t.offsetX,a=e.getCurrentIndexAt(),s=0;if(!(i<0)){this.isMouseDown=!0;var r=this;window.onmousemove=function(t){r.isMouseDown&&(t.offsetX-e.getOffsetX()<0||(s=e.getCurrentIndexAt(),r.highlightsSelectedPart(a,s)))},window.onmouseup=function(){if(r.isMouseDown){if(a+s!=a&&Math.abs(a-s)>r.MAX_SELECTION){if(a>s){var t=a;a=s,s=t}for(var e=0;e<r.allCanvases.length;e++)r.allCanvases[e].setStartEndIndex(a,s)}r.isMouseDown=!1}}}}highlightsSelectedPart(t,e){for(var i=0,a=0;a<this.allCanvases.length;a++){var s=this.allCanvases[a].ctx;s.beginPath(),s.fillStyle="rgba(255, 255, 255, 0.2)",i=e-t,s.fillRect(this.allCanvases[a].getOffsetX()+(t-this.allCanvases[a].startMetersIndex)*this.allCanvases[a].stepsX,0,i*this.allCanvases[a].stepsX,this.allCanvases[a].getCanvas().height)}}},R=new Array(2);function x(){m[0]=new t("delta","Delta"),m[0].setIsTranslateCenter(!0),m[1]=new t("throttle","Throttle"),m[2]=new t("brake","Brake"),m[3]=new t("speed","Speed"),m[4]=new t("gear","Gear"),m[5]=new t("CFSRideHeight","CFSRideHeight"),m[6]=new t("LFRideHeight","Left front"),m[7]=new t("RFRideHeight","Right front"),m[8]=new t("LRRideHeight","Left rear"),m[9]=new t("RRRideHeight","Right rear"),m[10]=new t("LFTemps","LF Temps (OMI)"),m[11]=new t("RFTemps","RF Temps (IMO)"),m[12]=new t("LRTemps","LR Temps (OMI)"),m[13]=new t("RRTemps","RR Temps (IMO)"),g.clearAllCanvas();for(var e=0;e<m.length;e++)null!=m[e]&&(m[e].clear(),g.addCanvas(m[e]))}function L(t,e,i){for(var a=document.querySelectorAll("."+t),s=0;s<a.length;s++)a[s].className="lapSelector "+t;var r=document.querySelector(".ul-style[data-file-index='"+e+"']").querySelectorAll("."+t)[i];"box1"==t&&(r.classList.add("selectedBox1"),R[0]={fileIndex:e,lapIndex:i}),"box2"==t&&(r.classList.add("selectedBox2"),R[1]={fileIndex:e,lapIndex:i})}function u(t,e){x();var i=parseInt(e.parentElement.parentElement.getAttribute("data-file-index")),a=parseInt(e.parentElement.getAttribute("data-lap"));"box1"==t&&(R[0].fileIndex==i&&R[0].lapIndex==a?(e.classList.remove("selectedBox1"),R[0]={fileIndex:-1,lapIndex:-1}):(R[0]={fileIndex:i,lapIndex:a},L(t,i,a))),"box2"==t&&(R[1].fileIndex==i&&R[1].lapIndex==a?(e.classList.remove("selectedBox2"),R[1]={fileIndex:-1,lapIndex:-1}):(R[1]={fileIndex:i,lapIndex:a},L(t,i,a))),-1!=R[0].lapIndex||-1!=R[1].lapIndex?(!function(){if(-1!=R[0].fileIndex&&c[R[0].fileIndex].isValid()&&-1!=R[0].lapIndex&&-1==R[1].lapIndex){var t=R[0].fileIndex,e=R[0].lapIndex,i=c[t].getOneDataLap(e),a=new Float32Array(i.size);m[0].setLap(0,0,a),m[0].draw(),m[1].setLap(0,0,i.getThrottleArray()),m[1].draw(),m[2].setLap(0,0,i.getBrakeArray()),m[2].setSubscribeData(0,i.getAbsAcvtiveArray()),m[2].draw(),m[3].setLap(0,0,i.getSpeedKmhArray()),m[3].draw(),m[4].setLap(0,0,i.getGearArray()),m[4].setSubscribeData(0,i.getRpmArray()),m[4].setMinMaxData(0,i.maxGear,0,1),m[4].draw(),m[5].boxWidth=56,m[5].setLap(0,0,i.getCFSRrideHeightArray()),m[5].setMinMaxData(i.minCFSRideHeight,i.maxCFSRideHeight,0,1),m[5].draw(),m[6].boxWidth=56,m[6].setLap(0,0,i.getLFRideHeightArray()),m[6].setMinMaxData(i.minLFRideHeight,i.maxLFRideHeight,0,1),m[6].draw(),m[7].boxWidth=56,m[7].setLap(0,0,i.getRFRideHeightArray()),m[7].setMinMaxData(i.minRFRideHeight,i.maxRFRideHeight,0,1),m[7].draw(),m[8].boxWidth=56,m[8].setLap(0,0,i.getLRRideHeightArray()),m[8].setMinMaxData(i.minLRRideHeight,i.maxLRRideHeight,0,1),m[8].draw(),m[9].boxWidth=56,m[9].setLap(0,0,i.getRRRideHeightArray()),m[9].setMinMaxData(i.minRRRideHeight,i.maxRRRideHeight,0,1),m[9].draw(),m[10].boxWidth=100,m[10].setLap(0,0,i.tires.LFtempL),m[10].setLap(0,1,i.tires.LFtempM),m[10].setLap(0,2,i.tires.LFtempR),m[10].setMinMaxData(0,110,0,1),m[10].draw(),m[11].boxWidth=100,m[11].setLap(0,0,i.tires.RFtempL),m[11].setLap(0,1,i.tires.RFtempM),m[11].setLap(0,2,i.tires.RFtempR),m[11].setMinMaxData(0,110,0,1),m[11].draw(),m[12].boxWidth=100,m[12].setLap(0,0,i.tires.LRtempL),m[12].setLap(0,1,i.tires.LRtempM),m[12].setLap(0,2,i.tires.LRtempR),m[12].setMinMaxData(0,110,0,1),m[12].draw(),m[13].boxWidth=100,m[13].setLap(0,0,i.tires.RRtempL),m[13].setLap(0,1,i.tires.RRtempM),m[13].setLap(0,2,i.tires.RRtempR),m[13].setMinMaxData(0,110,0,1),m[13].draw(),g.setXData(0,i.getLapDistMetersIntArray()),g.getTrackCanvas().setTrackCoordinates(0,i.trackCoordinate),g.getTrackCanvas().setSteerAngles(0,i.getSteerArray()),g.getTrackCanvas().setWindDirs(0,i.getWindDirArray()),g.getTrackCanvas().setCarsYaw(0,i.getYawNorthArray()),g.getTrackCanvas().setTiresFrontTemp(0,i.tires.LFtempL,i.tires.LFtempM,i.tires.LFtempR,i.tires.RFtempL,i.tires.RFtempM,i.tires.RFtempR),g.getTrackCanvas().setTiresRearTemp(0,i.tires.LRtempL,i.tires.LRtempM,i.tires.LRtempR,i.tires.RRtempL,i.tires.RRtempM,i.tires.RRtempR),g.setWindVel(0,i.getWindVelArray()),g.setFuelLevel(0,i.getFuelLevelArray()),g.getTrackCanvas().draw(),f(0,i.airTemp,i.trackTemp,i.windVel[0],i.fuelLevel[0])}if(-1!=R[1].fileIndex&&c[R[1].fileIndex].isValid()&&-1!=R[1].lapIndex&&-1==R[0].lapIndex){t=R[1].fileIndex,e=R[1].lapIndex;var s=c[t].getOneDataLap(e);a=new Float32Array(s.size);m[0].setLap(1,0,a),m[0].draw(),m[1].setLap(1,0,s.getThrottleArray()),m[1].draw(),m[2].setLap(1,0,s.getBrakeArray()),m[2].setSubscribeData(1,s.getAbsAcvtiveArray()),m[2].draw(),m[3].setLap(1,0,s.getSpeedKmhArray()),m[3].draw(),m[4].setLap(1,0,s.getGearArray()),m[4].setSubscribeData(1,s.getRpmArray()),m[4].setMinMaxData(0,s.maxGear,0,1),m[4].draw(),m[5].boxWidth=56,m[5].setLap(1,0,s.getCFSRrideHeightArray()),m[5].setMinMaxData(s.minCFSRideHeight,s.maxCFSRideHeight,0,1),m[5].draw(),m[6].boxWidth=56,m[6].setLap(1,0,s.getLFRideHeightArray()),m[6].setMinMaxData(s.minLFRideHeight,s.maxLFRideHeight,0,1),m[6].draw(),m[7].boxWidth=56,m[7].setLap(1,0,s.getRFRideHeightArray()),m[7].setMinMaxData(s.minRFRideHeight,s.maxRFRideHeight,0,1),m[7].draw(),m[8].boxWidth=56,m[8].setLap(1,0,s.getLRRideHeightArray()),m[8].setMinMaxData(s.minLRRideHeight,s.maxLRRideHeight,0,1),m[8].draw(),m[9].boxWidth=56,m[9].setLap(1,0,s.getRRRideHeightArray()),m[9].setMinMaxData(s.minRRRideHeight,s.maxRRRideHeight,0,1),m[9].draw(),m[10].boxWidth=100,m[10].setLap(1,0,i.tires.LFtempL),m[10].setLap(1,1,i.tires.LFtempM),m[10].setLap(1,2,i.tires.LFtempR),m[10].setMinMaxData(0,110,0,1),m[10].draw(),m[11].boxWidth=100,m[11].setLap(1,0,i.tires.RFtempL),m[11].setLap(1,1,i.tires.RFtempM),m[11].setLap(1,2,i.tires.RFtempR),m[11].setMinMaxData(0,110,0,1),m[11].draw(),m[12].boxWidth=100,m[12].setLap(1,0,i.tires.LRtempL),m[12].setLap(1,1,i.tires.LRtempM),m[12].setLap(1,2,i.tires.LRtempR),m[12].setMinMaxData(0,110,0,1),m[12].draw(),m[13].boxWidth=100,m[13].setLap(1,0,i.tires.RRtempL),m[13].setLap(1,1,i.tires.RRtempM),m[13].setLap(1,2,i.tires.RRtempR),m[13].setMinMaxData(0,110,0,1),m[13].draw(),g.setXData(0,s.getLapDistMetersIntArray()),g.getTrackCanvas().setTrackCoordinates(1,s.trackCoordinate),g.getTrackCanvas().setSteerAngles(1,s.getSteerArray()),g.getTrackCanvas().setWindDirs(1,s.getWindDirArray()),g.getTrackCanvas().setCarsYaw(1,s.getYawNorthArray()),g.getTrackCanvas().setTiresFrontTemp(1,s.tires.LFtempL,s.tires.LFtempM,s.tires.LFtempR,s.tires.RFtempL,s.tires.RFtempM,s.tires.RFtempR),g.getTrackCanvas().setTiresRearTemp(1,s.tires.LRtempL,s.tires.LRtempM,s.tires.LRtempR,s.tires.RRtempL,s.tires.RRtempM,s.tires.RRtempR),g.setWindVel(1,s.getWindVelArray()),g.setFuelLevel(1,s.getFuelLevelArray()),g.getTrackCanvas().draw(),f(1,s.airTemp,s.trackTemp,s.windVel[0],s.fuelLevel[0])}if(-1!=R[0].fileIndex&&-1!=R[1].fileIndex&&c[R[0].fileIndex].isValid()&&c[R[1].fileIndex].isValid()&&R[0].lapIndex>-1&&R[1].lapIndex>-1){var r=R[0].fileIndex,n=R[0].lapIndex,h=R[1].fileIndex,d=R[1].lapIndex;i=c[r].getOneDataLap(n),s=c[h].getOneDataLap(d);i.setDataLapToCompare(s);var l=i.runSyncLaps();m[0].setLap(0,0,l[0].getLapCurrentTimeSecondsArray()),m[0].draw(),m[1].setLap(0,0,l[0].getThrottleArray()),m[1].setLap(1,0,l[1].getThrottleArray()),m[1].draw(),m[2].setLap(0,0,l[0].getBrakeArray()),m[2].setLap(1,0,l[1].getBrakeArray()),m[2].setSubscribeData(0,l[0].getAbsAcvtiveArray()),m[2].setSubscribeData(1,l[1].getAbsAcvtiveArray()),m[2].draw(),m[3].setLap(0,0,l[0].getSpeedKmhArray()),m[3].setLap(1,0,l[1].getSpeedKmhArray()),m[3].draw(),m[4].setLap(0,0,l[0].getGearArray()),m[4].setLap(1,0,l[1].getGearArray()),m[4].setSubscribeData(0,l[0].getRpmArray()),m[4].setSubscribeData(1,l[1].getRpmArray()),m[4].setMinMaxData(0,l[0].maxGear,0,1),m[4].setMinMaxData(0,l[1].maxGear,0,1),m[4].draw(),m[5].boxWidth=56,m[5].setLap(0,0,l[0].getCFSRrideHeightArray()),m[5].setLap(1,0,l[1].getCFSRrideHeightArray()),m[5].setMinMaxData(l[0].minCFSRideHeight,l[0].maxCFSRideHeight,0,1),m[5].setMinMaxData(l[1].minCFSRideHeight,l[1].maxCFSRideHeight,0,1),m[5].draw(),m[6].boxWidth=56,m[6].setLap(0,0,l[0].getLFRideHeightArray()),m[6].setLap(1,0,l[1].getLFRideHeightArray()),m[6].setMinMaxData(l[0].minLFRideHeight,l[0].maxLFRideHeight,0,1),m[6].setMinMaxData(l[1].minLFRideHeight,l[1].maxLFRideHeight,0,1),m[6].draw(),m[7].boxWidth=56,m[7].setLap(0,0,l[0].getRFRideHeightArray()),m[7].setLap(1,0,l[1].getRFRideHeightArray()),m[7].setMinMaxData(l[0].minRFRideHeight,l[0].maxRFRideHeight,0,1),m[7].setMinMaxData(l[1].minRFRideHeight,l[1].maxRFRideHeight,0,1),m[7].draw(),m[8].boxWidth=56,m[8].setLap(0,0,l[0].getLRRideHeightArray()),m[8].setLap(1,0,l[1].getLRRideHeightArray()),m[8].setMinMaxData(l[0].minLRRideHeight,l[0].maxLRRideHeight,0,1),m[8].setMinMaxData(l[1].minLRRideHeight,l[1].maxLRRideHeight,0,1),m[8].draw(),m[9].boxWidth=56,m[9].setLap(0,0,l[0].getRRRideHeightArray()),m[9].setLap(1,0,l[1].getRRRideHeightArray()),m[9].setMinMaxData(l[0].minRRRideHeight,l[0].maxRRRideHeight,0,1),m[9].setMinMaxData(l[1].minRRRideHeight,l[1].maxRRRideHeight,0,1),m[9].draw(),m[10].boxWidth=100,m[10].setLap(0,0,l[0].tires.LFtempL),m[10].setLap(0,1,l[0].tires.LFtempM),m[10].setLap(0,2,l[0].tires.LFtempR),m[10].setLap(1,0,l[1].tires.LFtempL),m[10].setLap(1,1,l[1].tires.LFtempM),m[10].setLap(1,2,l[1].tires.LFtempR),m[10].setMinMaxData(0,110,0,1),m[10].draw(),m[11].boxWidth=100,m[11].setLap(0,0,l[0].tires.RFtempL),m[11].setLap(0,1,l[0].tires.RFtempM),m[11].setLap(0,2,l[0].tires.RFtempR),m[11].setLap(1,0,l[1].tires.RFtempL),m[11].setLap(1,1,l[1].tires.RFtempM),m[11].setLap(1,2,l[1].tires.RFtempR),m[11].setMinMaxData(0,110,0,1),m[11].draw(),m[12].boxWidth=100,m[12].setLap(0,0,l[0].tires.LRtempL),m[12].setLap(0,1,l[0].tires.LRtempM),m[12].setLap(0,2,l[0].tires.LRtempR),m[12].setLap(1,0,l[1].tires.LRtempL),m[12].setLap(1,1,l[1].tires.LRtempM),m[12].setLap(1,2,l[1].tires.LRtempR),m[12].setMinMaxData(0,110,0,1),m[12].draw(),m[13].boxWidth=100,m[13].setLap(0,0,l[0].tires.RRtempL),m[13].setLap(0,1,l[0].tires.RRtempM),m[13].setLap(0,2,l[0].tires.RRtempR),m[13].setLap(1,0,l[1].tires.RRtempL),m[13].setLap(1,1,l[1].tires.RRtempM),m[13].setLap(1,2,l[1].tires.RRtempR),m[13].setMinMaxData(0,110,0,1),m[13].draw(),g.setXData(0,l[0].getLapDistMetersIntArray()),g.getTrackCanvas().setTrackCoordinates(0,l[0].trackCoordinate),g.getTrackCanvas().setTrackCoordinates(1,l[1].trackCoordinate),g.getTrackCanvas().setSteerAngles(0,l[0].getSteerArray()),g.getTrackCanvas().setSteerAngles(1,l[1].getSteerArray()),g.getTrackCanvas().setWindDirs(0,l[0].getWindDirArray()),g.getTrackCanvas().setWindDirs(1,l[1].getWindDirArray()),g.getTrackCanvas().setCarsYaw(0,l[0].getYawNorthArray()),g.getTrackCanvas().setCarsYaw(1,l[1].getYawNorthArray()),g.getTrackCanvas().setTiresFrontTemp(0,l[0].tires.LFtempL,l[0].tires.LFtempM,l[0].tires.LFtempR,l[0].tires.RFtempL,l[0].tires.RFtempM,l[0].tires.RFtempR),g.getTrackCanvas().setTiresRearTemp(0,l[0].tires.LRtempL,l[0].tires.LRtempM,l[0].tires.LRtempR,l[0].tires.RRtempL,l[0].tires.RRtempM,l[0].tires.RRtempR),g.getTrackCanvas().setTiresFrontTemp(1,l[1].tires.LFtempL,l[1].tires.LFtempM,l[1].tires.LFtempR,l[1].tires.RFtempL,l[1].tires.RFtempM,l[1].tires.RFtempR),g.getTrackCanvas().setTiresRearTemp(1,l[1].tires.LRtempL,l[1].tires.LRtempM,l[1].tires.LRtempR,l[1].tires.RRtempL,l[1].tires.RRtempM,l[1].tires.RRtempR),g.setWindVel(0,l[0].getWindVelArray()),g.setWindVel(1,l[1].getWindVelArray()),g.setFuelLevel(0,l[0].getFuelLevelArray()),g.setFuelLevel(1,l[1].getFuelLevelArray()),g.getTrackCanvas().draw(),f(0,i.airTemp,i.trackTemp,l[0].windVel[0],l[0].fuelLevel[0]),f(1,s.airTemp,s.trackTemp,l[1].windVel[0],l[1].fuelLevel[0])}}(),g.activeOnMouseMove()):console.log("Choose The Laps")}function f(t,e,i,a,s){var r=[document.querySelectorAll(".file1Info"),document.querySelectorAll(".file2Info")];if(null==c[t])return r[t][0].textContent="0c",r[t][1].textContent="0c",r[t][2].textContent="0km/h",void(r[t][3].textContent="0L");r[t][0].textContent=e+"c",r[t][1].textContent=i+"c",r[t][2].textContent=parseFloat(a).toFixed(1)+"km/h",r[t][3].textContent=parseFloat(s).toFixed(2)+"L"}function v(t){if(null==t)return null;for(var e=[],i=0;i<t.length;i++)e.push(t[i].getLapTimeStr());return e}R[0]={fileIndex:-1,lapIndex:-1},R[1]={fileIndex:-1,lapIndex:-1},h.file1.onchange=function(){o[0].textContent=null==h.file1.files[0]?"Choose the file":h.file1.files[0].name},h.file2.onchange=function(){o[1].textContent=null==h.file2.files[0]?"Choose the file":h.file2.files[0].name},h.addEventListener("submit",(async function(t){if(t.preventDefault(),function(){d.style.display="block"}(),(c=new Array(2))[0]=new s(h.file1.files[0]),c[1]=new s(h.file2.files[0]),!c[0].isValid()&&!c[1].isValid())return x(),function(){for(var t=document.querySelectorAll(".filename_laps"),e=0;e<2;e++)t[e].textContent="Driver name";var i=document.querySelector(".ul-laps1");i.innerHTML="";for(e=0;e<3;e++)i.innerHTML+="<li data-lap='"+e+"'>0:00:000 <span class='lap_number'>L 0</span></li>";var a=document.querySelector(".ul-laps2");a.innerHTML="";for(e=0;e<3;e++)a.innerHTML+="<li data-lap='"+e+"'>0:00:000 <span class='lap_number'>L 0</span></li>"}(),void setTimeout(l,500);(R=new Array(2))[0]={fileIndex:-1,lapIndex:-1},R[1]={fileIndex:-1,lapIndex:-1},driversLaps=[{},{}];for(var e=0;e<c.length;e++)if(c[e].isValid()){await c[e].read(),o[e].textContent=c[e].file.name;for(var i=c[e].sessionInfo.DriverInfo.DriverCarIdx,a=c[e].sessionInfo.DriverInfo.Drivers.length,r=0;r<a;r++)if(i==c[e].sessionInfo.DriverInfo.Drivers[r].CarIdx){p[e]=c[e].sessionInfo.DriverInfo.Drivers[r];break}}setTimeout((function(){x(),function(t,e){for(var i=document.querySelectorAll(".filename_laps"),a=0;a<p.length;a++)null!=p[a].UserName&&(i[a].textContent=p[a].UserName);var s=new Array(2);s[0]=v(t),s[1]=v(e),function(t){var e=document.querySelector(".ul-laps1");if(e.innerHTML="",null!=t[0])for(var i=0;i<t[0].length;i++)e.innerHTML+="<li data-lap='"+i+"'><span class='lapSelector box1'></span><span class='lapSelector box2'></span> "+t[0][i]+" <span class='lap_number'>L "+c[0].getOneDataLap(i).lapNumber+"</span></li>";var a=document.querySelector(".ul-laps2");if(a.innerHTML="",null!=t[1])for(i=0;i<t[1].length;i++)a.innerHTML+="<li data-lap='"+i+"'><span class='lapSelector box1'></span><span class='lapSelector box2'></span> "+t[1][i]+" <span class='lap_number'>L "+c[1].getOneDataLap(i).lapNumber+"</span></li>";var s=document.querySelectorAll(".box1"),r=document.querySelectorAll(".box2");for(let t=0;t<s.length;t++)s[t].addEventListener("click",(function(){u("box1",s[t])}));for(let t=0;t<r.length;t++)r[t].addEventListener("click",(function(){u("box2",r[t])}));l()}(s)}(c[0].getDataLaps(),c[1].getDataLaps())}),100)})),document.getElementById("controller-zoom-out").onclick=function(){for(var t=0;t<g.allCanvases.length;t++)for(var e=0;e<g.allCanvases[t].data.length;e++)null!=g.allCanvases[t].data[e]&&g.allCanvases[t].resetStartEndMeters();g.getTrackCanvas().resetTrackPositionOnCanvas()};var M=document.getElementById("controller-play-lap"),F=document.getElementById("play_pause_image"),w=document.getElementById("playback_speed"),T=!1,y=0,A=1e-4,C=0;function D(){for(var t=0;t<g.allCanvases.length;t++)g.canvasOnMouseMove(null,y,g.allCanvases[t],g);(y+=A)>=.98999?(cancelAnimationFrame(C),y=0,T=!1,F.src="images/play.png"):C=requestAnimationFrame(D)}w.oninput=function(){A=parseFloat(this.value),document.getElementById("playback_speed_text").textContent=(1e4*this.value).toFixed(0)},M.onclick=function(){if(-1!=R[0].lapIndex||-1!=R[1].lapIndex){if(T)return cancelAnimationFrame(C),F.src="images/play.png",T=!1,void(y=0);T=!0,F.src="images/pause.png",D()}};